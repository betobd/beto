<?xml version="1.0" encoding="iso-8859-1"?><project>
  <properties>
    <properties>
      <globalscript class="extscriptnodebug"/>
      <onstartscript class="extscript"/>
      <onstopscript class="extscript"/>
    </properties>
    <path>ProjectScripts.jsxml</path>
  </properties>
  <mask name="mask.xml">
    <path>mask.xml</path>
    <globalsettings>
      <globalscript class="script">/**/
/* Script partagé de l'application */
/* Ensemble des fonctions communes à toute l'application */
/*
/* Une partie des fonctions sont recopiées du projet IAM au 24/11/2015
/**/ 

/////////////////////
// Debut du script //
/////////////////////

/////////////////////////////////
// Fonctions issues du projet IAM
/////////////////////////////////

/**
  chiffre le fichier de propriétés
*/
function chiffrement(properties,propertyNames,file){
  var cle="zG4mPnJAR3E=";
  var parameters=new Parameters();
  var i=0;
   while (propertyNames.hasMoreElements()) {    
      var name=propertyNames.nextElement();
      if (name.indexOf("Ciphered-")&gt;-1){
           var property=properties.getProperty(name);
           if (property.indexOf("Ciphered{")&gt;-1){
               property=property.replace("Ciphered{","");
               property=property.substring(0,property.length()-1);
               property=crypto.DESdecrypt(property,cle);
           }else {
              file.open("a");
              var propertyEncrypt=crypto.DESencrypt(property,cle);
              properties.setProperty(name,"Ciphered{"+propertyEncrypt+"}");
              var outPutStream=new java.io.FileOutputStream(file.getJavaFile());
              properties.store(outPutStream, name+"=Ciphered{"+propertyEncrypt+"}");
              file.close();
           }
           parameters.add(name.replace("Ciphered-",""),property);
        }else{
          var property=properties.getProperty(name);
          parameters.add(name,property);
        }          
      i++;
    }
    return parameters;
}


/**
   récupère les paramètres présents dans le fichier de propriétés des droits
*/
function getProvisioningParameters_Droit(){
  var file=meibo.getFile("b-com_TRAVEL_droits.properties");
  file.open("r");
  var properties=file.getAsProperties();
  var propertyNames=properties.propertyNames();
  var parameters=chiffrement(properties,propertyNames,file);
  file.close();
  return parameters;
}
/**
  récupère les paramètres présents dans le fichier de propriétés des processus
*/
function getProvisioningParameters_Workflows(){
  var file=meibo.getFile("b-com_TRAVEL_workflows.properties");
  file.open("r");
  var properties=file.getAsProperties();
  var propertyNames=properties.propertyNames();
  var parameters=chiffrement(properties,propertyNames,file);
  file.close();
  return parameters;
}
/**
  récupère les paramètres présents dans le fichier de propriétés des mails
*/
function getProvisioningParameters_Mails(){
  var file=meibo.getFile("b-com_TRAVEL_mails.properties");
  file.open("r");
  var properties=file.getAsProperties();
  var propertyNames=properties.propertyNames();
  var parameters=chiffrement(properties,propertyNames,file);
  file.close();
  return parameters;
}
/**
  récupère les paramètres présents dans le fichier de propriétés général
*/
function getProvisioningParameters_General(){
  var file=meibo.getFile("b-com_TRAVEL.properties");
  file.open("r");
  var properties=file.getAsProperties();
  var propertyNames=properties.propertyNames();
  var parameters=chiffrement(properties,propertyNames,file);
  file.close();
  return parameters;
}

/**
   retourne chaine vide si la chaine est null
*/
function returnEmpty(chaine){
  if ( chaine == null) {
    chaine = "";
  }
  return chaine;
}

/**
  initialise les ressources du projet
*/
function initializeResources(){
  var parameters = getProvisioningParameters_General();
  /**********************************************/
  /*     Source de données Active Directory     */
  /**********************************************/
  /*Ressource Group*/
  var BCOM_AD_OU_ACCES = returnEmpty(parameters.get("BCOM_AD_OU_ACCES"));
  if ( BCOM_AD_OU_ACCES != "" ){
    meibo.changeResourceBase("Acces",BCOM_AD_OU_ACCES); 
  }
  /*Ressource Group*/
  var BCOM_AD_OU_GROUP = returnEmpty(parameters.get("BCOM_AD_OU_GROUP"));
  if ( BCOM_AD_OU_GROUP != "" ){
    meibo.changeResourceBase("Group",BCOM_AD_OU_GROUP); 
  }
  /*Ressource GroupProject*/
  var BCOM_AD_OU_GROUP_PROJECT = returnEmpty(parameters.get("BCOM_AD_OU_GROUP_PROJECT"));
  if ( BCOM_AD_OU_GROUP_PROJECT != "" ){
    meibo.changeResourceBase("GroupProject",BCOM_AD_OU_GROUP_PROJECT); 
  }
  /*Ressource GroupAll*/
  var BCOM_AD_OU_GROUP_ALL = returnEmpty(parameters.get("BCOM_AD_OU_GROUP_ALL"));
  if ( BCOM_AD_OU_GROUP_ALL != "" ){
    meibo.changeResourceBase("GroupAll",BCOM_AD_OU_GROUP_ALL); 
  }
  /*Ressource GroupUser*/
  var BCOM_AD_OU_GROUP_USER = returnEmpty(parameters.get("BCOM_AD_OU_GROUP_USER"));
  if ( BCOM_AD_OU_GROUP_USER != "" ){
    meibo.changeResourceBase("GroupUser",BCOM_AD_OU_GROUP_USER); 
  }
  /*Ressource People*/
  var BCOM_AD_OU_PEOPLE = returnEmpty(parameters.get("BCOM_AD_OU_PEOPLE"));
  if ( BCOM_AD_OU_PEOPLE != "" ){
    meibo.changeResourceBase("People",BCOM_AD_OU_PEOPLE); 
  }
  /*Ressource Role*/
  var BCOM_AD_OU_ROLE = returnEmpty(parameters.get("BCOM_AD_OU_ROLE"));
  if ( BCOM_AD_OU_ROLE != "" ){
    meibo.changeResourceBase("Role",BCOM_AD_OU_ROLE); 
  }
  /*Ressource RoleStatus*/
  var BCOM_AD_OU_ROLE_STATUS = returnEmpty(parameters.get("BCOM_AD_OU_ROLE_STATUS"));
  if ( BCOM_AD_OU_ROLE_STATUS != "" ){
    meibo.changeResourceBase("RoleStatus",BCOM_AD_OU_ROLE_STATUS); 
  }
  var BCOM_AD_OU_ROLE_STATUS = returnEmpty(parameters.get("BCOM_AD_OU_ROLE_STATUS"));
  if ( BCOM_AD_OU_ROLE_STATUS != "" ){
    meibo.changeResourceBase("RoleStatusSansExterne",BCOM_AD_OU_ROLE_STATUS); 
  }
  /*Ressource RoleOPERATION*/
  var BCOM_AD_OU_ROLE_OPERATION = returnEmpty(parameters.get("BCOM_AD_OU_ROLE_OPERATION"));
  if ( BCOM_AD_OU_ROLE_OPERATION != "" ){
    meibo.changeResourceBase("RoleOperation",BCOM_AD_OU_ROLE_OPERATION); 
  }
  /*Ressource RoleApplication*/
  var BCOM_AD_OU_ROLE_APPLICATION = returnEmpty(parameters.get("BCOM_AD_OU_ROLE_APPLICATION"));
  if ( BCOM_AD_OU_ROLE_APPLICATION != "" ){
    meibo.changeResourceBase("RoleApplication",BCOM_AD_OU_ROLE_APPLICATION); 
  }
   /*Ressource RolePosition*/
  var BCOM_AD_OU_ROLE_POSITION = returnEmpty(parameters.get("BCOM_AD_OU_ROLE_POSITION"));
  if ( BCOM_AD_OU_ROLE_POSITION != "" ){
    meibo.changeResourceBase("RolePosition",BCOM_AD_OU_ROLE_POSITION); 
  }
  /**********************************************/
  /*     Source de données 2     */
  /**********************************************/
  /*Ressource 1*/
  
  /*Ressource 2*/
  
  /*Ressource 3*/

}
/**
  Fonction qui détecte si c'est un membre d'un groupe est de type rôle ou autre.
*/
function detectedRoleInGroup(member){
  var test = "false";
  var parameters = getProvisioningParameters_General();
  var ouPers = parameters.get("BCOM_AD_OU_PEOPLE");
  if ( member.indexOf(ouPers) == -1 ){
    var entry = returnEmpty(meibo.getDnEntry("Role",member,"member,cn"));
    if ( entry != "" ){
      var nbAttribute = entry.getAttributeCount();
      if (nbAttribute != 0 ){
        test = entry.cn[0];
      }
    }
  }
  return test; 
}

/**
  ajoute le rôle utilisateur.
*/
function addRoleMeiboUtilisateur(DNPERS,PARAM,ROLE){
  if ( PARAM != "" ){ //-- SI VARIABLE NON VIDE
    var split_BFU = PARAM.split("|");//-- SPLIT les groupes pour les récupérer sous forme de tableau
    var nbGGU = split_BFU.length(); //-- Calcul du nombre du groupe
    var i = 0; //-- Initialisation d'un incrément
    var filtreUtilisateur = "";//-- Initialisation du filtre utilisateur
    while ( i &lt; nbGGU ) { //-- Début boucle sur le nombre de groupes utilisateur
      if ( i == 0 ){ //-- SI c'est le premier groupe
        filtreUtilisateur = "(CN=" + split_BFU[i] + ")"; //-- Calcul du filtre
      }
      else{ //-- SINON
        filtreUtilisateur = filtreUtilisateur + "(CN=" + split_BFU[i] + ")";//-- Calcul du filtre
      }
      i++;//-- Incrémentation
    }//-- Fin boucle sur le nombre de groupe utilisateur
    if ( nbGGU &gt; 0 ){ //-- SI AU MOINS 1 GROUPE
      filtreUtilisateur = "(|" + filtreUtilisateur + ")"; //-- Calcul du filtre
      var groupUser = meibo.executeResource("GroupUser","(&amp;(member=" + DNPERS + ") " + filtreUtilisateur + ")",0,"dn");//-- Recherche de la personne dans les groupes utilisateurs
      var nbEntries_groupUser = groupUser.getEntryCount();//-- Récupère le nombre de résultats
      if ( nbEntries_groupUser &gt; 0 ){ //-- SI AU MOINS 1 RESULTAT
        meibo.addUserRole(ROLE); //-- Ajout le profil UTILISATEUR
      }
      else{//-- SINON
        var groupUser = meibo.executeResource("GroupUser", filtreUtilisateur ,0,"member");//-- Recherche des groupes utilisateurs 
        var nbEntries_groupUser = groupUser.getEntryCount();//-- Récupère le nombre de résultats
        if ( nbEntries_groupUser &gt; 0 ){ //-- SI AU MOINS 1 RESULTAT
          var j = 0;//-- Initialisation d'un incrément
          while ( j &lt; nbEntries_groupUser ){ //-- Début boucle sur le nombre de groupe utilisateur
            var members = returnEmpty(groupUser.getEntry(j).getAttribute("member"));//-- Récupère les membres pour le groupe
            if ( members != "" ){
              var nbMember = members.getCount();//-- Récupère le nombre de membre pour le groupe
              var k = 0;//-- Initialisation d'un incrément
              while ( k &lt; nbMember ){//-- Début boucle sur le nombre membre du groupe
                var mb = members.getValue(k); //-- récupération membre par membre
                var test = returnEmpty(detectedRoleInGroup(mb)); //-- Détection si le membre est un rôle ou autre
                if ( ( test != "" ) &amp;&amp; ( test != "false" ) ){
                  var role = meibo.executeResource("Role","(&amp;(member=" + DNPERS + ") (CN=" + test + ") )",0,"dn");//-- Recherche de la personne dans le rôle utilisateurs   
                  var nbEntries_role = role.getEntryCount();//-- Récupère le nombre de résultats
                  if ( nbEntries_role &gt; 0 ){ //-- SI AU MOINS 1 RESULTAT
                    meibo.addUserRole(ROLE); //-- Ajout le profil UTILISATEUR
                    break;
                  }
                }
                k++;//-- Incrémentation
              }//-- Fin boucle sur le nombre membre du groupe
            }  
            j++;//-- Incrémentation
          }//-- Fin boucle sur le nombre de groupe utilisateur
        }
      } 
    }
  }  


}
/**
  Fonction qui ajoute les autres rôles.
*/
function addRoleMeibo(DNPERS,PARAM,ROLE){
  if ( PARAM != "" ){ //-- SI VARIABLE NON VIDE
    var split_BFU = PARAM.split("|");//-- SPLIT les groupes pour les récupérer sous forme de tableau
    var nbGGR = split_BFU.length(); //-- Calcul du nombre du groupe
    var i = 0; //-- Initialisation d'un incrément
    var filtreUtilisateur = "";//-- Initialisation du filtre utilisateur
    while ( i &lt; nbGGR ) { //-- Début boucle sur le nombre de groupe utilisateur
      if ( i == 0 ){ //-- SI c'est le premier groupe
        filtreUtilisateur = "(CN=" + split_BFU[i] + ")"; //-- Calcul du filtre
      }
      else{ //-- SINON
        filtreUtilisateur = filtreUtilisateur + "(CN=" + split_BFU[i] + ")";//-- Calcul du filtre
      }
      i++;//-- Incrémentation
    }//-- Fin boucle sur le nombre de groupe utilisateur
    if ( nbGGR &gt; 0 ){ //-- SI AU MOINS 1 GROUPE
      if ( nbGGR &gt; 1 ){
        filtreUtilisateur = "(|" + filtreUtilisateur + ")"; //-- Calcul du filtre
      }
      var RoleOperation = meibo.executeResource("RoleApplication","(&amp;(member=" + DNPERS + ") " + filtreUtilisateur + ")",0,"dn");//-- Recherche de la personne dans le role operation
      var nbEntries_RoleOperation = RoleOperation.getEntryCount();//-- Récupère le nombre de résultats
      if ( nbEntries_RoleOperation &gt; 0 ){ //-- SI AU MOINS 1 RESULTAT
        meibo.addUserRole(ROLE); //-- Ajout le profil UTILISATEUR
      }
      else{//-- SINON
        var RoleOperation = meibo.executeResource("RoleApplication", filtreUtilisateur ,0,"member");//-- Recherche des groupes utilisateurs 
        var nbEntries_RoleOperation = RoleOperation.getEntryCount();//-- Récupère le nombre de résultats
        if ( nbEntries_RoleOperation &gt; 0 ){ //-- SI AU MOINS 1 RESULTAT
          var j = 0;//-- Initialisation d'un incrément
          while ( j &lt; nbEntries_RoleOperation ){ //-- Début boucle sur le nombre de groupe utilisateur
            var members = returnEmpty(RoleOperation.getEntry(j).getAttribute("member"));//-- Récupère les membres pour le groupe
            if ( members != "" ){ //-- SI MEMBER EST RENSEIGNE
              var nbMember = members.getCount();//-- Récupère le nombre de membre pour le groupe
              var k = 0;//-- Initialisation d'un incrément
              while ( k &lt; nbMember ){//-- Début boucle sur le nombre membre du role
                var mb = members.getValue(k); //-- récupération membre par membre
                var test = returnEmpty(detectedRoleInGroup(mb)); //-- Détection si le membre est un rôle ou autre
                if ( ( test != "" ) &amp;&amp; ( test != "false" ) ){
                  var role = meibo.executeResource("Role","(&amp;(member=" + DNPERS + ") (CN=" + test + ") )",0,"dn");//-- Recherche de la personne dans le rôle utilisateurs   
                  var nbEntries_role = role.getEntryCount();//-- Récupère le nombre de résultats
                  if ( nbEntries_role &gt; 0 ){ //-- SI AU MOINS 1 RESULTAT
                    meibo.addUserRole(ROLE); //-- Ajout le profil UTILISATEUR
                    break;
                  }
                }
                k++;//-- Incrémentation
              }//-- Fin boucle sur le nombre membre du groupe
            }  
            j++;//-- Incrémentation
          }//-- Fin boucle sur le nombre de role operation
        }
      } 
    }
  }  


}

/**
  Fonction qui normalise une chaine de caractère sans accent, sans espace, sans apostrophe, sans tiret et sans caractères spéciaux .   
*/
function normalize(chaine)
{
  chaine=chaine.toLowerCase();
  chaine=chaine.replace("à","a");
  chaine=chaine.replace("á","a");
  chaine=chaine.replace("ä","a");
  chaine=chaine.replace("â","a");
  chaine=chaine.replace("ã","a");
  chaine=chaine.replace("æ","ae");
  chaine=chaine.replace("é","e");
  chaine=chaine.replace("ê","e");
  chaine=chaine.replace("è","e");
  chaine=chaine.replace("ë","e");
  chaine=chaine.replace("î","i");
  chaine=chaine.replace("ï","i");
  chaine=chaine.replace("ì","i");
  chaine=chaine.replace("í","i");
  chaine=chaine.replace("ô","o");
  chaine=chaine.replace("õ","o");
  chaine=chaine.replace("ö","o");
  chaine=chaine.replace("ò","o");
  chaine=chaine.replace("ó","o");
  chaine=chaine.replace("ù","u");
  chaine=chaine.replace("û","u");
  chaine=chaine.replace("ü","u");
  chaine=chaine.replace("ú","u");
  chaine=chaine.replace("ÿ","y");
  chaine=chaine.replace("ç","c");
  chaine=chaine.replace("ñ","n");
  chaine=chaine.replace("/","");
  chaine=chaine.replace("\\","");
  chaine=chaine.replace("$","");
  chaine=chaine.replace("*","");//pour les caractères joker
  chaine=chaine.replace("%","");
  chaine=chaine.replace("!","");
  chaine=chaine.replace("@","");
  chaine=chaine.replace("|","");
  chaine=chaine.replace("(","");
  chaine=chaine.replace(")","");
  chaine=chaine.replace("[","");
  chaine=chaine.replace("]","");
  chaine=chaine.replace("=","");
  chaine=chaine.replace("+","");
  chaine=chaine.replace("&amp;","");
  chaine=chaine.replace("?","");
  chaine=chaine.replace(",","");
  chaine=chaine.replace("!","");
  chaine=chaine.replace(");","");
  chaine=chaine.replace(".","");
  chaine=chaine.replace("µ","");
  chaine=chaine.replace("%","");
  chaine=chaine.replace(":","");
  chaine=chaine.replace("§","");
  chaine=chaine.replace("^","");
  chaine=chaine.replace("¨","");
  chaine=chaine.replace("}","");
  chaine=chaine.replace("{","");
  chaine=chaine.replace("#","");
  chaine=chaine.replace("°","");
  chaine=chaine.replace(" ","");
  chaine=chaine.replace("'","");
  chaine=chaine.replace("-","");
  chaine=chaine.toUpperCase();
 return chaine;
}


/**
  Fonction qui normalise une chaine de caractère sans accent, sans espace, sans apostrophe, sans tiret et sans caractères spéciaux .   
*/
function normalizeGivenName(chaine)
{
  chaine=chaine.toLowerCase();
  chaine=chaine.replace("à","a");
  chaine=chaine.replace("á","a");
  chaine=chaine.replace("ä","a");
  chaine=chaine.replace("â","a");
  chaine=chaine.replace("ã","a");
  chaine=chaine.replace("æ","ae");
  chaine=chaine.replace("é","e");
  chaine=chaine.replace("ê","e");
  chaine=chaine.replace("è","e");
  chaine=chaine.replace("ë","e");
  chaine=chaine.replace("î","i");
  chaine=chaine.replace("ï","i");
  chaine=chaine.replace("ì","i");
  chaine=chaine.replace("í","i");
  chaine=chaine.replace("ô","o");
  chaine=chaine.replace("õ","o");
  chaine=chaine.replace("ö","o");
  chaine=chaine.replace("ò","o");
  chaine=chaine.replace("ó","o");
  chaine=chaine.replace("ù","u");
  chaine=chaine.replace("û","u");
  chaine=chaine.replace("ü","u");
  chaine=chaine.replace("ú","u");
  chaine=chaine.replace("ÿ","y");
  chaine=chaine.replace("ç","c");
  chaine=chaine.replace("ñ","n");
  chaine=chaine.replace("/","");
  chaine=chaine.replace("\\","");
  chaine=chaine.replace("$","");
  chaine=chaine.replace("*","");//pour les caractères joker
  chaine=chaine.replace("%","");
  chaine=chaine.replace("!","");
  chaine=chaine.replace("@","");
  chaine=chaine.replace("|","");
  chaine=chaine.replace("(","");
  chaine=chaine.replace(")","");
  chaine=chaine.replace("[","");
  chaine=chaine.replace("]","");
  chaine=chaine.replace("=","");
  chaine=chaine.replace("+","");
  chaine=chaine.replace("&amp;","");
  chaine=chaine.replace("?","");
  chaine=chaine.replace(",","");
  chaine=chaine.replace("!","");
  chaine=chaine.replace(");","");
  chaine=chaine.replace(".","");//pour les numéros de téléphone
  chaine=chaine.replace("µ","");
  chaine=chaine.replace("%","");
  chaine=chaine.replace(":","");
  chaine=chaine.replace("§","");
  chaine=chaine.replace("^","");
  chaine=chaine.replace("¨","");
  chaine=chaine.replace("}","");
  chaine=chaine.replace("{","");
  chaine=chaine.replace("#","");
  chaine=chaine.replace("°","");
  chaine=chaine.replace("-"," ");
  chaine=chaine.replace("'"," ");
  chaine=chaine.toUpperCase();
 return chaine;
}

/**
  Fonction qui normalise une chaine de caractère sans accent, sans apostrophe, sans caractères spéciaux et remplacement de l'espace par tiret .   
*/
function normalizeMail(chaine)
{
  chaine=chaine.toLowerCase();
  chaine=chaine.replace("à","a");
  chaine=chaine.replace("á","a");
  chaine=chaine.replace("ä","a");
  chaine=chaine.replace("â","a");
  chaine=chaine.replace("ã","a");
  chaine=chaine.replace("æ","ae");
  chaine=chaine.replace("é","e");
  chaine=chaine.replace("ê","e");
  chaine=chaine.replace("è","e");
  chaine=chaine.replace("ë","e");
  chaine=chaine.replace("î","i");
  chaine=chaine.replace("ï","i");
  chaine=chaine.replace("ì","i");
  chaine=chaine.replace("í","i");
  chaine=chaine.replace("ô","o");
  chaine=chaine.replace("õ","o");
  chaine=chaine.replace("ö","o");
  chaine=chaine.replace("ò","o");
  chaine=chaine.replace("ó","o");
  chaine=chaine.replace("ù","u");
  chaine=chaine.replace("û","u");
  chaine=chaine.replace("ü","u");
  chaine=chaine.replace("ú","u");
  chaine=chaine.replace("ÿ","y");
  chaine=chaine.replace("ç","c");
  chaine=chaine.replace("ñ","n");
  chaine=chaine.replace("/","");
  chaine=chaine.replace("\\","");
  chaine=chaine.replace("$","");
  chaine=chaine.replace("*","");
  chaine=chaine.replace("%","");
  chaine=chaine.replace("!","");
  chaine=chaine.replace("@","");
  chaine=chaine.replace("|","");
  chaine=chaine.replace("(","");
  chaine=chaine.replace(")","");
  chaine=chaine.replace("[","");
  chaine=chaine.replace("]","");
  chaine=chaine.replace("=","");
  chaine=chaine.replace("+","");
  chaine=chaine.replace("&amp;","");
  chaine=chaine.replace("?","");
  chaine=chaine.replace(",","");
  chaine=chaine.replace("!","");
  chaine=chaine.replace(");","");
  chaine=chaine.replace(".","");
  chaine=chaine.replace("µ","");
  chaine=chaine.replace("%","");
  chaine=chaine.replace(":","");
  chaine=chaine.replace("§","");
  chaine=chaine.replace("^","");
  chaine=chaine.replace("¨","");
  chaine=chaine.replace("}","");
  chaine=chaine.replace("{","");
  chaine=chaine.replace("#","");
  chaine=chaine.replace("°","");
  chaine=chaine.replace(" ","-");
  chaine=chaine.replace("'","");
  chaine=chaine.toUpperCase();
 return chaine;
}


/**
  Fonction qui met en forme le nom et prénom.
*/
function miseEnForme(chaine){
  var m = 0;
  var newChaine = "";
  var cara ="";
  for(var j = 0;j&lt;chaine.length();j++){
     var cara = chaine.charAt(j);
     
     if (m == 0){
        cara = cara.toUpperCase();
        m++; 
     }
     else{
        if ((cara == "-") || (cara == " ")){
          m=0;   
        }
        else{
          cara = cara.toLowerCase();
        }  
     }
      newChaine = newChaine+ cara;
      
  }
  return newChaine;
}
/**
  Fonction récupères les mails destinataire selon le role.
*/
function getAdressMailByRole(PARAM){
  var sendMail = ""; //-- initialisation de la variable des mails destinataire
  if ( PARAM != "" ){ //-- SI VARIABLE NON VIDE
    var split_BFU = PARAM.split("|");//-- SPLIT les groupes pour les récupérer sous forme de tableau
    var nbGGR = split_BFU.length(); //-- Calcul du nombre du groupe
    var i = 0; //-- Initialisation d'un incrément
    var filtreUtilisateur = "";//-- Initialisation du filtre utilisateur
    while ( i &lt; nbGGR ) { //-- Début boucle sur le nombre de groupe utilisateur
      if ( i == 0 ){ //-- SI c'est le premier groupe
        filtreUtilisateur = "(CN=" + split_BFU[i] + ")"; //-- Calcul du filtre
      }
      else{ //-- SINON
        filtreUtilisateur = filtreUtilisateur + "(CN=" + split_BFU[i] + ")";//-- Calcul du filtre
      }
      i++;//-- Incrémentation
    }//-- Fin boucle sur le nombre de groupe utilisateur
    if ( nbGGR &gt; 0 ){ //-- SI AU MOINS 1 GROUPE
      if ( nbGGR &gt; 1 ){
        filtreUtilisateur = "(|" + filtreUtilisateur + ")"; //-- Calcul du filtre
      }
      var RoleApplication = meibo.executeResource("RoleApplication", filtreUtilisateur ,0,"member");//-- Recherche des groupes utilisateurs 
      var nbEntries_RoleApplication = RoleApplication.getEntryCount();//-- Récupère le nombre de résultats
      if ( nbEntries_RoleApplication &gt; 0 ){ //-- SI AU MOINS 1 RESULTAT
        var j = 0;//-- Initialisation d'un incrément
        /////////////////////////////////////////////
        //Boucle sur les groupes NIVEAU LE PLUS HAUT
        /////////////////////////////////////////////
        while ( j &lt; nbEntries_RoleApplication ){ //-- Début boucle sur le nombre de groupe utilisateur
          var members = returnEmpty(RoleApplication.getEntry(j).getAttribute("member"));//-- Récupère les membres pour le groupe
          if ( members != "" ){ //-- SI MEMBER EST RENSEIGNE
            var nbMember = members.getCount();//-- Récupère le nombre de membre pour le groupe
            var k = 0;//-- Initialisation d'un incrément
            /////////////////////////////////////////////////////////
            //Boucle sur les membres des groupes NIVEAU LE PLUS HAUT
            /////////////////////////////////////////////////////////
            while ( k &lt; nbMember ){//-- Début boucle sur le nombre membre du role
              var mb = members.getValue(k); //-- récupération membre par membre
              var test = returnEmpty(detectedRoleInGroup(mb)); //-- Détection si le membre est un rôle ou autre
              if ( ( test != "" ) &amp;&amp; ( test != "false" ) ){//--SI LE MEMBRE EST UN GROUPE N-1
                var role = meibo.executeResource("Role","(CN=" + test + ")",0,"member");//-- Recherche des membres des groupe N-1   
                var nbEntries_role = role.getEntryCount();//-- Récupère le nombre de résultats
                if ( nbEntries_role &gt; 0 ){ //-- SI AU MOINS 1 RESULTAT
                  var m = 0;
                  var membersNivMoins1 = role.getEntry().getAttribute("member");
                  var nbMembersNivMoins1 = membersNivMoins1.getCount();
                  /////////////////////////////////////////////////////////
                  //Boucle sur les membres des groupes NIVEAU N-1
                  /////////////////////////////////////////////////////////
                  while( m &lt; nbMembersNivMoins1 ){
                    var mbNivMoins1 = membersNivMoins1.getValue(m);
                    var testNMoins1 = returnEmpty(detectedRoleInGroup(mbNivMoins1)); //-- Détection si le membre est un rôle ou autre
                    if ( testNMoins1 == "false" ){// SI LE MEMBRE EST UNE PERSONNE
                      var entryPers = returnEmpty(meibo.getDnEntry("People",mbNivMoins1,"mail"));//-- entrée de la personne
                      if ( entryPers != "" ){//-- si personne trouvé dans AD
                        var mail = returnEmpty(entryPers.mail[0]);//-- Récupération du mail de la personne
                        if ( mail != "" ){//SI LA PERSONNE A UN MAIL DE RENSEIGNE
                          if ( sendMail == "" ){//-- SI la varaible sendMail est vide
                            sendMail = mail; //-- Ajout du premier mail à la variable sendMail
                          }
                          else{//-- SINON
                            sendMail = sendMail + "," + mail; //-- Ajout des autre mail à la variable sendMail
                          }
                        }
                      }  
                    }
                    m++;//--incrémentation
                  }
                }
              }
              else{//-- SINON LE MEMBRE EST UNE PERSONNE
                var entryPers = returnEmpty(meibo.getDnEntry("People",mb,"mail"));//-- entrée de la personne
                if ( entryPers != "" ){//-- si personne trouvé dans AD
                  var mail = returnEmpty(entryPers.mail[0]);//-- Récupération du mail de la personne
                  if ( mail != "" ){//SI LA PERSONNE A UN MAIL DE RENSEIGNE
                    if ( sendMail == "" ){//-- SI la varaible sendMail est vide
                      sendMail = mail;//-- Ajout du premier mail à la variable sendMail
                    }
                    else{//-- SINON
                      sendMail = sendMail + "," + mail;//-- Ajout des autre mail à la variable sendMail
                    }
                  }
                }
              }
              k++;//-- Incrémentation
            }//-- Fin boucle sur le nombre membre du groupe
          }  
          j++;//-- Incrémentation
        }//-- Fin boucle sur le nombre de role operation
      }
    }
  }
  return sendMail; //-- retourne la chaine des mails destinataire
}
/**
  Fonction qui tranforme une date ldap en une date mise en forme pour l'affichage.
*/
function getDateString(dateLdap){
  var dateString = dateLdap.substring(6,8)+"/"+dateLdap.substring(4,6)+"/"+dateLdap.substring(0,4);
  
  return dateString; 
}
/**
  Fonction qui vérifie s'il y a un groupe manager.
*/
function checkManager(groupe){
  var check = "FALSE";
  if ( returnEmpty(groupe) != "" ){
    var entry = meibo.getDnEntry("Role",groupe,"managedBy");
    var managedBy = returnEmpty(entry.managedBy[0]);
    if ( managedBy != "" ){
      check = managedBy;
    }    
  }
  return check;
}
/**
  Fonction qui récupère les mails des membres du groupe.
*/
function  getMailMemberGrp(managedBy){
  var sendMail = "";
  if ( returnEmpty(managedBy) != "" ){
    var entry = meibo.getDnEntry("Role",managedBy,"member");
    var member = returnEmpty(entry.getAttribute("member"));
    if ( ( member != "" ) &amp;&amp; ( member.getCount() &gt; 0 ) ){
      var i = 0;
      while ( i &lt; member.getCount()){
        var entryPers = returnEmpty(meibo.getDnEntry("People",member.getValue(i),"mail"));
        if (entryPers != "" ){ 
          var mail = returnEmpty(entryPers.mail[0]); 
          if ( mail != "" ){
            if ( i == 0 ){
              sendMail = mail;
            }
            else{
              sendMail = sendMail + "," + mail;
            }
          }
        }
        i++;
      }
    
    }
    
  }
  
  return sendMail;
}

/**
  Fonction qui converti un affichage date en date ldap .
*/
function getDateLdapInverse(date){
  /*slipt sur "/"*/
  var dateSplit = date.split("/");
  /*récupère l'année au format date*/
  var year = parseInt(dateSplit[2]) - 1900;
  /*récupère le mois au format date*/
  var month = parseInt(dateSplit[1]) - 1;
  /*récupère le jour au format date*/
  var day = parseInt(dateSplit[0]);
  /*crée la date au format date*/
  var newDate = new Date(year,month,day,6,0,0,0);
  /*transforme le date au format LDAP */
  var  dateLdap = newDate.toLdapString();
  return dateLdap; 
}
/**
  Fonction qui converti date en seconde depuis 1601 .
*/
function /*java.math.BigInteger*/getTotalSecondsSince1601(){
  var iYearsFrom1601to1970 = 1970 - 1601; //369;
  var iDaysFrom1601to1970 = iYearsFrom1601to1970 * 365; //134685 ; //
  iDaysFrom1601to1970 = iDaysFrom1601to1970 + (iYearsFrom1601to1970 / 4); // leap years //134777;//
  iDaysFrom1601to1970 = iDaysFrom1601to1970 - 3; // non-leap centuries (1700,1800,1900).  2000 is a leap century // 134774 ; //
  iDaysFrom1601to1970 = new java.math.BigInteger(""+iDaysFrom1601to1970);
  //var iSecondsFrom1601to1970 = iDaysFrom1601to1970 * 24 * 60 * 60;
  var iSecondsFrom1601to1970 = iDaysFrom1601to1970.multiply(new java.math.BigInteger("24"));
  iSecondsFrom1601to1970 = iSecondsFrom1601to1970.multiply(new java.math.BigInteger("60"));
  iSecondsFrom1601to1970 = iSecondsFrom1601to1970.multiply(new java.math.BigInteger("60"));
  return iSecondsFrom1601to1970;
}
/**
 convert an ad date to a java date
*/
//128959704000000000
function /*Date*/convertDateStringFromAD(/*string*/adDate){
  var bigDate = new java.math.BigInteger(adDate);  
  var iSecondsFrom1601to1970 = getTotalSecondsSince1601(); 
  //12895970400
  var iTotalSecondsSince1601 =  bigDate.divide( new java.math.BigInteger("10000000"));
  //var iTotalSecondsSince1970 = (iTotalSecondsSince1601 - iSecondsFrom1601to1970);
  var iTotalSecondsSince1970 =  iTotalSecondsSince1601.add(iSecondsFrom1601to1970.negate());
  var iTotalMillisecondSecondsSince1970 =iTotalSecondsSince1970.multiply(new java.math.BigInteger("1000"));
  //var result = new java.util.Date(new java.lang.Long(iTotalSecondsSince1970 * 1000));
  var result = new Date( new java.util.Date(iTotalMillisecondSecondsSince1970.longValue()));
  return result;
}
/**
convert a java date to an ad date
*/
function /*string*/convertDateToStringAD(/*Date*/ javaDate){
  var adDate = null;
  var javaDate2 = javaDate.getJavaDate();
  var iSecondsFrom1601to1970 = getTotalSecondsSince1601();
  var time = javaDate2.getTime();
  var iTotalMillisecondSecondsSince1970 = new java.math.BigInteger("" + time);
  var iTotalSecondsSince1970 = iTotalMillisecondSecondsSince1970.divide(new java.math.BigInteger("1000"));
  var iTotalSecondsSince1601 =  iTotalSecondsSince1970.add(iSecondsFrom1601to1970); 
  //ajout d'une journée dans la date
  iTotalSecondsSince1601= iTotalSecondsSince1601.add( new java.math.BigInteger("86400"));
  var adDate =  iTotalSecondsSince1601.multiply( new java.math.BigInteger("10000000")); 
  return "" +adDate.longValue();
}


/**
  Fonction qui converti date ldap en java date .
*/
function getDateLdapToJavaDate(dateLdap){
  
  /*récupère l'année au format date*/
  var year = parseInt(dateLdap.substring(0,4)) - 1900;
  /*récupère le mois au format date*/
  var month = parseInt(dateLdap.substring(4,6)) - 1;
  /*récupère le jour au format date*/
  var day = parseInt(dateLdap.substring(6,8));
  /*crée la date au format date*/
  var newDate = new Date(year,month,day,6,0,0,0);
  /*transforme le date au format LDAP */
  
  return newDate; 
}

/////////////////////////////////
// Fin des Fonctions issues du projet IAM
/////////////////////////////////

/////////////////////////////////
// Fonctions générées par assistants Meibo
/////////////////////////////////
// check if a mandatory field is not empty.
// If the field is empty, an error is displayed in an error field.
// The function returns false if the field is empty.
function /*boolean*/ checkMandatoryField(/*String*/ valueField, /*int*/ tabNumber) {
  var /*boolean*/ ok = false;
  var /*String*/ labelField = "label" + valueField;
  var /*String*/ value = meibo.getFieldValue(valueField);
  if ((value != null) &amp;&amp; (value.trim().length &gt; 0)) {
    ok = true;
  }
  else {
    var /*String*/ msg = null;
    try {
      msg = meibo.getMessage("MandatoryField", meibo.getFieldValue(labelField));
    }
    catch (ex) {
    }
    if (msg == null) {
      if (meibo.getUserLanguage() == "fr") {
        msg = "Le champ '" + meibo.getFieldValue(labelField) + "' est obligatoire.";
      }
      else {
        msg = "Field '" + meibo.getFieldValue(labelField) + "' is mandatory.";
      }
    }
    meibo.getField("error").setValue(msg);
    meibo.showField("error", true);
    meibo.setActiveTab(tabNumber);
  }
  return ok;
}

// display search result in a table.
// This function uses input parameters from fields in view and fills a table
// named "results".
function /*void*/ displaySearch(/*String*/ resource, /*String*/ attrs) {

  // compute current page
  var /*int*/ pageSize = parseInt(meibo.getFieldValue("pageSize"));
  var /*int*/ page = parseInt(meibo.getFieldValue("page"));
  var /*int*/ pages = parseInt(meibo.getFieldValue("pages"));

  // populate table
  var /*int*/ start = (page - 1) * pageSize;
  var /*String*/ filter = meibo.getFieldValue("filter");
  var table = meibo.getField("results");
  var /*int*/ nEntries = table.fillInWithQuery(resource, filter, start, pageSize, attrs, meibo.getFieldValue('sortAttribute'));
  if (nEntries == 0) {
    meibo.showField("error", true);
  }
  else {
    // show-hide button
    meibo.showField("error", false);
    meibo.showField("next", page &lt; pages);
    meibo.showField("last", page &lt; pages);
    meibo.showField("previous", page &gt; 1);
    meibo.showField("first", page &gt; 1);
    meibo.getField("range").setValue("Page " + page+ "/" + pages);  
  }
}

// select all lines in a table
function /*void*/ selectAllLines(/*String*/ table) {
  var /*table*/ tab = meibo.getField(table);
  var /*int*/ nbLines = tab.getLength();
  for (var /*int*/ line = 0; line &lt; nbLines; line++) {
    tab.checkRow(line, true);
  }
}

// unselect all lines in a table
function /*void*/ unselectAllLines(/*String*/ table) {
  var /*table*/ tab = meibo.getField(table);
  var /*int*/ nbLines = tab.getLength();
  for (var /*int*/ line = 0; line &lt; nbLines; line++) {
    tab.checkRow(line, false);
  }
}

////////////////////
// Constantes
var GROUPS_SEPARATOR = "|"; // separateur des CN de groupes dans le fichier de configuration des roles/groupes
var ROLES_CONFIG_PREFIX = "BCOM_PROFIL_"; // préfix des clés de roles dans le fichier de configuration des roles/groupes
//var PROPERTIES_FILE_PREFIX = "b-com_TRAVEL";
var ROLES_STRING = "Utilisateur|InitiateurDeplacement|AnalyseurDeplacement|OrganisateurVoyage|DDI|AdminMeibo"; // liste des roles meibo à prendre en compte
var ROLES_ARRAY = ROLES_STRING.split("|");
var DATE_FORMAT = new java.text.SimpleDateFormat("dd/MM/yyyy"); // format d'affichage
var DATETIME_FORMAT = new java.text.SimpleDateFormat("dd/MM/yyyy HH:mm"); // format d'affichage
var SQL_DATE_FORMAT = new java.text.SimpleDateFormat("yyyy-MM-dd"); // format en retour de la base
var SQL_DATETIME_FORMAT = new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
var /*Class*/ INTEGER_CLASS = new Class("java.lang.Integer");
var /*Class*/ LOCALE_CLASS = new Class("java.util.Locale");
var /*Locale*/ USER_LOCALE = LOCALE_CLASS.forLanguageTag(meibo.getUserLanguage());
var /*Class*/ NUMBERFORMAT_CLASS = new Class("java.text.NumberFormat");
var /*NumberFormat*/ NUMBERFORMAT_INSTANCE = NUMBERFORMAT_CLASS.getInstance(USER_LOCALE);
var /*String*/ DB_MULTIVALUE_SEPARATOR = ";"; // séparateur dans les champs texte "multivaluées" en base de données
var /*Class*/ JAVA_CALENDAR_CLASS = new Class("java.util.Calendar");


// nom des variables globales
var GLOBALVAR_CURRENT_USER_ENTRY = "CURRENT_USER_ENTRY";
var GLOBALVAR_CURRENT_USER_ID = "CURRENT_USER_ID";
var GLOBALVAR_BACKUP_FIELDS = "BACKUP_FIELDS";
var GLOBALVAR_BACKUP_SOURCEVIEW_NAME = "BACKUP_SOURCEVIEW_NAME";
var GLOBALVAR_BACKUP_SOURCERESOURCE_NAME = "BACKUP_SOURCERESOURCE_NAME";
var GLOBALVAR_BACKUP_SOURCEDN = "BACKUP_SOURCEDN";
var GLOBALVAR_MAIL_PARAMETERS = "MAIL_PARAMETERS";

/**
 * Récupère un des paramètre de mail gérés en configuration (cf. fonction getProvisioningParameters_Mails)
 * les paramètres sont conservé en variables globales
 */
function /*String*/ getMailParameter(paramName){
  var /*Parameters*/ parameters = meibo.getGlobalVar(GLOBALVAR_MAIL_PARAMETERS);
  if(parameters==null){
    meibo.logDebug("Chargement des paramètres pour les emails");
    parameters = getProvisioningParameters_Mails();
    meibo.setGlobalVar(GLOBALVAR_MAIL_PARAMETERS,parameters);
  }
  return parameters.get(paramName);
}

/**
 * Empile la valeur "value" dans la variable globale "name"
 */
function /*void*/ pushGlobalVar(name, value){
  var stack = meibo.getGlobalVar(name);
  if(stack == null){
    stack = new java.util.Stack();
  }
  stack.push(value);
  meibo.setGlobalVar(name, stack);
}

/**
 * Dépile la valeur de la variable globale "name"
 */
function /*Object*/ popGlobalVar(name){
  var stack = meibo.getGlobalVar(name);
  var value = null;
  if((stack != null) &amp;&amp; (!stack.empty())){
    value= stack.pop();
  }
  return value;
}

/**
 * renvoi la dernière valeur de la variable globale "name"
 * quand c'est une pile
 */
function /*Object*/ peekpGlobalVar(name){
  var stack = meibo.getGlobalVar(name);
  var value = null;
  if((stack != null) &amp;&amp; (!stack.empty())){
    value= stack.peek();
  }
  return value;
}

/**
 * Indique si l'utilisateur est dans le groupe dont le CN est fourni
 */    
function /*boolean*/ isUserInGroup(userDn, groupCn){
  // Recherche en chaine (LDAP_MATCHING_RULE_IN_CHAIN) de la personne dans le(s) groupe(s) role(s)
  // cf. https://msdn.microsoft.com/en-us/library/windows/desktop/aa746475%28v=vs.85%29.aspx
  var roleRS = meibo.executeResource("GroupAll","(&amp;(member:1.2.840.113556.1.4.1941:=" + userDn + ") (CN=" + groupCn + ") )",0,"dn");
  return roleRS.getEntryCount()&gt;0;
}

/**
 * Renvoi un resultSet des membres (People) directs ou indirects du groupe
 */
function /*ResultSet&lt;People&gt;*/ getRecursiveGroupMembers(groupDN){
  // cf. https://msdn.microsoft.com/en-us/library/windows/desktop/aa746475%28v=vs.85%29.aspx
  var userRS = meibo.executeResource("People","(memberOf:1.2.840.113556.1.4.1941:=" + groupDN + ")",0,"dn,cn,mail");
  return userRS;
}

/**
 * Renvoi un Set des membres (People) directs ou indirects des groupes dont les Cn sont fournis
 */
function /*Set&lt;People&gt;*/ getRecursiveGroupMembersFromGroupNames(groupCnArray){
  var userRS = new java.util.HashSet();
  var /*ResultSet*/ groupRS = null;
  var /*ResultSet*/ memberRS = null;
  var /*Entry*/ groupEntry = null;
  for each(var groupCn in groupCnArray){
    groupRS = meibo.executeResource("GroupAll","(cn=" + groupCn + ")",1,"dn");    
    if((groupRS!=null) &amp;&amp; (groupRS.getEntryCount()&gt;0)){
      groupEntry = groupRS.getEntry();
      memberRS = getRecursiveGroupMembers(groupEntry.dn[0]);
      for each(var memberEntry in memberRS){
        userRS.add(memberEntry);
      }
    }else{
      meibo.logWarn("Pas de groupe trouvé pour le CN " + groupCn);
    }
  }
  return userRS;
}

/**
 * Renvoi un Set des membres (People) directs ou indirects des groupes associés au role dont ne nom est fourni
 */
function /*Set&lt;People&gt;*/ getRecursiveGroupMembersForRole(roleName){
  var userRS = new java.util.HashSet();
  var parameters_groupsMapping = getProvisioningParameters_Droit();
  // recupere les CN des groupes associé au role
  var roleGroupsCN = parameters_groupsMapping.get(ROLES_CONFIG_PREFIX+ roleName);  
  if(roleGroupsCN==null){
    meibo.logWarn("Pas de configuration trouvée pour le role " + roleName);
  }else{
    var roleGroupsCNarray=roleGroupsCN.split(GROUPS_SEPARATOR);
    userRS = getRecursiveGroupMembersFromGroupNames(roleGroupsCNarray);
  }
  return userRS; 
}

/**
 * Indique si l'utilisateur a le role fourni (d'après ses groupes AD)
 */    
function /*boolean*/ userHasRole(userDn, roleName, parameters_groupsMapping){
  // recupere les CN des groupes associé au role
  var roleGroupsCN = parameters_groupsMapping.get(ROLES_CONFIG_PREFIX+ roleName);
  if(roleGroupsCN==null){
    meibo.logWarn("Pas de configuration trouvée pour le role " + roleName);
  }else{
    var roleGroupsCNarray=roleGroupsCN.split(GROUPS_SEPARATOR);
    // recherche le 1er groupe correspondant au role
    for each(var roleGroup in roleGroupsCNarray){
      if(isUserInGroup(userDn, roleGroup)){
        return true;
      }
    }
  }
  return false;
}

/**
 * Affecte les roles de l'utilisateur (d'après ses groupes AD et le mapping roles/groupes configuré)
 */
function /*void*/ setUserRoles(userDn){
  //récupération des paramètres des fichiers properties (mapping CN de groupes AD / nom de role meibo)
  var parameters_groupsMapping = getProvisioningParameters_Droit();
  // parcours des roles definis et ajout si affecté à l'utilisateur d'après l'AD
  meibo.logDebug("Roles Meibo de l'utilisateur "  + userDn + ":");
  for each(var roleName in ROLES_ARRAY){
    if(userHasRole(userDn, roleName, parameters_groupsMapping)){
      meibo.addUserRole(roleName);
      meibo.logDebug("role : " + roleName);
    }
  }             
}

/**
 * Renvoi le contenu d'un tableau Array sous forme de chaine de caractères, avec le séparateur indiqué
 */
function /*String*/ arrayToString(array, separator){
  var resultString = null;
  if(array!=null){
    for each(var item in array){
      if(resultString == null){
        resultString = item;
      }else{
        resultString = resultString + separator + item;
      }
    }
  }
  return resultString;
}

/**
 * Retourne un array constitué des attributs 'attributeName' des entrées du ResultSet
 */
function /*Array*/ resultSetToArray(resultSet, attributeName){
   var array = new Array(resultSet.getEntryCount());
   var i=0;
   for each(var entry in resultSet){
    array[i] = entry.getAttribute(attributeName)[0];
    i++;    
   }
   return array;
}

/**
 * Recherche le(s) personnes "manager" de l'utilisateur
 * Le manager est celui (ou ceux) qui a (ont) le role de directeur associé au role fonctionnel de l'utilisateur
 * retour sous la forme d'un ResultSet de People
 */
function /*ResultSet&lt;People&gt;*/ getManager(userDn){
  return meibo.executeLink("UserManager",userDn);
}
 
/**
 * Sauvegarde en variables globales le contenu des champs pour une utilisation ultérieure
 * Permet de gérer les aller-retours entre formulaires
 */
function /*void*/ backupFields(currentViewResourceName){
  var /*String*/ fieldNamesStr= meibo.getNamedFields();
  var /*Array*/ fieldNamesArray = fieldNamesStr.split(",");

  var /*Array*/ fields = new Array(fieldNamesArray.length);
  //var /*Array*/ fieldValues = new Array(fieldNamesArray.length);
  var fieldName= null;
  var fieldValue=null;
  var field=null;
  var fieldType = null;
  
  for(var i=0;i&lt;fieldNamesArray.length;i++){
    fieldName = fieldNamesArray[i];
    field = meibo.getField(fieldName);
    fieldType = typeof(field);
    
    if(fieldType == "field.Edit"){
      fields[i]= field;
      fieldValue = field.getContents();
      //fieldValues[i]= fieldValue;
    }else if((fieldType == "field.Choice") || (fieldType == "field.Calendar") || (fieldType == "field.Check")){
      fields[i]= field;
      fieldValue = meibo.getFieldValue(fieldName)
      //fieldValues[i]= fieldValue;    
    }
  }
  pushGlobalVar(GLOBALVAR_BACKUP_FIELDS + currentViewResourceName + "_" + meibo.getViewName() , fields);
  //pushGlobalVar(GLOBALVAR_BACKUP_FIELDS + "_values_" + currentViewResourceName + "_" + meibo.getViewName() , fieldValues);
}
 
/**
 * Restore le contenu des champs qui aurait éventuellement été sauvegardé en variables globales
 * (permet de gérer aller-retour entre formulaires)
 */
function /*void*/ restoreFields(currentViewResourceName){
  var /*Array*/ backupFields = popGlobalVar(GLOBALVAR_BACKUP_FIELDS + currentViewResourceName + "_" + meibo.getViewName());
  //var /*Array*/ backupFieldsValues = popGlobalVar(GLOBALVAR_BACKUP_FIELDS + "_values_" + currentViewResourceName + "_" + meibo.getViewName());

  if(backupFields!=null){
    var /*String*/ fieldNamesStr= meibo.getNamedFields();
    var /*Array*/ fieldNamesArray = fieldNamesStr.split(",");

    var fieldName= null;
    var fieldValue=null;
    //var fieldValue2=null;
    var field=null;
    var backupField=null;
    var fieldType = null;

    for(var i=0;i&lt;fieldNamesArray.length;i++){
      fieldName = fieldNamesArray[i];
      field = meibo.getField(fieldName);
      fieldType = typeof(field);
      backupField = backupFields[i];
      if(backupField!=null){
        if(fieldType == "field.Edit"){
          fieldValue = backupField.getContents();
          if(fieldValue!=null){
            //fieldValue2 = backupField;
            field.setContents(fieldValue);
          }
        }else if((fieldType == "field.Choice") || (fieldType == "field.Calendar") || (fieldType == "field.Check")){
          fieldValue = backupField.getValue();
          //fieldValue2 = backupField;
          field.setValue(fieldValue);
        }
        //TODO : contenu des tableaux
      }
    }
  }
} 

/**
 * Sauvegarde infos et données de la vue courante
 * (permet de gérer aller-retour entre formulaires via backToSourceView())
 * passer en paramètre le nom de la ressource associée à la vue (car il n'existe pas de fonction meibo pour récupérer cette information)
 */
function /*void*/ backupView(currentViewResourceName){
  backupFields(currentViewResourceName);
  pushGlobalVar(GLOBALVAR_BACKUP_SOURCEVIEW_NAME, meibo.getViewName());
  var dn= meibo.getCurrentDn();
  if(dn!=null){
    pushGlobalVar(GLOBALVAR_BACKUP_SOURCEDN, meibo.getCurrentDn());
  }else{
    pushGlobalVar(GLOBALVAR_BACKUP_SOURCEDN, "");
  }  
  pushGlobalVar(GLOBALVAR_BACKUP_SOURCERESOURCE_NAME, currentViewResourceName);
  var entry=meibo.getCurrentEntry();
 
}

/**
 * Indique si une vue source est définie en variable globale pour y effectuer un retour
 */
function /*void*/ hasSourceView(){
  var /*Object*/ value = peekpGlobalVar(GLOBALVAR_BACKUP_SOURCEVIEW_NAME);
  return (value!=null);
}

/**
 * Retour à la vue d'où l'on vient, si celle-ci est définie en variable globale
 * Implique d'avoir appelé backupView() avant de quitter la vue
 */
function /*void*/ backToSourceView(){
  var /*String*/ sourceViewName = popGlobalVar(GLOBALVAR_BACKUP_SOURCEVIEW_NAME);
  var /*String*/ sourceResourceName = popGlobalVar(GLOBALVAR_BACKUP_SOURCERESOURCE_NAME);
  var /*String*/ sourceDn = popGlobalVar(GLOBALVAR_BACKUP_SOURCEDN);
  if(sourceDn==""){
    sourceDn=null;
  }  
  if((sourceViewName!=null) &amp;&amp; (sourceResourceName!=null)){
    meibo.switchToResourceView(sourceResourceName,sourceDn,sourceViewName);
  }
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Fonctions concernent la vue de création d'évenement 
// (Elles sont mise ici dans le script partagé pour pouvoir être appelée depuis le formulaire de création d'evenement, lors du retour vers la création de mission)
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/**
 * Met à jour le contenu du tableau avec les évenements sélectionnés
 * Cette fonction ne sert que dans le cadre du formulaire de création de mission
 */
function /*void*/ updateEventsTableContent(){
  //var /*Field2*/ attendeesField =  meibo.getField("ATTENDEES_TCT_ID");
  //var /*Attribute*/ values = attendeesField.getValues();
  // on devrait utiliser attendeesField.getValues() conformément à la doc, mais en pratique dans notre version la methode n'existe pas
  var /*Attribute*/ values = meibo.getFieldValues("ATTENDEES_TCT_ID");
  if(values!=null){
    var /*Field*/table = meibo.getField("EVENTS_TABLE");

    var removeBtn = meibo.getField("REMOVE_BTN");

    var /*Attribute*/ newValues = new Attribute();
    var /*Set*/ oldValuesSet = new java.util.HashSet();

    // collecte des anciennes valeurs
    for(var i=0; i&lt;table.getLength();i++){
      oldValuesSet.add(table.getRowObject(i));
    }
    // constitution des nouvelles valeurs
    for each(var value in values){
      if(!(oldValuesSet.contains(value))){
        newValues.addValue(value);
      }
    }

    if(newValues.getCount()&gt;0){
    // ajout des nouveaux évenements dans le tableau

      var /*Entry*/ eventEntry = null;
      var /*ResultSet*/ eventRS = null;
      var line = table.getLength();
      var /*Date*/ startDate = null;
      var /*Date*/ endDate = null;
      var /*int*/ duration =0;

      var valStr = newValues.getValues().toString();
      var valStr2 = valStr.substring(1, valStr.length-1); // on supprime les crochets du toString
      
      // recherche des données sur les évenements sélectionnés  
      eventRS = meibo.executeResource("Event","fkTCT_ID in (" + valStr2 + ")",0, "TET_NAME,TCT_START_DATE,TCT_DURATION");

      for each(var eventEntry in eventRS){
        
        startDate = SQL_DATE_FORMAT.parse(eventEntry.TCT_START_DATE[0]);
        duration = INTEGER_CLASS.parseInt(eventEntry.TCT_DURATION[0]);
        if(duration&gt;0){
          // si un evt dure 1 journée par exemple, alors la date de fin est en fait la même que la date de début, donc on retranche 1 à la durée
          duration = duration -1;
        }
        endDate = addDays(startDate, duration);

        if((table.getRowObject(line) == null) || (table.getRowObject(line) != eventEntry.fkTCT_ID[0])){
          table.addRowObject(line, eventEntry.fkTCT_ID[0]);
          table.addCell(line,0,eventEntry.TET_NAME[0]);
          table.addCell(line,1,DATE_FORMAT.format(startDate));
          table.addCell(line,2,DATE_FORMAT.format(endDate));
          table.addCell(line,3,"A DEFINIR");
          table.addCell(line,4,"A DEFINIR");
        }
        line++;    
      }
      showEventFieldsForRow(0);  
      removeBtn.show(true);

    }else{
      meibo.getField("PARTICIPATION_BLOC").show(false);
      meibo.setFieldValue("ROW_INDEX","-1");
      removeBtn.show(false);
    }
  }
}

/**
 * Pousse dans la ligne correspondante du tableau les données courantes du formulaire
 * Cette fonction ne sert que dans le cadre du formulaire de création de mission
 */
function /*void*/ pushEventFieldsDataInTable(){
  var /*Table*/table = meibo.getField("EVENTS_TABLE");
  var previousRowIndex= getSelectedRowIndex(); 
  if(previousRowIndex &gt;=0){
    table.addCell(previousRowIndex,1,meibo.getFieldValue("START_DATE"));
    table.addCell(previousRowIndex,2,meibo.getFieldValue("END_DATE"));
    table.addCell(previousRowIndex,3,meibo.getFieldValue("PURPOSE"));
    table.addCell(previousRowIndex,4,meibo.getFieldValue("INVOLVEMENT"));
  }
}

/**
 * Affiche champs et valeurs correspondants à la ligne rowIndex
 * Cette fonction ne sert que dans le cadre du formulaire de création de mission
 */
function /*void*/ showEventFieldsForRow(rowIndex){
  var /*Table*/table = meibo.getField("EVENTS_TABLE");
  meibo.getField("PARTICIPATION_BLOC").show(true);

  // sauvegarder au préalable les valeurs des champs
  pushEventFieldsDataInTable();

  var /*String*/ name = table.getCell(rowIndex,0);
  var /*String*/ startDate = table.getCell(rowIndex,1);
  var /*String*/ endDate = table.getCell(rowIndex,2);
  var /*String*/ purpose = table.getCell(rowIndex,3);
  var /*String*/ involvement = table.getCell(rowIndex,4);

  meibo.setFieldValue("ROW_INDEX",""+ rowIndex);
  meibo.setFieldValue("EVENT_NAME",name);
  meibo.setFieldValue("START_DATE",startDate);
  meibo.setFieldValue("END_DATE",endDate);
  meibo.setFieldValue("PURPOSE",purpose);
  meibo.setFieldValue("INVOLVEMENT",involvement);
}

/**
 * retourne la ligne du tableau sélectionnée (-1 si pas de ligne sélectionnée)
 */              
function /*int*/ getSelectedRowIndex(){
  var rowIndex = -1;
  if((meibo.getFieldValue("ROW_INDEX")!=null) &amp;&amp; (meibo.getFieldValue("ROW_INDEX")!="")){
    rowIndex= INTEGER_CLASS.parseInt(meibo.getFieldValue("ROW_INDEX"));
  }
  return rowIndex;
}

/**
 * Pour les ressources qui portent une abbréviation en plus de l'ID
 * Permet de récupérer l'ID pour une valeur d'abbréviation 
 */
function /*int*/ getIdFromAbbrev(resourceName, resourcePrefix, abbrev){
  var rs = meibo.executeResource(resourceName, resourcePrefix + "_ABBREV='"+ abbrev + "'", 1, resourcePrefix + "_ID");
  var id = null;
  if((rs!=null) &amp;&amp; (rs.getEntryCount()&gt;0)){
    var entry = rs.getEntry();
    id= entry.getAttributeValue(resourcePrefix + "_ID",0);
  }else{
    throw "Impossible de recuperer l ID correspondant à la ressource  " + resourceName + " avec l'abbréviation "  + abbrev;
  }
  return id;
}

/**
 * Met à jour le statut d'une mission
 */
function /*void*/ updateMissionStatus(missionId, actorId, newStatusAbbrev, comment){
  var statusId = getIdFromAbbrev("Status","TST", newStatusAbbrev);
  var /*Entry*/ missionStatusEntry = new Entry();
  missionStatusEntry.updateAttribute(new Attribute("TST_ID",statusId));
  missionStatusEntry.updateAttribute(new Attribute("PRS_ID",actorId));
  missionStatusEntry.updateAttribute(new Attribute("TMN_ID",missionId));
  missionStatusEntry.updateAttribute(new Attribute("TST_TMN_DATE", SQL_DATETIME_FORMAT.format(new java.util.Date())));
  if((comment!=null) &amp;&amp; (comment.length&gt;0)){
    missionStatusEntry.updateAttribute(new Attribute("TST_TMN_COMMENT",comment));
  }
  var entryCreationOK = meibo.createEntry("R_MissionStatus",null,missionStatusEntry);
  if(!entryCreationOK){
    meibo.logError("Echec de création de l'entrée " + missionStatusEntry);
    throw "Impossible de définir le statut de la mission";
  }
}

/**
 * Met à jour le statut d'un compte-rendu
 */
function /*void*/ updateReportStatus(reportId, actorId, newStatusAbbrev, comment){
  var RESOURCE_NAME= "R_ReportStatus";
  // Note: actuellement l'implémentation de la table/ressource ne permet pas de gérér historique, date et commentaire
  var statusId = getIdFromAbbrev("Status","TST", newStatusAbbrev);
  var /*Entry*/ reportStatusEntry = new Entry();
  reportStatusEntry.updateAttribute(new Attribute("TST_ID",statusId));
  reportStatusEntry.updateAttribute(new Attribute("PRS_ID",actorId));
  reportStatusEntry.updateAttribute(new Attribute("TRT_ID",reportId));
  /*
  reportStatusEntry.updateAttribute(new Attribute("TST_TMN_DATE", SQL_DATETIME_FORMAT.format(new java.util.Date())));
  if((comment!=null) &amp;&amp; (comment.length&gt;0)){
    reportStatusEntry.updateAttribute(new Attribute("TST_TMN_COMMENT",comment));
  }
  */
  var entryOK = false;
  var /*ResultSet*/ rs = meibo.executeResource(RESOURCE_NAME,"TST_ID=" + statusId + " AND PRS_ID=" + actorId + " AND TRT_ID=" + reportId,1);
  if((rs!=null) &amp;&amp; (rs.getEntry()!=null)){
  // entrée trouvée : modification
    entryOK = meibo.updateEntry(RESOURCE_NAME,rs.getEntry().getDn(),reportStatusEntry);
  }else{
  // non trouvée: création
    entryOK = meibo.createEntry(RESOURCE_NAME,null,reportStatusEntry);
  }
  if(!entryOK){
    meibo.logError("Echec de création/mise à jour de l'entrée " + reportStatusEntry);
    throw "Impossible de définir le statut du compte rendu";
  }
}

/**
 * Renvoi l'URL de base Meibo à utiliser pour un lien sur une tache de workflow
 */
function /*String*/ getBaseURLForWorkflow(){
  return meibo.getMeiboBaseUrl() + "dsddores?external=true&amp;frames=true";
}

/**
 * contournement du fonctionnement meibo qui ne prend en compte que la première valeur des champs multivalués dans le cas d'une ressource de type base de données
 */
function /*void*/ fixMultiValueFieldsOnSubmit(fieldName){
  var /*Edit*/field = meibo.getField(fieldName);
  if((field.getContents()!=null) &amp;&amp; (field.getContents().length&gt;0)){
    meibo.setFieldValue(fieldName,arrayToString(field.getContents(),DB_MULTIVALUE_SEPARATOR));
  }else{
    meibo.setFieldValue(fieldName,null);
  }
}

/**
 * contournement du fonctionnement meibo qui ne prend en compte que la première valeur des champs multivalués dans le cas d'une ressource de type base de données
 */
function /*void*/ fixMultiValueFieldsOnLoad(fieldName){
  var /*Edit*/field = meibo.getField(fieldName);
  if((field.getContent()!=null) &amp;&amp; (field.getContent()!="")){
    field.setContents(field.getContent().split(DB_MULTIVALUE_SEPARATOR));
  }else{
    field.setContents(new Array());
  }
}

/**
 * Retourne la date additionnée de days jours
 * (dates au format Java)
 */
function /*java.util.Date*/ addDays(javaDate, days){
  var /*java.util.Calendar*/ javaCalendar = JAVA_CALENDAR_CLASS.getInstance();
  javaCalendar.setTime(javaDate);
  javaCalendar.add(JAVA_CALENDAR_CLASS.DATE, days);
  return javaCalendar.getTime();
}

/**
 * Renvoi le contenu de la mission au format HTML
 */
function /*String*/ getHtmlMissionContent(missionID){
  var /*String*/ htmlContent="&lt;table&gt;&lt;tr&gt;&lt;th&gt;" + meibo.getMessage("eventsTable_name") + "&lt;/th&gt;&lt;th&gt;" + meibo.getMessage("eventsTable_date1") + "&lt;/th&gt;&lt;th&gt;" + meibo.getMessage("eventsTable_date2") + "&lt;/th&gt;&lt;th&gt;" + meibo.getMessage("eventsTable_purpose") + "&lt;/th&gt;&lt;th&gt;" + meibo.getMessage("eventsTable_involvement") + "&lt;/th&gt;&lt;/tr&gt;";
  
  var /*ResultSet*/ missionRS = meibo.executeResource("Mission","TMN_ID=" + missionID ,1,"PRS_ID");
  var /*Entry*/ missionEntry = missionRS.getEntry();  
  var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", missionEntry.dn[0],"fkTCT_ID,TET_NAME");  
  var /*ResultSet*/ eventAttendeesRS = null;
  var /*Entry*/ eventAttendeesEntry = null;

  for each(var missionEvent in missionEventRS){
    htmlContent= htmlContent +  "&lt;tr&gt;&lt;td&gt;";
    htmlContent= htmlContent +  missionEvent.TET_NAME[0];
    htmlContent= htmlContent + "&lt;/td&gt;&lt;td&gt;";
    
    eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID=" + missionEntry.PRS_ID[0] + " AND TCT_ID=" + missionEvent.fkTCT_ID[0] ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
    eventAttendeesEntry = eventAttendeesRS.getEntry();

    htmlContent= htmlContent +  DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0]));
    htmlContent= htmlContent + "&lt;/td&gt;&lt;td&gt;";
    htmlContent= htmlContent +  DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0]));
    htmlContent= htmlContent + "&lt;/td&gt;&lt;td&gt;";
    htmlContent= htmlContent +  eventAttendeesEntry.TPE_NAME[0];
    htmlContent= htmlContent + "&lt;/td&gt;&lt;td&gt;";
    htmlContent= htmlContent +  eventAttendeesEntry.TIN_NAME[0];    
    htmlContent= htmlContent +  "&lt;/td&gt;&lt;/tr&gt;";
  } 
  
  htmlContent= htmlContent +  "&lt;/table&gt;";
  
  return htmlContent;
}

/////////////////////
//  Fin de script  //
/////////////////////</globalscript>
      <onstartscript class="script">///$debug
/**/
/* Script qui s'exécute lors de la connexion de l'application */
/**/

/////////////////////
// Debut du script //
/////////////////////

/////////////////////
//       test      //
/////////////////////

/////////////////////
//    fin  test    //
/////////////////////
 
meibo.logInfo("Utilisateur connecté : " + meibo.getUserDn());
var currentUserEntry = meibo.getDnEntry("People", meibo.getUserDn(),"cn,displayName,givenName,sn,PRS_ID");
if(currentUserEntry.PRS_ID==null){
  meibo.logWarn("Pas d'entrée trouvée dans la table PERSON pour l'utilisateur connecté : " + meibo.getUserDn());
}else{
  meibo.logDebug("PRS_ID de l'utilisateur connecté : " + currentUserEntry.PRS_ID[0]);
  meibo.setGlobalVar(GLOBALVAR_CURRENT_USER_ID, currentUserEntry.PRS_ID[0]);
}
meibo.setGlobalVar(GLOBALVAR_CURRENT_USER_ENTRY, currentUserEntry);

//meibo.setUserID(currentUserEntry.PRS_ID[0]);

meibo.showResourceViewCommands(false);

// initialisation des ressources
initializeResources();

/*récupération des paramètres des fichiers properties (mapping CN de groupes AD / nom de role meibo) /*/
var parameters_groupsMapping = getProvisioningParameters_Droit();
//var parameters_general = getProvisioningParameters_General();
var mailParameters = getProvisioningParameters_Mails();
meibo.setGlobalVar("MailParameters", mailParameters);

// Mécanisme de filtre sur People récupéré du projet IAM
//Changement du filtre

var filtre = "";
var resultset = meibo.executeResource("RoleStatusSansExterne","(cn=*)",0);
if ( resultset.getEntryCount() &gt; 0 ) {
  var i = 0;
  while ( i &lt; resultset.getEntryCount() ){
    var dnGrp = resultset.getEntry(i).getAttributeValue("dn");
    if ( i == 0 ){
      filtre = "(memberOf="+dnGrp+")";
    }
    else{
      filtre = filtre + "(memberOf="+dnGrp+")";
    }
    i++;
  }
  if ( i &gt; 1 ){
    filtre = "(|"+filtre+")";
  }
}

//
//if ( filtre != "" ){
//  filtre = "(&amp;(!(memberOf="+parameters_general.get("BCOM_GGU_USERS_EXTERNAL")+"))"+filtre+")";
//}
//
//else{
//
//
//}

if ( filtre != "" ){
  //meibo.changeResourceFilter("People",filtre);
}

//Récupération du DN de l'utilisateur connecté
var userDN = meibo.getUserDn();

if((userDN!=null) &amp;&amp; (userDN!="")){

  //affectation des roles
  setUserRoles(userDN);

  //Ajout du DN dans les roles pour le workflow
  userDN = userDN.toLowerCase(); //-- mise en miniscule du DN de de l'utilisateur
  var profilMeibo = meibo.getUserRoles(); //-- récupération des profil Meibo de l'utilisateur de type Array
  var nbProfil = profilMeibo.length(); //-- Calcul du nombre de profil Meibo de l'utilisateur 
  profilMeibo[nbProfil] = userDN; //-- Ajout du Dn à la fin du tableau des profils meibo de l'utilisateur
  meibo.setWorkflowRoles(profilMeibo); // Initialisation des roles workflow
}
/////////////////////
// fin du script //
/////////////////////</onstartscript>
      <onstopscript class="script">meibo.logInfo("fin de session de  : " + meibo.getUserDn());</onstopscript>
    </globalsettings>
  </mask>
  <settings>
    <screenwidth>1600</screenwidth>
    <screenheight>900</screenheight>
    <backcolor>FFFFFF</backcolor>
    <backcolorhtml>9999FF</backcolorhtml>
    <tabtitlecolor>000000</tabtitlecolor>
    <htmltitlecolor>000000</htmltitlecolor>
    <logo/>
    <defaultfont>Arial,plain,12</defaultfont>
    <skin>none</skin>
    <guimodel>Default</guimodel>
    <flatmenu>false</flatmenu>
    <scripterNewFeatures>true</scripterNewFeatures>
    <newTooltipFeatures>true</newTooltipFeatures>
    <languages>fr</languages>
    <defaultlanguage>fr</defaultlanguage>
    <version>5.1.12.3</version>
    <applicativeRightFeatures>true</applicativeRightFeatures>
    <workflowTasksFeatures>true</workflowTasksFeatures>
    <defaultTheme>overcast</defaultTheme>
    <defaultcss/>
    <hiddenAttributesFeatures>userPassword</hiddenAttributesFeatures>
  </settings>
  <styles auto="A -&gt; Z">
    <style name="_000000__FFFFFF__000000_0">
      <properties>
        <font class="font"/>
        <color class="color">000000</color>
        <opaque class="boolean">false</opaque>
        <bgcolor class="color">FFFFFF</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">0</linethickness>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="calendarBody">
      <properties>
        <font class="font">Arial,plain,16</font>
        <color class="color">000000</color>
        <opaque class="boolean">true</opaque>
        <bgcolor class="color">9999FF</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">1</linethickness>
        <extraparms class="textarea">text-decoration:none;</extraparms>
      </properties>
    </style>
    <style name="calendarHead">
      <properties>
        <font class="font">Arial,bold,16</font>
        <color class="color">FFFFFF</color>
        <opaque class="boolean">true</opaque>
        <bgcolor class="color">9999FF</bgcolor>
        <framed class="boolean">true</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">1</linethickness>
        <extraparms class="textarea">text-decoration:none;
cursor:default;</extraparms>
      </properties>
    </style>
    <style name="Dialog_bold_12_000000_Opaque_FFFFFF__000000_">
      <properties>
        <font class="font">Dialog,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">true</opaque>
        <bgcolor class="color">FFFFFF</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number"/>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="Dialog_bold_12_000000_Opaque_FFFFFF__000000_">
      <properties>
        <font class="font">Dialog,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">true</opaque>
        <bgcolor class="color">FFFFFF</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number"/>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="errorMessage">
      <properties>
        <font class="font">Dialog,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">true</opaque>
        <bgcolor class="color">FF0000</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">1</linethickness>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="info">
      <properties>
        <font class="font">Dialog,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">false</opaque>
        <bgcolor class="color">FFFF99</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">1</linethickness>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="labelField">
      <properties>
        <font class="font">Verdana,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">false</opaque>
        <bgcolor class="color">FFFFFF</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">0</linethickness>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="pickerHead">
      <properties>
        <font class="font">Arial,bold,16</font>
        <color class="color">FFFFFF</color>
        <opaque class="boolean">true</opaque>
        <bgcolor class="color">9999FF</bgcolor>
        <framed class="boolean">true</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">1</linethickness>
        <extraparms class="textarea">cursor:default;</extraparms>
      </properties>
    </style>
    <style name="Verdana_bold_12_000000__CCCCCC__000000_">
      <properties>
        <font class="font">Verdana,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">false</opaque>
        <bgcolor class="color">CCCCCC</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number"/>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="Verdana_bold_12_000000__FFFFFF__000000_1">
      <properties>
        <font class="font">Verdana,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">false</opaque>
        <bgcolor class="color">FFFFFF</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">1</linethickness>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="Verdana_bold_12_000000__CCCCCC__000000_">
      <properties>
        <font class="font">Verdana,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">false</opaque>
        <bgcolor class="color">CCCCCC</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number"/>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="Verdana_bold_16_000000__FFFF99__000000_1">
      <properties>
        <font class="font">Verdana,bold,16</font>
        <color class="color">000000</color>
        <opaque class="boolean">false</opaque>
        <bgcolor class="color">FFFF99</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">1</linethickness>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="Verdana_bold_12_000000__FFFF99__000000_1">
      <properties>
        <font class="font">Verdana,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">false</opaque>
        <bgcolor class="color">FFFF99</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number">1</linethickness>
        <extraparms class="textarea"/>
      </properties>
    </style>
    <style name="Dialog_bold_12_000000_Opaque_FFFFFF__000000_">
      <properties>
        <font class="font">Dialog,bold,12</font>
        <color class="color">000000</color>
        <opaque class="boolean">true</opaque>
        <bgcolor class="color">FFFFFF</bgcolor>
        <framed class="boolean">false</framed>
        <framecolor class="color">000000</framecolor>
        <linethickness class="number"/>
        <extraparms class="textarea"/>
      </properties>
    </style>
  </styles>
  <syntaxes auto="A -&gt; Z">
    <syntax name="alpha">
      <properties>
        <regexp class="regexp">^[A-Za-z àâéèëêïîôöùüûÿç\-]+$</regexp>
        <error class="lingual">
          <fr>Alphabetic</fr>
        </error>
      </properties>
    </syntax>
    <syntax name="alphanumeric">
      <properties>
        <regexp class="regexp">^[A-Za-z0-9 àâéèëêïîôöùüûÿç\-]+$</regexp>
        <error class="lingual">
          <fr>Alphanumeric</fr>
        </error>
      </properties>
    </syntax>
    <syntax name="alphanumericBadge">
      <properties>
        <regexp class="regexp">^[A-Za-z0-9 àâéèëêïîôöùüûÿç\-]+$</regexp>
        <error class="lingual">
          <fr>Erreur de syntaxe du numéro de badge</fr>
        </error>
      </properties>
    </syntax>
    <syntax name="float">
      <properties>
        <regexp class="regexp"/>
        <error class="lingual">
          <fr>???</fr>
        </error>
      </properties>
    </syntax>
    <syntax name="numeric">
      <properties>
        <regexp class="regexp">^[0-9]+$</regexp>
        <error class="lingual">
          <fr>Numeric</fr>
        </error>
      </properties>
    </syntax>
    <syntax name="numericMobile">
      <properties>
        <regexp class="regexp">^(\+33(([\s])[6-7]{1})(([\s])[0-9]{2}){2}(([\s])[0-9]{2})(([\s])[0-9]{2}))*$</regexp>
        <error class="lingual">
          <fr>Erreur de syntaxe du numéro de téléphone mobile</fr>
        </error>
      </properties>
    </syntax>
    <syntax name="numericTelephone1">
      <properties>
        <regexp class="regexp">^\+33(([\s])[1-5]{1})(([\s])[0-9]{2}){2}$</regexp>
        <error class="lingual">
          <fr>Erreur de syntaxe du numéro de téléphone fixe</fr>
        </error>
      </properties>
    </syntax>
    <syntax name="numericTelephone2">
      <properties>
        <regexp class="regexp">^[0-9]{2}(([\s])[0-9]{2})$</regexp>
        <error class="lingual">
          <fr>Erreur de syntaxe du numéro de ipPhone</fr>
        </error>
      </properties>
    </syntax>
    <syntax name="webURL">
      <properties>
        <regexp class="regexp">^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$</regexp>
        <error class="lingual">
          <fr>URL de site web</fr>
        </error>
      </properties>
    </syntax>
  </syntaxes>
  <messages auto="A -&gt; Z">
    <message name="calendarDisplayPattern">
      <properties>
        <content class="lingual">
          <fr>dd/MM/yyyy</fr>
        </content>
      </properties>
    </message>
    <message name="eventsTable_date1">
      <properties>
        <content class="lingual">
          <fr>???</fr>
        </content>
      </properties>
    </message>
    <message name="eventsTable_date2">
      <properties>
        <content class="lingual">
          <fr>???</fr>
        </content>
      </properties>
    </message>
    <message name="eventsTable_involvement">
      <properties>
        <content class="lingual">
          <fr>???</fr>
        </content>
      </properties>
    </message>
    <message name="eventsTable_name">
      <properties>
        <content class="lingual">
          <fr>Nom</fr>
        </content>
      </properties>
    </message>
    <message name="eventsTable_purpose">
      <properties>
        <content class="lingual">
          <fr>Objectif</fr>
        </content>
      </properties>
    </message>
    <message name="justifyRejection">
      <properties>
        <content class="lingual">
          <fr>Merci de justifier votre rejet</fr>
        </content>
      </properties>
    </message>
    <message name="mandatoryField">
      <properties>
        <content class="lingual">
          <fr>Le champ "{0}" est obligatoire</fr>
        </content>
      </properties>
    </message>
  </messages>
  <datasources auto="A -&gt; Z">
    <datasource auto="A -&gt; Z" name="ActiveDirectory" type="LDAP">
      <properties>
        <JNDIUrl class="text">ldap://10.2.10.10:389</JNDIUrl>
        <Domain class="text">DC=pprb-com,DC=local</Domain>
        <Enabled class="boolean">true</Enabled>
        <ConnectionObliged class="boolean">true</ConnectionObliged>
        <SecurityProtocol class="securityprotocol">SSL</SecurityProtocol>
        <separator class="separator"/>
        <UseForAuthentication class="boolean">true</UseForAuthentication>
        <UserBase class="dn">OU=Persons,OU=People,DC=pprb-com,DC=local</UserBase>
        <UserFilter class="filter">(&amp; (objectClass=user)(!(memberOf=CN=GGU-USERS-EXTERNAL,OU=Users,OU=Groups,OU=People,DC=pprb-com,DC=local)))</UserFilter>
        <UserScope class="scope">SUBTREE</UserScope>
        <UserAttribute class="text">sAMAccountName</UserAttribute>
        <UserUseGeneric class="boolean">true</UserUseGeneric>
        <separator class="separator"/>
        
        
        
        <separator class="separator"/>
        <UserSecurityAuthentication class="authenticationmode">kerberos</UserSecurityAuthentication>
        <UseClientLogin class="boolean">false</UseClientLogin>
        <separator class="separator"/>
        <GenericSecurityAuthentication class="authenticationmode">simple</GenericSecurityAuthentication>
        <GenericCheckUser class="boolean">true</GenericCheckUser>
        <GenericDN class="dn">svc-meibo-ldapro</GenericDN>
        <GenericPassword class="password">{dQXAwmXc2I6tZcd1szCSJg==}</GenericPassword>
        <separator class="separator"/>
        <WorkflowSecurityAuthentication class="authenticationmode">simple</WorkflowSecurityAuthentication>
        <WorkflowDN class="dn">svc-meibo-ldapro</WorkflowDN>
        <WorkflowPassword class="password">{dQXAwmXc2I6tZcd1szCSJg==}</WorkflowPassword>
        <separator class="separator"/>
        <WebServiceSecurityAuthentication class="authenticationmode">simple</WebServiceSecurityAuthentication>
        <WebServiceDN class="dn"/>
        <WebServicePassword class="password"/>
        <separator class="separator"/>
        <BinaryAttributes class="text"/>
        <separator class="separator"/>
        <ConnectionPoolSize class="number">1</ConnectionPoolSize>
        <ConnectionPoolMax class="number">1</ConnectionPoolMax>
        <ConnectionUseCount class="number">100</ConnectionUseCount>
        <ConnectionTimeOut class="number">120</ConnectionTimeOut>
        <separator class="separator"/>
        <RequestCacheSize class="number">30</RequestCacheSize>
        <RequestTimeToLive class="number">15</RequestTimeToLive>
        <separator class="separator"/>
        <referral class="referral">ignore</referral>
        <separator class="separator"/>
        <pagesize class="number"/>
        <separator class="separator"/>
        <activedirectory class="boolean">true</activedirectory>
        <pwdencoding class="pwdencoding">SHA1</pwdencoding>
      </properties>
      <resource name="Acces">
        <properties>
          <displayname class="lingual">
            <fr>Role</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Access,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,displayName,description,groupType,location,member,memberOf,objectCategory,objectClass,name,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,msSFU30PosixMember,msSFU30PosixMemberOf</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">cn</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">cn</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="Group">
        <properties>
          <displayname class="lingual">
            <fr>Group</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Groups,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,displayName,description,groupType,location,member,memberOf,name,objectCategory,objectClass,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,msSFU30PosixMemberOf,msSFU30PosixMember</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">cn</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">cn</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="GroupAll">
        <properties>
          <displayname class="lingual">
            <fr>Group</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,displayName,description,groupType,location,member,memberOf,name,objectCategory,objectClass,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,msSFU30PosixMember,gidNumber</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">cn</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">cn</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">10000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute">cn</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="GroupLabos">
        <properties>
          <displayname class="lingual">
            <fr>GroupLabos</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Entities,OU=Groups,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,member,groupType,objectClass,objectCategory,name,memberOf,displayName,description,location,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,msSFU30PosixMember,msSFU30PosixMemberOf</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">cn</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">description</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="GroupProject">
        <properties>
          <displayname class="lingual">
            <fr>GroupUser</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Projects,OU=Groups,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,member,groupType,objectClass,objectCategory,name,memberOf,displayName,description,location,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,msSFU30PosixMember,msSFU30PosixMemberOf</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">cn</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">description</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="GroupUser">
        <properties>
          <displayname class="lingual">
            <fr>GroupUser</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Users,OU=Groups,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,member,groupType,objectClass,objectCategory,name,memberOf,displayName,description,location,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,msSFU30PosixMember,msSFU30PosixMemberOf</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">cn</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute"/>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="People">
        <properties>
          <displayname class="lingual">
            <fr>People</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">user</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Persons,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter">(&amp;(!(memberOf=CN=GGU-USERS-EXTERNAL,OU=Users,OU=Groups,OU=People,DC=pprb-com,DC=local))(sn=*))</filter>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>title,cn,objectClass,userPrincipalName,displayName,givenName,sn,name,memberOf,accountExpires,company,description,mobile,telephoneNumber,ipPhone,mail,l,manager,jpegPhoto,activites,badgeID,centreInteret,cv,motsCle,pourcentageMAD,whenArrived,thumbnailPhoto</physical>
            <logical>
              <attribute attrs="" pattern_fr="{0}" resourcelink="PeoplePerson" type="link">PERSON</attribute>
              <attribute attrs="" pattern_fr="{0}" resourcelink="PeopleRolePosition" type="link">POSITION</attribute>
              <attribute attrs="PRS_ID" pattern_fr="{0}" resourcelink="PeoplePerson" type="link">PRS_ID</attribute>
              <attribute attrs="cn" pattern_fr="{0}" resourcelink="PeopleRolePosition" type="link">positionCn</attribute>
              <attribute type="script">displayValue</attribute>
            </logical>
          </return>
          <onRead class="script">var scriptedAttributes = meibo.getParameter("scripted");
var mappedAttributes = meibo.getParameter("mapped");
var linkedAttributes = meibo.getParameter("linked");
var dn = meibo.getCurrentDn();
var entry = meibo.getCurrentEntry();
if(dn==null){
  meibo.logWarn("dn null sur onRead de People");
}else if ((scriptedAttributes !=null) &amp;&amp; ("displayValue" in scriptedAttributes)) {
  // calcul attribut displayValue
  var name=entry.givenName[0];
  var surname=entry.sn[0];
  var login=entry.cn[0];
  if((surname ==null) || (login ==null)){
    // rechargement de l'entrée avec les attributs requis
    var newEntry = meibo.getDnEntry("People", meibo.getCurrentDn(),"sn,givenName,cn");
    name=newEntry.givenName[0];
    surname=newEntry.sn[0];
    login=newEntry.cn[0];
  }
  entry.displayValue = returnEmpty(name) + " " + returnEmpty(surname) + " (" + login + ")";
}</onRead>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">sn</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">displayValue</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">500</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute">sn</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file">images/black-man.gif</imageclosed>
          <imageopened class="file">images/green-user.gif</imageopened>
        </properties>
        
        <sequence name="Ma_Fiche_PERSONNE" type="0">
          <properties>
            <displayname class="lingual">
              <fr>Ma_Fiche_PERSONNE</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>ActiveDirectory_People_Ma_Fiche_PERSONNE.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script">function changeNameAttribute(name,attribute){

  var i = 0;
  var nbValue = attribute.getCount();
  var newAttribute = new Attribute(name);
  while ( i &lt; nbValue ){
    var value = attribute.getValue(i);
    newAttribute.addValue(value);
    i++;
  } 
  
  return newAttribute;
}</globalScriptView>
            <onload class="script">///$debug
/**/
/* Script  de chargement de la fiche utilisateur */
/**/
/**/
/* Script modifié par akerva le 16/05
/**/ 

/////////////////////
// Debut du script //
///////////////////// 

////////////////////////////////////////////////////////////////////////////////////////
//                        MISE EN FORME DES CHAMPS DE LA FICHE
////////////////////////////////////////////////////////////////////////////////////////

//récupération des champs de la fiche

var sn = returnEmpty(meibo.getFieldValue("sn"));
var givenName = returnEmpty(meibo.getFieldValue("givenName"));

var whenArrived = returnEmpty(meibo.getFieldValue("whenArrived"));


var dnPers = meibo.getCurrentDn();

//photo
var photo = "";
var alea = crypto.random(1000);
var thumbnailPhoto = returnEmpty(meibo.getFieldValue("thumbnailPhoto"));
var cn = returnEmpty(meibo.getFieldValue("cn"));
cn = cn.replace(" ","");
if ( thumbnailPhoto != "" ){
  var parameters = getProvisioningParameters_General();
  var folder = parameters.get("BCOM_FOLDER_PHOTO_LECTURE");
  var file =  folder + cn + ".jpg";         

  photo = "&lt;div style=background-image:url('"+file+"?videCache="+alea+"') class=photoTrombinoscope&gt;&lt;/div&gt;";
 

}
else{
  photo = "&lt;img class=photoTrombinoscope src=./web/nophoto.jpg&gt;&lt;/img&gt;";
}

meibo.setFieldValue("photo",photo);



//mise en forme nom et prénom
sn = sn.toUpperCase() 
meibo.setFieldValue("nomString",sn); 

givenName = miseEnForme(givenName);
meibo.setFieldValue("prenomString",givenName); 

//mise en forme de la date d'arrivee
var dateArrivee = "";
if ( whenArrived!= "" ){
  dateArrivee = getDateString(whenArrived);
}
meibo.setFieldValue("dateArrivee",dateArrivee); 

//mise en forme des centres d'intérêts

var parameters = getProvisioningParameters_General();
var BCOM_CENTRES_INTERETS = parameters.get("BCOM_CENTRES_INTERETS");
var split_BCOM_CENTRES_INTERETS = BCOM_CENTRES_INTERETS.split("|");
var resultset = new ResultSet();
var i = 0;
while ( i &lt; split_BCOM_CENTRES_INTERETS.length()){
  var entry = new Entry();
  entry.CENTRES_INTERETS = split_BCOM_CENTRES_INTERETS[i];
  resultset.addEntry(entry);
  i++;
}
resultset.sort("CENTRES_INTERETS",true,false);

if ( resultset.getEntryCount() &gt; 0 ){
  var displayList =  new Array() ;
  var dnList = new Array();
  displayList[0] ="";
  dnList[0] = "";
  var j = 1;
  while (resultset.length() != j - 1){
      var CI = resultset.getEntry(j - 1).getAttributeValue("CENTRES_INTERETS");
      displayList[j] = miseEnForme(CI);
      dnList[j] = miseEnForme(CI);
      j++;
  }
  meibo.setFieldParameters("centreInteretCustom",dnList);
  meibo.setFieldOptions("centreInteretCustom",displayList);
}

var CI = returnEmpty(meibo.getFieldValues("centreInteret"));
if ( ( CI != "" ) &amp;&amp; ( CI.getCount() &gt; 0) ){
  meibo.setFieldValue("centreInteretCustom",CI);
}

var motsCle = returnEmpty(meibo.getFieldValues("motsCle"));
if ( ( motsCle != "" ) &amp;&amp; ( motsCle.getCount() &gt; 0) ){
  meibo.setFieldValue("motsCleCustom",motsCle);
}

var cv = returnEmpty(meibo.getFieldValues("cv"));
if ( ( cv != "" ) &amp;&amp; ( cv.getCount() &gt; 0) ){
  meibo.setFieldValue("cvCustom",cv);
}
var activites = returnEmpty(meibo.getFieldValues("activites"));
if ( ( activites != "" ) &amp;&amp; ( activites.getCount() &gt; 0) ){
  meibo.setFieldValue("activiteCustom",activites);
}

//Récupération de la description du status de la personne
var resultset = returnEmpty(meibo.executeResource("RoleStatus","(member="+dnPers+")",0,"description"));
var status = "";
if ( ( resultset != "" ) &amp;&amp; ( resultset.getEntryCount() &gt; 0 ) ){
  status = returnEmpty(resultset.getEntry().getAttributeValue("description")); 
}
meibo.setFieldValue("status",status);

////////////////////////////////////////////////////////////////////////////////////////
//                      SI RETOUR DE MODIFICATION PHOTO
////////////////////////////////////////////////////////////////////////////////////////
var BCOM_PROVENANCE_MA_FICHE =  meibo.getGlobalVar("BCOM_PROVENANCE_MA_FICHE");

if ( BCOM_PROVENANCE_MA_FICHE == "1"){

  var BCOM_ACTIVITES_MA_FICHE =  returnEmpty(meibo.getGlobalVar("BCOM_ACTIVITES_MA_FICHE"));
  if ( BCOM_ACTIVITES_MA_FICHE != "" ){
    meibo.getField("activiteCustom").setValues(BCOM_ACTIVITES_MA_FICHE);
  }
  var BCOM_MOTSCLE_MA_FICHE =  returnEmpty(meibo.getGlobalVar("BCOM_MOTSCLE_MA_FICHE"));
  if ( BCOM_MOTSCLE_MA_FICHE != "" ){
    meibo.getField("motsCleCustom").setValues(BCOM_MOTSCLE_MA_FICHE);
  }
  var BCOM_CV_MA_FICHE =  returnEmpty(meibo.getGlobalVar("BCOM_CV_MA_FICHE"));
  if ( BCOM_CV_MA_FICHE != "" ){
    meibo.getField("cvCustom").setValues(BCOM_CV_MA_FICHE);
  }
  var BCOM_CENTRE_INTERET_MA_FICHE =  returnEmpty(meibo.getGlobalVar("BCOM_CENTRE_INTERET_MA_FICHE"));
  if ( BCOM_CENTRE_INTERET_MA_FICHE != "" ){
    if ( BCOM_CENTRE_INTERET_MA_FICHE.getCount()&gt; 0 ){
      meibo.getField("centreInteretCustom").setValues(BCOM_CENTRE_INTERET_MA_FICHE);
    }  
  }
}
else{
  meibo.setGlobalVar("BCOM_PROVENANCE_MA_FICHE","0");
}
/////////////////////
//  Fin du script  //
/////////////////////</onload>
          </trigger>
        </sequence>
        <sequence name="Audit_PERSONNE" type="0">
          <properties>
            <displayname class="lingual">
              <fr>Audit_PERSONNE</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>ActiveDirectory_People_Audit_PERSONNE.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
          </rights>
          <trigger>
            <globalScriptView class="script">function changeNameAttribute(name,attribute){

  var i = 0;
  var nbValue = attribute.getCount();
  var newAttribute = new Attribute(name);
  while ( i &lt; nbValue ){
    var value = attribute.getValue(i);
    newAttribute.addValue(value);
    i++;
  } 
  
  return newAttribute;
}</globalScriptView>
            <onload class="script">///$debug
/**/
/* Script  de chargement de la fiche utilisateur pour audit */
/**/
/**/
/* Script modifié par akerva le 05/06
/**/ 

/////////////////////
// Debut du script //
///////////////////// 

////////////////////////////////////////////////////////////////////////////////////////
//                        MISE EN FORME DES CHAMPS DE LA FICHE
////////////////////////////////////////////////////////////////////////////////////////
var parameters = getProvisioningParameters_General();
//récupération des champs de la fiche

var sn = returnEmpty(meibo.getFieldValue("sn"));
var givenName = returnEmpty(meibo.getFieldValue("givenName"));


var dnPers = meibo.getCurrentDn();

//photo
var photo = "";

var thumbnailPhoto = returnEmpty(meibo.getFieldValue("thumbnailPhoto"));
var cn = returnEmpty(meibo.getFieldValue("cn"));
cn = cn.replace(" ","");
if ( thumbnailPhoto != "" ){
  
  var folder = parameters.get("BCOM_FOLDER_PHOTO_LECTURE");
  var file =  folder + cn + ".jpg";         
 
  photo = "&lt;div style=background-image:url('"+file+"') class=photoTrombinoscope&gt;&lt;/div&gt;";
 

}
else{
  photo = "&lt;img class=photoTrombinoscope src=./web/nophoto.jpg&gt;&lt;/img&gt;";
}

meibo.setFieldValue("photo",photo);



//mise en forme nom et prénom
sn = sn.toUpperCase() 
meibo.setFieldValue("nomString",sn); 

givenName = miseEnForme(givenName);
meibo.setFieldValue("prenomString",givenName); 

//mise en forme des groupe

////////////
//   GGR  //
////////////
var result1 = returnEmpty(meibo.executeResource("Role","(member="+dnPers+")",0,"cn"));
if ( result1 != "" ){
  meibo.fillInWithResultSet("GGR",result1,0,result1.getEntryCount(),"cn");
}  
  var stringGGUs="";//-- initialisation de la chaine des GGUs pour l'utilisateur
  // START LTE modifications : retrieve all GGUs for each HabFonct
  var resGGUs = returnEmpty(meibo.executeSqlRequest("IAM_BCOM","CALL getAllGGUForGGR('GGRF-DIT-VALP-MAN')",0));
    //var resGGUs = meibo.executeSqlProc("IAM_BCOM","getAllGGUForGGR",["IN=varchar"],["'GGRF-DIT-VALP-MAN'"],0);//-- GGUs search
    if (resGGUs != "" ) {
      for (var i = 0 ; i &lt; resGGUs.getEntryCount() ; i++) {
        if (stringGGUs.length == 0 ) {
          stringGGUs = resGGUs.getEntry(i);
        }
        else {
          stringGGUs = stringGGUs + "|" + resGGUs.getEntry(i);
        }
      }
    }
    logwarn(stringGGUs);
    // END LTE modifications
////////////
//   GGU  //
////////////
var result2 = returnEmpty(meibo.executeResource("Group","(member="+dnPers+")",0,"cn"));
if ( result2 != "" ){
  meibo.fillInWithResultSet("GGU",result2,0,result2.getEntryCount(),"cn");
} 
////////////
//   GGA  //
////////////

var result3 = returnEmpty(meibo.executeResource("Acces","(member="+dnPers+")",0,"cn"));

if ( result3 != "" ){ 
  meibo.fillInWithResultSet("GGA",result3,0,result3.getEntryCount(),"cn");
} 

/////////////////////
//  Fin du script  //
/////////////////////</onload>
          </trigger>
        </sequence>
        <sequence name="Formulaire_RECHERCHE_PERSONNE" type="4">
          <properties>
            <displayname class="lingual">
              <fr>Formulaire_RECHERCHE_PERSONNE</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
          </properties>
          <path>ActiveDirectory_People_Formulaire_RECHERCHE_PERSONNE.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script">//// display search result in a table.
//// This function uses input parameters from fields in view and fills a table
//// named "results".
//function /*void*/ displaySearch(/*String*/ resource, /*String*/ attrs) {
//  var parameters = getProvisioningParameters_General();
//  //var nbCol = parameters.get("BCOM_TROMBINOSCOPE_NB_COLONNE");
//  
//  // compute current page
//  var /*int*/ pageSize = parseInt(meibo.getFieldValue("pageSize"));
//  var /*int*/ page = parseInt(meibo.getFieldValue("page"));
//  var /*int*/ pages = parseInt(meibo.getFieldValue("pages"));
//
//  // populate table
//  var /*int*/ start = (page - 1) * pageSize;
//  var /*String*/ filter = meibo.getFieldValue("filter");
//  var resultat = meibo.executeResource("People",filter,0);
//  resultat.sort("sn,givenName",true,false);
//  //var /*int*/ nEntries = meibo.fillInWithQuery("results", resource, filter, start, pageSize, attrs, getFieldValue('sortAttribute'));
//  var nEntries = resultat.getEntryCount();
//  if (nEntries == 0) {
//    //meibo.showField("error", true);
//    meibo.showField("searchContainer",false);
//  }
//  else {
//    // show-hide button
//    meibo.showField("searchContainer",true);
//    meibo.showField("next", page &lt; pages);
//    meibo.showField("last", page &lt; pages);
//    meibo.showField("previous", page &gt; 1);
//    meibo.showField("first", page &gt; 1);
//    meibo.setFieldValue("range", "Page " + page+ "/" + pages);
//    
//    var nbligne = ( (parseInt(parameters.get("BCOM_TROMBINOSCOPE_NB_RESULTAT_PAR_PAGE")) - 1 ) / 4 ) + 1;   
//
//    var BCOM_TROMBINOSCOPE_NB_RESULTAT_PAR_PAGE = parseInt(parameters.get("BCOM_TROMBINOSCOPE_NB_RESULTAT_PAR_PAGE"))
//    var testNbResPage = page * BCOM_TROMBINOSCOPE_NB_RESULTAT_PAR_PAGE;
//    var nbResPage = 0;
//    if ( testNbResPage &lt; nEntries ){
//      nbResPage = BCOM_TROMBINOSCOPE_NB_RESULTAT_PAR_PAGE;
//    }
//    else{
//      nbResPage = nEntries - ( ( page - 1 ) * BCOM_TROMBINOSCOPE_NB_RESULTAT_PAR_PAGE );
//    }
//    
//    
////    var url = parameters.get("BCOM_AD_URL_CONNEXION");
////    var baseRecherche = parameters.get("BCOM_AD_OU_PEOPLE");
////    var urlRecherche = url + "/" + baseRecherche + "?jpegPhoto?scope=sub?";
//    
//    var j = 1; //-- incrément ligne
//    var incRes = 1; //-- incrément du résultset
//    var incPage = 1; //-- incrément sur le page
//    while ( j &lt; nbligne + 1 ){ //-- boucle sur les lignes
//      var i = 1; //-- incrément colonne
//      while ( i &lt; 5 ){//-- boucle sur les colonnes
//        
//        var photo = returnEmpty(resultat.getEntry(incRes - 1).getAttributeValue("jpegPhoto"));
//        var sn = returnEmpty(resultat.getEntry(incRes - 1).getAttributeValue("sn"));
//        var givenName = returnEmpty(resultat.getEntry(incRes - 1).getAttributeValue("givenName"));
//        var dn = returnEmpty(resultat.getEntry(incRes - 1).getAttributeValue("dn"));
////        urlRecherche = urlRecherche + "(cn="+cn+")";
////        if ( photo != "" ){
////          meibo.setFieldValue("test",photo);
////        }
//        //meibo.getField("results").addCell(j-1,i-1,"&lt;div id=fondTrombinoscope&gt;&lt;div id=photoTrombinoscope&gt;"+photo+"&lt;/div&gt;&lt;div id=nomTrombinoscope&gt;" + givenName + " " + sn + "&lt;/div&gt;&lt;/div&gt;");
//        meibo.getField("results").addRawCell(j-1,i-1,"&lt;div id=fondTrombinoscope&gt;&lt;div id=photoTrombinoscope&gt;&lt;img src=&gt;&lt;/img&gt;&lt;/div&gt;&lt;div id=nomTrombinoscope&gt;" + givenName + " " + sn + "&lt;/div&gt;&lt;/div&gt;");
//        meibo.getField("results").addCellObject(j-1,i-1,dn);
//        if ( incPage == nbResPage ){ //-- SI NOMBRE DE RESULTAT AFFICHE ATTEINT
//          break; //-- STOPPE AFFICHAGE
//        }
//        else{
//         incPage++;//-- incrémentation des resultat sur une page
//        }
//        incRes++;//-- incrémentation du résultset
//        i++;//-- incrémentation colonne
//      }
//      if ( incPage == nbResPage ){ //-- SI NOMBRE DE RESULTAT AFFICHE ATTEINT
//          break; //-- STOPPE AFFICHAGE
//      } //-- FIN boucle sur les colonnes  
//      j++;//-- incrémentation ligne
//    }//-- FIN boucle sur les ligne
//      
//    
//      
//  }
//}
//
//// select all lines in a table
//function /*void*/ selectAllLines(/*String*/ table) {
//  var /*int*/ nbLines = meibo.getTableLength(table);
//  for (var /*int*/ line = 0; line &lt; nbLines; line++) {
//    meibo.checkTableRow(table, line, true);
//  }
//}
//
//// unselect all lines in a table
//function /*void*/ unselectAllLines(/*String*/ table) {
//  var /*int*/ nbLines = meibo.getTableLength(table);
//  for (var /*int*/ line = 0; line &lt; nbLines; line++) {
//    meibo.checkTableRow(table, line, false);
//  }
//}</globalScriptView>
            <onload class="script">///$debug
/////////////////////////////////////////////////////////////////////
//    Récupération des numéros de pages si retour aux résultats
/////////////////////////////////////////////////////////////////////
var BCOM_PROVENANCE_TROMBINOSCOPE = meibo.getGlobalVar("BCOM_PROVENANCE_TROMBINOSCOPE");
if ( BCOM_PROVENANCE_TROMBINOSCOPE == "1" ){
  var RECHERCHE_PAGESIZE_TROMBINOSCOPE = meibo.getGlobalVar("RECHERCHE_PAGESIZE_TROMBINOSCOPE"); 
  meibo.setFieldValue("pageSize",""+RECHERCHE_PAGESIZE_TROMBINOSCOPE);
  var RECHERCHE_PAGES_TROMBINOSCOPE = meibo.getGlobalVar("RECHERCHE_PAGES_TROMBINOSCOPE"); 
  meibo.setFieldValue("pages",""+RECHERCHE_PAGES_TROMBINOSCOPE);
  var RECHERCHE_PAGE_TROMBINOSCOPE = meibo.getGlobalVar("RECHERCHE_PAGE_TROMBINOSCOPE");
   meibo.setFieldValue("page",""+RECHERCHE_PAGE_TROMBINOSCOPE);
}
var BCOM_PROVENANCE_TROMBINOSCOPE = meibo.setGlobalVar("BCOM_PROVENANCE_TROMBINOSCOPE","0");
/////////////////////////////////////////////////////////////////////
//    EXECUTION DU SCRIPLET TROMBINOSCOPE
/////////////////////////////////////////////////////////////////////
var scriplet = meibo.loadScriptlet("trombinoscope");
var trombinoscope = scriplet.execute(); 
meibo.getField("results").addRawCell(0,0,trombinoscope);
meibo.setFieldValue("test",trombinoscope)</onload>
            <onquit class="script"/>
          </trigger>
        </sequence>
        <sequence name="Selecteur_RESPONSABLE_BCOM" type="7">
          <properties>
            <displayname class="lingual">
              <fr/>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <separator class="separator"/>
            <custompicker class="boolean">false</custompicker>
            <separator class="separator"/>
            <height class="integer">140</height>
            <pickerwidth class="integer">500</pickerwidth>
            <pickerheight class="integer">450</pickerheight>
            <separator class="separator"/>
            <pickerhead class="css">pickerHead</pickerhead>
            <pickerclose class="file">./web\close.gif</pickerclose>
            <separator class="separator"/>
            <displayattributes class="attributes"/>
          </properties>
          <path>ActiveDirectory_People_Selecteur_RESPONSABLE_BCOM.xml</path>
          <class/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
        <sequence name="PeopleSelector" type="7">
          <properties>
            <displayname class="lingual">
              <fr>Personnes</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <separator class="separator"/>
            <custompicker class="boolean">true</custompicker>
            <separator class="separator"/>
            <height class="integer">140</height>
            <pickerwidth class="integer">400</pickerwidth>
            <pickerheight class="integer">385</pickerheight>
            <separator class="separator"/>
            <pickerhead class="css">pickerHead</pickerhead>
            <pickerclose class="file">./web\close.gif</pickerclose>
            <separator class="separator"/>
            <displayattributes class="attributes">givenName,sn,cn,PRS_ID (logique)</displayattributes>
          </properties>
          <path>ActiveDirectory_People_PeopleSelector.xml</path>
          <class/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
      </resource>
      <resource name="Role">
        <properties>
          <displayname class="lingual">
            <fr>Role</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Roles,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,displayName,description,groupType,location,member,memberOf,objectCategory,objectClass,name,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,msSFU30PosixMember,msSFU30PosixMemberOf</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">cn</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">cn</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="RoleApplication">
        <properties>
          <displayname class="lingual">
            <fr>Role Application</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Applications,OU=Roles,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,description,displayName,groupType,location,member,memberOf,name,objectCategory,objectClass,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">description</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">description</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute">description</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="RoleOperation">
        <properties>
          <displayname class="lingual">
            <fr>Role Opération</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Operations,OU=Roles,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,description,displayName,groupType,location,member,memberOf,name,objectCategory,objectClass,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">description</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">description</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute">description</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
        <sequence name="Selecteur_ROLE_OPERATION" type="7">
          <properties>
            <displayname class="lingual">
              <fr/>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <separator class="separator"/>
            <custompicker class="boolean">false</custompicker>
            <separator class="separator"/>
            <height class="integer">140</height>
            <pickerwidth class="integer">600</pickerwidth>
            <pickerheight class="integer">450</pickerheight>
            <separator class="separator"/>
            <pickerhead class="css">pickerHead</pickerhead>
            <pickerclose class="file">./web\close.gif</pickerclose>
            <separator class="separator"/>
            <displayattributes class="attributes"/>
          </properties>
          <path>ActiveDirectory_RoleOperation_Selecteur_ROLE_OPERATION.xml</path>
          <class/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
      </resource>
      <resource name="RolePosition">
        <properties>
          <displayname class="lingual">
            <fr>RolePosition</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Positions,OU=Roles,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,description,displayName,groupType,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,location,member,memberOf,name,objectCategory,objectClass,msSFU30PosixMember,msSFU30PosixMemberOf</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">description</attribute>
            <reverseOrder class="boolean">true</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">description</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute">description</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
        <sequence name="Selecteur_ROLE_POSITION" type="7">
          <properties>
            <displayname class="lingual">
              <fr/>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <separator class="separator"/>
            <custompicker class="boolean">false</custompicker>
            <separator class="separator"/>
            <height class="integer">140</height>
            <pickerwidth class="integer">600</pickerwidth>
            <pickerheight class="integer">760</pickerheight>
            <separator class="separator"/>
            <pickerhead class="css">pickerHead</pickerhead>
            <pickerclose class="file">./web\close.gif</pickerclose>
            <separator class="separator"/>
            <displayattributes class="attributes"/>
          </properties>
          <path>ActiveDirectory_RolePosition_Selecteur_ROLE_POSITION.xml</path>
          <class/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
      </resource>
      <resource name="RoleStatus">
        <properties>
          <displayname class="lingual">
            <fr>RoleStatus</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Status,OU=Roles,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,description,displayName,groupType,location,member,memberOf,name,objectCategory,objectClass,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,msSFU30PosixMember,msSFU30PosixMemberOf</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">description</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">description</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="RoleStatusSansExterne">
        <properties>
          <displayname class="lingual">
            <fr>RoleStatus</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">group</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">OU=Status,OU=Roles,OU=People,DC=pprb-com,DC=local</base>
          <filter class="filter">(&amp;(!(CN=GGRS-EXT))(!(CN=GGRS-INV)))</filter>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>cn,description,displayName,groupType,location,memberOf,name,objectCategory,objectClass,isActif,isActing,isPrimary,isPublic,isResponsable,isSecondary,member</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute">cn</rdn>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">description</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">description</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">1000</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="test">
        <properties>
          <displayname class="lingual">
            <fr>test</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">user</objectclass>
          <auxiliaries class="auxiliaries"/>
          <separator class="separator"/>
          <base class="dn">DC=pprb-com,DC=local</base>
          <filter class="filter"/>
          <scope class="scope">SUBTREE</scope>
          <separator class="separator"/>
          <targetdn class="dn"/>
          <constraintlink class="ctrlink"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>displayName,sAMAccountType,primaryGroupID,objectCategory,cn,userAccountControl,userPrincipalName,dSCorePropagationData,codePage,distinguishedName,whenChanged,whenCreated,pwdLastSet,accountExpires,objectGUID,uSNChanged,uSNCreated,objectSid,countryCode,sAMAccountName,instanceType,name</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <rdn class="attribute"/>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute"/>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <tosort class="sortconstraints">
            <bymeibo class="boolean">false</bymeibo>
            <distinct class="boolean">false</distinct>
            <maxresultnb class="maxresultnb">200</maxresultnb>
          </tosort>
          <separator class="separator"/>
          <key class="attribute">cn</key>
          <scriptletshow class="filter"/>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <alphasplit class="boolean">false</alphasplit>
          <separator class="separator"/>
          <searchattribute class="attribute">cn</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
    </datasource>
    <datasource auto="A -&gt; Z" name="IAM_BCOM" type="SQL">
      <properties>
        <JDBCConnectionURL class="text">jdbc:mysql://10.2.100.13:3306/iam_bcom</JDBCConnectionURL>
        <Enabled class="boolean">true</Enabled>
        <ConnectionObliged class="boolean">true</ConnectionObliged>
        <separator class="separator"/>
        <user class="text">fjean</user>
        <password class="password">{dQXAwmXc2I6tZcd1szCSJg==}</password>
        <separator class="separator"/>
        <WorkflowUser class="text">fjean</WorkflowUser>
        <WorkflowPassword class="password">{dQXAwmXc2I6tZcd1szCSJg==}</WorkflowPassword>
        <separator class="separator"/>
        <WebServiceUser class="text"/>
        <WebServicePassword class="password"/>
        <separator class="separator"/>
        <JDBCDriver class="text">com.mysql.jdbc.Driver</JDBCDriver>
        <separator class="separator"/>
        <AppServerDatasource class="text"/>
        <separator class="separator"/>
        <BlobType class="hidden">TINYBLOB, BLOB, MEDIUMBLOB, LONGBLOB, LONGVARBINARY, IMAGE, BYTEA</BlobType>
        <ClobType class="hidden">CLOB</ClobType>
        <BinaryType class="hidden"/>
        <NumType class="hidden">NUMERIC, DOUBLE</NumType>
        <LongType class="hidden">INT, INTEGER</LongType>
        <ConnectionPoolSize class="number">3</ConnectionPoolSize>
        <ConnectionPoolMax class="number">5</ConnectionPoolMax>
        <ConnectionUseCount class="number">100</ConnectionUseCount>
        <ConnectionTimeOut class="number">120</ConnectionTimeOut>
      </properties>
    </datasource>
    <datasource auto="A -&gt; Z" name="TRAVEL_BCOM" type="SQL">
      <properties>
        <JDBCConnectionURL class="text">jdbc:mysql://10.2.100.13:3306/iam_bcom</JDBCConnectionURL>
        <Enabled class="boolean">true</Enabled>
        <ConnectionObliged class="boolean">true</ConnectionObliged>
        <separator class="separator"/>
        <user class="text">fjean</user>
        <password class="password">{dQXAwmXc2I6tZcd1szCSJg==}</password>
        <separator class="separator"/>
        <WorkflowUser class="text">fjean</WorkflowUser>
        <WorkflowPassword class="password">{dQXAwmXc2I6tZcd1szCSJg==}</WorkflowPassword>
        <separator class="separator"/>
        <WebServiceUser class="text"/>
        <WebServicePassword class="password"/>
        <separator class="separator"/>
        <JDBCDriver class="text">com.mysql.jdbc.Driver</JDBCDriver>
        <separator class="separator"/>
        <AppServerDatasource class="text"/>
        <separator class="separator"/>
        <BlobType class="hidden">TINYBLOB, BLOB, MEDIUMBLOB, LONGBLOB, LONGVARBINARY, IMAGE, BYTEA</BlobType>
        <ClobType class="hidden">CLOB</ClobType>
        <BinaryType class="hidden"/>
        <NumType class="hidden">NUMERIC, DOUBLE</NumType>
        <LongType class="hidden">INT, INTEGER</LongType>
        <ConnectionPoolSize class="number">3</ConnectionPoolSize>
        <ConnectionPoolMax class="number">5</ConnectionPoolMax>
        <ConnectionUseCount class="number">100</ConnectionUseCount>
        <ConnectionTimeOut class="number">120</ConnectionTimeOut>
      </properties>
      <resource name="Address">
        <properties>
          <displayname class="lingual">
            <fr>Address</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_ADDRESS_TAS</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TAS_ID,TAS_NAME,TAS_PHONENUMBER,TAS_STATE,TAS_TOWN,TAS_ZIPCODE,TCY_ID,TAS_ADDR1,TAS_ADDR2,TAS_ADDR3,TNA_ABBREV</physical>
            <logical>
              <attribute attrs="TCY_FR_FR_NAME" pattern_fr="{0}" resourcelink="AddressCountry" type="link">TCY_FR_FR_NAME</attribute>
              <attribute attrs="TCT_NAME" pattern_fr="{0}" resourcelink="AddressContinent" type="link">TCT_NAME</attribute>
              <attribute attrs="TCT_ID" pattern_fr="{0}" resourcelink="AddressCountry" type="link">TCT_ID</attribute>
              <attribute attrs="TCY_EN_GB_NAME" pattern_fr="{0}" resourcelink="AddressCountry" type="link">TCY_EN_GB_NAME</attribute>
              <attribute attrs="TNA_DESCRIPTION" pattern_fr="{0}" resourcelink="AddressAddressNature" type="link">TNA_DESCRIPTION</attribute>
            </logical>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TAS_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TAS_NAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TAS_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TAS_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
        <sequence name="Picker" type="7">
          <properties>
            <displayname class="lingual">
              <fr/>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <separator class="separator"/>
            <custompicker class="boolean">true</custompicker>
            <separator class="separator"/>
            <height class="integer">140</height>
            <pickerwidth class="integer">500</pickerwidth>
            <pickerheight class="integer">400</pickerheight>
            <separator class="separator"/>
            <pickerhead class="css">pickerHead</pickerhead>
            <pickerclose class="file">./web\close.gif</pickerclose>
            <separator class="separator"/>
            <displayattributes class="attributes">TAS_ID,TAS_NAME,TAS_STATE,TAS_TOWN,TAS_ADDR1,TCY_FR_FR_NAME (logique),TCY_EN_GB_NAME (logique)</displayattributes>
          </properties>
          <path>TRAVEL_BCOM_Address_Picker.xml</path>
          <class/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
        <sequence name="EventAddressPicker" type="7">
          <properties>
            <displayname class="lingual">
              <fr/>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <separator class="separator"/>
            <custompicker class="boolean">true</custompicker>
            <separator class="separator"/>
            <height class="integer">140</height>
            <pickerwidth class="integer">500</pickerwidth>
            <pickerheight class="integer">400</pickerheight>
            <separator class="separator"/>
            <pickerhead class="css">pickerHead</pickerhead>
            <pickerclose class="file">./web\close.gif</pickerclose>
            <separator class="separator"/>
            <displayattributes class="attributes">TAS_ID,TAS_NAME,TAS_STATE,TAS_TOWN,TAS_ADDR1,TCY_FR_FR_NAME (logique),TCY_EN_GB_NAME (logique)</displayattributes>
          </properties>
          <path>TRAVEL_BCOM_Address_EventAddressPicker.xml</path>
          <class/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
        <sequence name="Display" type="0">
          <properties>
            <displayname class="lingual">
              <fr>Display</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Address_Display.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <AnalyseurDeplacement>true</AnalyseurDeplacement>
            <DDI>true</DDI>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <OrganisateurVoyage>true</OrganisateurVoyage>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
        <sequence name="Create" type="2">
          <properties>
            <displayname class="lingual">
              <fr>Create</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
            <onoperationok class="extscript"/>
            <onoperationko class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Address_Create.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <AnalyseurDeplacement>true</AnalyseurDeplacement>
            <DDI>true</DDI>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <OrganisateurVoyage>true</OrganisateurVoyage>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script"/>
            <onquit class="script">var /*boolean*/ ok = true;
meibo.showField("error", false);
ok = ok &amp;&amp; checkMandatoryField("TCY_ID", 1);
meibo.setCreationBase("");
meibo.setReturnValue(ok);</onquit>
            <onoperationok class="script">//$debug
if(hasSourceView()){
// retour et pré-sélection de l'adresse créée
  backToSourceView();
  // Note : il faudrait idéalement ici mettre à jour l'adresse dans le formulaire appelant
  // on ne ne le fait pas car ici on a pas l'id de l'adresse que l'on vient de créer
  // (il faudrait passer par une procédure stockée pour créer l'adresse)
  //meibo.setFieldValue("fkTAS_ID",???);  
}else{
  meibo.switchToApplicationView("Validation_OK");
}</onoperationok>
            <onoperationko class="script"/>
          </trigger>
        </sequence>
      </resource>
      <resource name="AddressNature">
        <properties>
          <displayname class="lingual">
            <fr>AddressNature</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_NATURE_ADDRESS_TNA</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TNA_ABBREV,TNA_DESCRIPTION</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TNA_ABBREV</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TNA_ABBREV</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TNA_DESCRIPTION</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TNA_DESCRIPTION</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
      </resource>
      <resource name="ConcreteEvent">
        <properties>
          <displayname class="lingual">
            <fr>ConcreteEvent</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_CONCRETE_EVENT_TCT</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>PRS_ID_AUTHOR,PRS_ID_LEADER,TAS_ID,TCT_COMMENT,TCT_COST,TCT_CREATE_DATE,TCT_DURATION,TCT_ID,TCT_START_DATE,TCT_URL,TET_ID</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TCT_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TCT_ID</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TCT_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TCT_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
        <sequence name="Udpate" type="1">
          <properties>
            <displayname class="lingual">
              <fr>Udpate</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
            <onoperationok class="extscript"/>
            <onoperationko class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_ConcreteEvent_Udpate.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <DDI>true</DDI>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script">// Restaure les valeur précédentes dans le cas on l'on revient sur ce formulaire
restoreFields("ConcreteEvent");

if(hasSourceView()){
  meibo.showField("BTN_CANCEL", true);
}</onload>
            <onquit class="script">///$debug
// contournement de meibo qui ne gère pas tout seul les dates sql
var sqlDate = SQL_DATE_FORMAT.format(DATE_FORMAT.parse(meibo.getFieldValue("TCT_START_DATE")));
meibo.setFieldValue("TCT_START_DATE",sqlDate);

var cost = meibo.getFieldValue("TET_AVERAGE_COST");
if (cost==""){
  cost=null;
}
meibo.setFieldValue("TET_AVERAGE_COST",cost);
  
meibo.setReturnValue(true);</onquit>
            <onoperationok class="script"/>
            <onoperationko class="script"/>
          </trigger>
        </sequence>
      </resource>
      <resource name="Continent">
        <properties>
          <displayname class="lingual">
            <fr>Continent</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_CONTINENT_CTT</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>CTT_ID,CTT_NAME</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">CTT_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">CTT_NAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">CTT_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute"/>
          <separator class="separator"/>
          <imageclosed class="file">images/world_add.png</imageclosed>
          <imageopened class="file">images/world_delete.png</imageopened>
        </properties>
        
      </resource>
      <resource name="Country">
        <properties>
          <displayname class="lingual">
            <fr>Pays</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_COUNTRY_TCY</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TCY_ALPHA2,TCY_ALPHA3,TCY_CODE,TCY_EN_GB_NAME,TCY_FR_FR_NAME,TCY_ID,CTT_ID</physical>
            <logical>
              <attribute attrs="CTT_NAME" pattern_fr="{0}" resourcelink="CountryContinent" type="link">continent</attribute>
              <attribute onread="{attribute}" onwrite="{attribute}" physicalattribute="TCY_FR_FR_NAME" type="mapp">NAME</attribute>
            </logical>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TCY_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TCY_ALPHA2</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TCY_FR_FR_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file">images/world.png</imageclosed>
          <imageopened class="file">images/world_go.png</imageopened>
        </properties>
        
        <sequence name="CountryView" type="0">
          <properties>
            <displayname class="lingual">
              <fr>CountryView</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Country_CountryView.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <DDI>true</DDI>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
      </resource>
      <resource name="Event">
        <properties>
          <displayname class="lingual">
            <fr>Event</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">travel_event</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TCT_COMMENT,TCT_CREATE_DATE,TCT_DURATION,TCT_START_DATE,TCT_URL,TET_AVERAGE_COST,TET_COMMENT,TET_DURATION,TET_ID,TET_ISPRIVATE,TET_ISTEMPLATE,TET_NAME,TET_URL,fkPRS_ID_AUTHOR,fkPRS_ID_LEADER,fkTAS_ID,fkTCT_ID,fkTES_ID,fkTET_ID,fkTRT_ID,fkTTY_ID</physical>
            <logical>
              <attribute attrs="displayValue" pattern_fr="{0}" resourcelink="EventAuthor" type="link">Author</attribute>
              <attribute type="script">displayName</attribute>
              <attribute attrs="TAS_TOWN" pattern_fr="{0}" resourcelink="EventAddress" type="link">TAS_TOWN</attribute>
              <attribute attrs="TTY_ABBREV" pattern_fr="{0}" resourcelink="EventEventType" type="link">Type</attribute>
              <attribute attrs="TES_ABBREV" pattern_fr="{0}" resourcelink="EventEventScope" type="link">Scope</attribute>
              <attribute attrs="TTY_NAME" pattern_fr="{0}" resourcelink="EventEventType" type="link">TypeName</attribute>
              <attribute attrs="TES_NAME" pattern_fr="{0}" resourcelink="EventEventScope" type="link">ScopeName</attribute>
            </logical>
          </return>
          <onRead class="script">var scriptedAttributes = meibo.getParameter("scripted");
var mappedAttributes = meibo.getParameter("mapped");
var linkedAttributes = meibo.getParameter("linked");
var entry = meibo.getCurrentEntry();

if ((scriptedAttributes !=null) &amp;&amp; ("displayName" in scriptedAttributes)) {
  // calcul attribut displayName
  var name=entry.TET_NAME[0];
  var location=entry.TAS_TOWN[0];
  var date=entry.TCT_START_DATE[0];
  if((name==null) || (location ==null) || (login ==null)){
    // rechargement de l'entrée avec les attributs requis
    var newEntry = meibo.getDnEntry("Event", meibo.getCurrentDn(),"TAS_TOWN,TET_NAME,TCT_START_DATE");
    name=newEntry.TET_NAME[0];
    location=newEntry.TAS_TOWN[0];
    date=newEntry.TCT_START_DATE[0];
  }
  entry.displayName = name + " - " + location + " (" + date + ")";
}</onRead>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">fkTCT_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">fkTCT_ID</attribute>
            <reverseOrder class="boolean">true</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">displayName</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TET_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file">images/black-time.gif</imageclosed>
          <imageopened class="file">images/green-clock.gif</imageopened>
        </properties>
        
        <sequence name="Create" type="2">
          <properties>
            <displayname class="lingual">
              <fr>Create</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
            <onoperationok class="extscript"/>
            <onoperationko class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Event_Create.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <DDI>true</DDI>
            <InitiateurDeplacement>true</InitiateurDeplacement>
          </rights>
          <trigger>
            <globalScriptView class="script">/**
 * Affectation des valeurs possibles de portées d'évenements en fonction du type
 */
function /*void*/ setScopesForType(){
  var /*Field2*/ typeField = meibo.getField("fkTTY_ID");
  var /*String*/ typeAbbrev= typeField.getValue();

  if((typeAbbrev!=null) &amp;&amp; (typeAbbrev!="")){
    // récupération des portées autorisées en fonction de type d'évenement
    var /*ResultSet*/ rs = meibo.executeSqlRequest("TRAVEL_BCOM","call get_scopes_for_event_type('"+ typeAbbrev + "')",0); 

    // affectation des valeurs à la liste des portées
    var /*String*/ scopeFieldOptions="";
    var /*String*/ scopeFieldParameters="";
    for each(var entry in rs){
      if(scopeFieldOptions==""){
        scopeFieldOptions=entry.TES_NAME[0];
        scopeFieldParameters=entry.TES_ABBREV[0];
      }else{
        scopeFieldOptions=scopeFieldOptions + "," + entry.TES_NAME[0];
        scopeFieldParameters=scopeFieldParameters + "," + entry.TES_ABBREV[0];
      }
    }

    var /*Field2*/ scopeField = meibo.getField("fkTES_ID");
    scopeField.setOptions(scopeFieldOptions);
    scopeField.setParameters(scopeFieldParameters);
  }
}

/**
 * Bascule valeurs et états des champs en fonction de l'utilisation ou non d'un template d'évènement
 */
function /*void*/ switchTemplateUse(){
  var /*Field2*/ field = meibo.getField("fkTET_ID");
  var /*String*/ fieldValue = field.getValue();
  
  if((fieldValue!=null) &amp;&amp; (fieldValue.trim()!="-1")){
    // cas d'un évenement nouveau à partir d'un template
    // charger les données du template
    meibo.getField("TET_NAME_display").show(false);
    meibo.getField("TET_ISPRIVATE_Layout").show(false);
    //meibo.getField("TET_AVERAGE_COST").setEnabled(false);
    meibo.getField("fkTTY_ID").setEnabled(false);
    meibo.getField("fkTES_ID").setEnabled(false);
    
    var /*ResultSet*/ eventHeaderRS = meibo.executeResource("EventHeader","TET_ID=" + fieldValue, 1,"TET_NAME,TET_COMMENT,TET_DURATION,TET_URL,TET_AVERAGE_COST,TTY_ABBREV,TES_ABBREV,TAS_ID");
    var /*Entry*/ eventHeaderEntry = eventHeaderRS.getEntry();
    if(eventHeaderEntry!=null){
    // préremplir : durée: commentaire, type, portée, URL, adresse, cout Moyen
      meibo.getField("TET_NAME").setValue(eventHeaderEntry.TET_NAME[0]);
      meibo.getField("TCT_COMMENT").setValue(eventHeaderEntry.TET_COMMENT[0]);
      meibo.getField("TCT_DURATION").setValue(eventHeaderEntry.TET_DURATION[0]);
      meibo.getField("TCT_URL").setValue(eventHeaderEntry.TET_URL[0]);
      meibo.getField("TET_AVERAGE_COST").setValue(eventHeaderEntry.TET_AVERAGE_COST[0]);
      meibo.getField("fkTTY_ID").setValue(eventHeaderEntry.TTY_ABBREV[0]);
      meibo.getField("fkTES_ID").setValue(eventHeaderEntry.TES_ABBREV[0]);
      meibo.getField("fkTAS_ID").setValue(eventHeaderEntry.TAS_ID[0]);
    }
    
  }else{
    // cas d'un évenement nouveau "from scratch"
    meibo.getField("TET_NAME_display").show(true);
    if((meibo.isUserInRole("DDI")) || (meibo.isUserInRole("AdminMeibo"))){
      meibo.getField("TET_ISTEMPLATE").show(true);
      meibo.getField("labelTET_ISTEMPLATE").show(true);
    }else{
      meibo.getField("TET_ISTEMPLATE").show(false);
      meibo.getField("labelTET_ISTEMPLATE").show(false);
    }
    meibo.getField("TET_ISPRIVATE_Layout").show(true);
    //meibo.getField("TET_AVERAGE_COST").setEnabled(true);
    meibo.getField("fkTTY_ID").setEnabled(true);
    meibo.getField("fkTES_ID").setEnabled(true);
  }
}</globalScriptView>
            <onload class="script">///$debug

// Ajout d'une "non valeur" dans la liste des templates d'évenement pour permettre de ne rien sélectionner
var /*Field2*/ headerIdField= meibo.getField("fkTET_ID");
headerIdField.setOptions("-," + headerIdField.getOptions());
//headerIdField.setParameters(" ," + headerIdField.getParameters());
// Bug Meibo : getParameters ne fonctionne pas; contournement avec l'ancienne méthode meibo.getFieldParameters(
headerIdField.setParameters("-1," + meibo.getFieldParameters("fkTET_ID"));
headerIdField.setValue("-1");

meibo.setFieldValue("ADDRESS_MODE","existing");

// Restaure les valeur précédentes dans le cas on l'on revient sur ce formulaire
restoreFields("Event");

// affecte les les valeurs possibles de portée en fonction du type
setScopesForType();

// Bascule valeurs et états des champs en fonction de l'utilisation ou non d'un template d'évènement
switchTemplateUse();

if(hasSourceView()){
  meibo.showField("BTN_CANCEL", true);
}</onload>
            <onquit class="script">///$debug

// vérification des données
var /*boolean*/ checkOK = true;
meibo.showField("error", false);
checkOK = checkOK &amp;&amp; checkMandatoryField("TCT_START_DATE", 1);

if(checkOK){
  var /*boolean*/ recordOK = false;
  var /*String*/ errorMessage = null;

  var /*Array*/ values = new Array();
  var /*Array*/ types = new Array();
  var /*SqlProcResult*/ sqlProcResult = null;
  var /*String*/ procName= null;
  var resultValue = null;

  // Adresse
  var addressId= null;
  var addressMode= meibo.getFieldValue("ADDRESS_MODE");
  if(addressMode=="existing"){
  // utilisation adresse existante
    addressId= meibo.getFieldValue("fkTAS_ID")
  }else{
  // nouvelle adresse à enregistrer
    var eventTypeAbbrev = meibo.getFieldValue("fkTTY_ID");
    // nature d'addresse
    var addressNature = "EVT";
    if((eventTypeAbbrev=="CUS")||(eventTypeAbbrev=="B2B")){
      addressNature = "CUS";
    }    
    // type d'adresse
    var adressType = "T_EVENT_ADDRESS_TEA";
       
    values[0] = adressType;
    types[0] = "IN";
    values[1] = addressNature;
    types[1] = "IN";
    values[2] = meibo.getFieldValue("TAS_NAME");
    types[2] = "IN";
    values[3] = meibo.getFieldValue("TAS_ADDR1");
    types[3] = "IN";
    values[4] = meibo.getFieldValue("TAS_ADDR2");
    types[4] = "IN";
    values[5] = meibo.getFieldValue("TAS_ADDR3");
    types[5] = "IN";
    values[6] = meibo.getFieldValue("TAS_ZIPCODE");
    types[6] = "IN";
    values[7] = meibo.getFieldValue("TAS_TOWN");
    types[7] = "IN";
    values[8] = meibo.getFieldValue("TAS_STATE");
    types[8] = "IN";
    values[9] = meibo.getFieldValue("TCY_ID");
    types[9] = "IN";
    values[10] = meibo.getFieldValue("TAS_PHONENUMBER");
    types[10] = "IN";
    
    procName = "add_address";

    // add_address`(in addrType varchar(25),in addrNature varchar(25),in adrName varchar(255), in addr1 varchar(255), in addr2 varchar(255), in addr3 varchar(255), in zipcode varchar(255), in town varchar(255), in state varchar(255), in countryAlpha3 varchar(3), in phoneNumber varchar(25))
    // appel procédure stockée
    sqlProcResult = meibo.executeSqlProc("TRAVEL_BCOM",procName ,types, values);
  
    // vérification du résultat
    if(sqlProcResult==null){
      meibo.logError("null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
      meibo.setFieldValue("error","null en retour de l'appel à "+ procName);
      meibo.showField("error", true);
    }else{  
      try{
        var rs= sqlProcResult.getResultSet();
        if(rs==null){
          meibo.logError("ResultSet null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
          errorMessage = "ResultSet null en retour de l'appel à "+ procName;
        }else if(rs.getEntryCount()==0){
          meibo.logError("ResultSet vide en retour de l'appel à "+ procName + " pour les valeurs : " + values);
          errorMessage = "ResultSet vide en retour de l'appel à "+ procName;
        }else{
          var resultEntry = rs.getEntry();
          resultValue = resultEntry.getAttribute(0)[0];
          if(resultValue == "0"){
            meibo.logError("valeur zéro dans le resultset en retour de "+ procName + " pour les valeurs :" + values);
            errorMessage = "L'adresse n'a pas pu être créée";  // pas plus d'explications disponibles ....
          } else{
          // ICI : le cas où c'est censé fonctionner
            meibo.logDebug("Adresse créé :" + resultValue + " avec les valeurs " + values);
            addressId= resultValue;
          }
        }
      }catch(exception){
        // cas qui ne devrait pas arriver mais qui arrive car getResultSet() leve une exception "null" au lieu de renvoyer un resultset vide ou null
        // en pratique les données peuvent très bien avoir été enregistrées
        meibo.logError("Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName + " pour les valeurs : " + values, exception);
        errorMessage = "Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName;
      }
      sqlProcResult.close();
    }
    
  }

  if(addressId!=null){
  
    // enregistrement "manuel" evenement (via procédure stockée) en lieu et place du mécanisme meibo standard/automatique
    values = new Array();
    types = new Array();
    sqlProcResult = null;
    procName= null;
    resultValue = null;

    if(meibo.getFieldValue("fkTET_ID") == "-1"){
    //cas des évenements "from scratch"
      values[0] = meibo.getFieldValue("TET_NAME");
      types[0] = "IN";
      values[1] = meibo.getFieldValue("TCT_URL");
      types[1] = "IN";
      values[2] = meibo.getFieldValue("TCT_COMMENT");
      types[2] = "IN";
      values[3] = meibo.getFieldValue("TET_ISPRIVATE");
      types[3] = "IN";
      values[4] = meibo.getFieldValue("TET_ISTEMPLATE");
      types[4] = "IN";
      values[5] = meibo.getFieldValue("TCT_DURATION");
      types[5] = "IN";
      if(meibo.getFieldValue("TET_AVERAGE_COST").trim()!=""){
        values[6] = meibo.getFieldValue("TET_AVERAGE_COST");
      }else{
        values[6] = null;
      }
      types[6] = "IN";
      values[7] = meibo.getFieldValue("fkTES_ID");
      types[7] = "IN";
      values[8] = meibo.getFieldValue("fkTTY_ID");
      types[8] = "IN";
      //values[9] = new java.sql.Date(DATE_FORMAT.parse(meibo.getFieldValue("TCT_START_DATE")).getTime());
      values[9] = DATE_FORMAT.parse(meibo.getFieldValue("TCT_START_DATE"));
      types[9] = "IN";
      
      // définit l'auteur de l'évenement : utilisateur courant
      var /*Entry*/ userEntry=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ENTRY);
      if(userEntry!=null){    
        values[10] = userEntry.cn[0];
        types[10] = "IN";
      }
      values[11] = addressId;
      types[11] = "IN";
      
      procName = "add_event";
    
    }else{  
    // cas des évenements  "from template"
    //(in eventID int(11),in startDate date, in duration smallint(6),in remark text, in url varchar(1048),in cost float,in prsLogin varchar(255), in addressID int(11))
      values[0] = meibo.getFieldValue("fkTET_ID");
      types[0] = "IN";
      values[1] = DATE_FORMAT.parse(meibo.getFieldValue("TCT_START_DATE"));
      types[1] = "IN";
      values[2] = meibo.getFieldValue("TCT_DURATION");
      types[2] = "IN";
      values[3] = meibo.getFieldValue("TCT_COMMENT");
      types[3] = "IN";
      values[4] = meibo.getFieldValue("TCT_URL");
      types[4] = "IN";
      if(meibo.getFieldValue("TET_AVERAGE_COST").trim()!=""){
        values[5] = meibo.getFieldValue("TET_AVERAGE_COST");
      }else{
        values[5] = null;
      }
      types[5] = "IN";
      // définit l'auteur de l'évenement : utilisateur courant
      var /*Entry*/ userEntry=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ENTRY);
      if(userEntry!=null){    
        values[6] = userEntry.cn[0];
        types[6] = "IN";
      }
      values[7] = addressId;
      types[7] = "IN";
    
      procName = "add_concrete_event";
    
    }
    // appel procédure stockée
    sqlProcResult = meibo.executeSqlProc("TRAVEL_BCOM",procName ,types, values);
    
    // vérification du résultat
    if(sqlProcResult==null){
      meibo.logError("null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
      meibo.setFieldValue("error","null en retour de l'appel à "+ procName);
      meibo.showField("error", true);
    }else{  
      try{
        var rs= sqlProcResult.getResultSet();
        if(rs==null){
          meibo.logError("ResultSet null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
          errorMessage = "ResultSet null en retour de l'appel à "+ procName;
        }else if(rs.getEntryCount()==0){
          meibo.logError("ResultSet vide en retour de l'appel à "+ procName + " pour les valeurs : " + values);
          errorMessage = "ResultSet vide en retour de l'appel à "+ procName;
        }else{
          var resultEntry = rs.getEntry();
          resultValue = resultEntry.getAttribute(0)[0];
          if(resultValue == "0"){
            meibo.logError("valeur zéro dans le resultset en retour de "+ procName + " pour les valeurs :" + values);
            errorMessage = "L'évenement n'a pas pu être créé";  // pas plus d'explications disponibles ....
          } else{
          // ICI : le cas où c'est censé fonctionner
            recordOK = true;
            meibo.logDebug("Evenement créé :" + resultValue + " avec les valeurs " + values);
          }
        }
      }catch(exception){
        // cas qui ne devrait pas arriver mais qui arrive car getResultSet() leve une exception "null" au lieu de renvoyer un resultset vide ou null
        // en pratique les données peuvent très bien avoir été enregistrées
        meibo.logError("Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName + " pour les valeurs : " + values, exception);
        errorMessage = "Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName;
      }
      sqlProcResult.close();
    }
    
  }
    
  if(recordOK){
    if(hasSourceView()){
    // retour et pré-sélection de l'évenement créé
      backToSourceView();
      var /*Edit*/ attendeesIdField = meibo.getField("ATTENDEES_TCT_ID");
      var /*Array*/ attendeesIdFieldContents = attendeesIdField.getContents();
      if(attendeesIdFieldContents==null){
        attendeesIdFieldContents = new Array();
      }
      attendeesIdFieldContents[attendeesIdFieldContents.length] = resultValue;
      attendeesIdField.setContents(attendeesIdFieldContents);
      // Met à jour le contenu du tableau avec les évenements sélectionnés
      updateEventsTableContent(); // fonction pas visible dans ce contexte
      
    }else{
      meibo.switchToApplicationView("Validation_OK");
    }
    //TODO : ou revenir à la vue d'origine ou vue de visualisation ou de modification
  }else{
    meibo.setFieldValue("error",errorMessage);      
    meibo.showField("error", true);
  }
  
}

// contournement du fonctionnement nominal meibo :
// on retourne false pour ne pas que meibo tente ensuite lui même la création automatique de l'entrée comme il le ferait normalement si on ne passait pas par une procédure stockée
meibo.setReturnValue(false);</onquit>
            <onoperationok class="script"/>
            <onoperationko class="script"/>
          </trigger>
        </sequence>
        <sequence name="View" type="0">
          <properties>
            <displayname class="lingual">
              <fr>View</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Event_View.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <AnalyseurDeplacement>true</AnalyseurDeplacement>
            <DDI>true</DDI>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <OrganisateurVoyage>true</OrganisateurVoyage>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script">// formatage date
meibo.setFieldValue("TCT_START_DATE", DATE_FORMAT.format(SQL_DATE_FORMAT.parse(meibo.getFieldValue("TCT_START_DATE")))); 
meibo.setFieldValue("TCT_CREATE_DATE", DATE_FORMAT.format(SQL_DATE_FORMAT.parse(meibo.getFieldValue("TCT_CREATE_DATE"))));

// Met à jour le contenu du tableau de missions
var /*Field*/table = meibo.getField("MISSION_TABLE");
var /*String*/ currentDN=meibo.getCurrentDn();

var /*ResultSet*/ missionRS = meibo.executeLink("EventMission", currentDN, "TMN_ID,TMN_CREATE_DATE,OwnerName");
var /*int*/ line=0;

for each(var mission in missionRS){

  table.addRowObject(line, mission.dn[0]);
  table.addCell(line,0,mission.TMN_ID[0]);          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(mission.TMN_CREATE_DATE[0])));
  table.addCell(line,2,mission.OwnerName[0]);  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="Search" type="4">
          <properties>
            <displayname class="lingual">
              <fr>Search</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Event_Search.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <AnalyseurDeplacement>true</AnalyseurDeplacement>
            <DDI>true</DDI>
            <InitiateurDeplacement>true</InitiateurDeplacement>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">// Ajout d'une "non valeur" dans la liste pour permettre de ne rien sélectionner
var /*Field2*/ typeField= meibo.getField("fkTTY_ID");
typeField.setOptions("-," + typeField.getOptions());
typeField.setParameters(" ," + meibo.getFieldParameters("fkTTY_ID"));
typeField.setValue(" ");
 
 var /*Field2*/ scopeField= meibo.getField("fkTES_ID");
scopeField.setOptions("-," + scopeField.getOptions());
scopeField.setParameters(" ," + meibo.getFieldParameters("fkTES_ID"));
scopeField.setValue(" ");</onload>
            <onquit class="script"/>
          </trigger>
        </sequence>
        <sequence name="Picker" type="7">
          <properties>
            <displayname class="lingual">
              <fr/>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <separator class="separator"/>
            <custompicker class="boolean">true</custompicker>
            <separator class="separator"/>
            <height class="integer">140</height>
            <pickerwidth class="integer">500</pickerwidth>
            <pickerheight class="integer">400</pickerheight>
            <separator class="separator"/>
            <pickerhead class="css">pickerHead</pickerhead>
            <pickerclose class="file">./web\close.gif</pickerclose>
            <separator class="separator"/>
            <displayattributes class="attributes">TCT_START_DATE,TET_NAME,TAS_TOWN (logique)</displayattributes>
          </properties>
          <path>TRAVEL_BCOM_Event_Picker.xml</path>
          <class/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script">// Ajout d'une "non valeur" dans la liste des type d'évenement pour permettre de ne rien sélectionner
var /*Field2*/ typeField= meibo.getField("fkTTY_ID");
typeField.setOptions("-Tous-," + typeField.getOptions());
typeField.setParameters(" ," + meibo.getFieldParameters("fkTTY_ID"));
typeField.setValue(" "); 

var /*Field2*/ scopeField= meibo.getField("fkTES_ID");
scopeField.setOptions("-Toutes-," + scopeField.getOptions());
scopeField.setParameters(" ," + meibo.getFieldParameters("fkTES_ID"));
scopeField.setValue(" ");</onload>
          </trigger>
        </sequence>
      </resource>
      <resource name="EventHeader">
        <properties>
          <displayname class="lingual">
            <fr>EventHeader</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_EVENT_TET</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TES_ID,TET_AVERAGE_COST,TET_COMMENT,TET_DURATION,TET_ID,TET_ISPRIVATE,TET_ISTEMPLATE,TET_NAME,TET_URL,TTY_ID</physical>
            <logical>
              <attribute attrs="TTY_ABBREV" pattern_fr="{0}" resourcelink="EventHeaderEventType" type="link">TTY_ABBREV</attribute>
              <attribute attrs="TES_ABBREV" pattern_fr="{0}" resourcelink="EventHeaderEventScope" type="link">TES_ABBREV</attribute>
              <attribute attrs="TAS_ID" pattern_fr="{0}" resourcelink="EventHeaderRAddress" type="link">TAS_ID</attribute>
            </logical>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TET_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TET_NAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TET_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TET_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file">images/black-star.gif</imageclosed>
          <imageopened class="file">images/green-news.gif</imageopened>
        </properties>
        
        <sequence name="Display" type="0">
          <properties>
            <displayname class="lingual">
              <fr>Display</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_EventHeader_Display.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <DDI>true</DDI>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
      </resource>
      <resource name="EventScope">
        <properties>
          <displayname class="lingual">
            <fr>EventScope</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_EVENT_SCOPE_TES</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TES_ABBREV,TES_ID,TES_NAME</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TES_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TES_NAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TES_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TES_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="EventTemplate">
        <properties>
          <displayname class="lingual">
            <fr>Templates d'évènements</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_EVENT_TET</objectclass>
          <separator class="separator"/>
          <request class="text">select * from T_EVENT_TET where TET_ISPRIVATE=0 and TET_ISTEMPLATE=1</request>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TES_ID,TET_AVERAGE_COST,TET_COMMENT,TET_DURATION,TET_ID,TET_ISPRIVATE,TET_ISTEMPLATE,TET_NAME,TET_URL,TTY_ID</physical>
            <logical>
              <attribute attrs="" pattern_fr="{0}" resourcelink="EventHeaderEventType" type="link">Type</attribute>
            </logical>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TET_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TET_NAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TET_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TET_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file">images/black-star.gif</imageclosed>
          <imageopened class="file">images/green-news.gif</imageopened>
        </properties>
        
        <sequence name="Display" type="0">
          <properties>
            <displayname class="lingual">
              <fr>Display</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_EventTemplate_Display.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <DDI>true</DDI>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
      </resource>
      <resource name="EventType">
        <properties>
          <displayname class="lingual">
            <fr>EventType</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_EVENT_TYPE_TTY</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TTY_ABBREV,TTY_ID,TTY_NAME</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TTY_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TTY_NAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TTY_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TTY_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="InvolvementNature">
        <properties>
          <displayname class="lingual">
            <fr>InvolvementNature</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_INVOLVEMENT_NATURE_TIN</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TIN_ID,TIN_NAME,TIN_ABBREV</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TIN_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TIN_NAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TIN_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TIN_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="Mission">
        <properties>
          <displayname class="lingual">
            <fr>Mission</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_MISSION_TMN</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>PRS_ID,TMN_ESTIMATED_COST,TMN_ID,TMN_WORKFLOW_ID,TMN_ID_ROOT,TMN_CREATE_DATE</physical>
            <logical>
              <attribute attrs="" pattern_fr="{0}" resourcelink="MissionEvent" type="link">Events</attribute>
              <attribute attrs="cn" pattern_fr="{0}" resourcelink="MissionOwnerADPeople" type="link">OwnerCn</attribute>
              <attribute attrs="displayName" pattern_fr="{0}" resourcelink="MissionOwnerPerson" type="link">OwnerName</attribute>
            </logical>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TMN_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TMN_ID</attribute>
            <reverseOrder class="boolean">true</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TMN_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TMN_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file">images/black-folder.gif</imageclosed>
          <imageopened class="file">images/green-database.gif</imageopened>
        </properties>
        
        <sequence name="MissionCreate" type="2">
          <properties>
            <displayname class="lingual">
              <fr>MissionCreate</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
            <onoperationok class="extscript"/>
            <onoperationko class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionCreate.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <InitiateurDeplacement>true</InitiateurDeplacement>
          </rights>
          <trigger>
            <globalScriptView class="script">// Note : des fonctions qui concernent cette vue ont été mises en script global de projet pour pouvoir être utilisées dans le contexte du retour vers cette vue depuis une autre vue</globalScriptView>
            <onload class="script">///$debug
// définit le propriétaire ("initiateur") de la misssion : utilisateur courant par defaut
var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);
meibo.setFieldValue("ATTENDEES_PRS_ID", userId);

// Restaure les valeur précédentes dans le cas où l'on revient sur ce formulaire
restoreFields("Mission");

// Met à jour le contenu du tableau avec les évenements sélectionnés
updateEventsTableContent();</onload>
            <onquit class="script">///$debug
var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);

// sauvegarder au préalable les valeurs des champs dans le tableau
pushEventFieldsDataInTable();

var /*Edit*/ errorField =  meibo.getField("error");
errorField.show(false);

var /*boolean*/ checkOK = true;
checkOK = checkOK &amp;&amp; checkMandatoryField("ATTENDEES_PRS_ID", 1);
//checkOK = checkOK &amp;&amp; checkMandatoryField("ATTENDEES_TCT_ID", 1);

// TODO : vérifier que l'utilisateur connecté n'a pas été retiré de la liste
// (pour s'appuyer sur ce principe pour avoir la trace de l'initiateur de la mission)

//TODO : vérifier si chaque participant désigné n'est pas déjà participant aux évenements de cette mission (dans le cadre d'une autre mission)
// car l'association entre evenement et participant n'est pas liée à une mission, cela poserait donc problème en cas d'abandon ou refus d'une mission si 2 missions parallèles référencent un même évenement
// d'autre part, en cas de 2 missions sur un même participant/évenement, il y aurait un risque de se retrouver avec l'organisation déplacement en double

// vérifier si objectif et types de participation sont bien définis pour cheque évenement sélectionné
var /*Table*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ value = null;
var /*String*/ msg = null;
for(var line=0;line&lt;table.getLength();line++){
  value = table.getCell(line,3);
  if(value == "A DEFINIR"){
    checkOK = false;
    msg = meibo.getMessage("mandatoryField", "Objectif");
    break;
  }
  value = table.getCell(line,4);
  if(value == "A DEFINIR"){
    checkOK = false;
    msg = meibo.getMessage("mandatoryField", "Type de participation");
    break;
  }        
}
if(!checkOK){  
  errorField.setContent(msg);
  errorField.show(true);
}    
    

if(checkOK){
  // enregistrement "manuel" (via procédure stockée) en lieu et place du mécanisme meibo standard/automatique

  var /*boolean*/ recordOK = true;
  var /*String*/ errorMessage = null;
  
  var /*Number*/ cost = null;
  if(meibo.getFieldValue("TMN_ESTIMATED_COST").trim().length&gt;0){
    cost = NUMBERFORMAT_INSTANCE.parse(meibo.getFieldValue("TMN_ESTIMATED_COST"));
  }

  var /*Array*/ events  = meibo.getField("ATTENDEES_TCT_ID").getContents();
  var /*Array*/ owners = meibo.getField("ATTENDEES_PRS_ID").getContents();
  var rootMissionId = null;
  
  var /*Array*/ values = new Array();
  var /*Array*/ types = new Array();
  var /*SqlProcResult*/ sqlProcResult = null;
  var resultValue = null;
  var /*String*/ procName = null;
  var /*ResultSet*/ rs = null;
  var /*Array*/ missionIds = new Array();
  var /*Entry*/ resultEntry = null;
  var involvementAbbrev = null;
  var purposeAbbrev = null;
  var involvementId = null;
  var purposeId = null;  
  var startDate = null;
  var endDate = null;
  var /*ResultSet*/ involvementNatureRS = null;
  var /*Entry*/ involvementNatureEntry = null;
  var /*ResultSet*/ purposeRS = null;
  var /*Entry*/ purposeEntry = null;

  meibo.beginTransaction("TRAVEL_BCOM");

  try{
  
    // parcours des participants pour créer à chacun une mission
    for each(var ownerId in owners){
    
      values[0] = cost;
      types[0] = "IN";  
      values[1] = ownerId;
      types[1] = "IN";
      values[2] = rootMissionId;
      types[2] = "IN";
      procName = "add_mission";
      resultValue = null;
      resultEntry = null;
      
      // appel procédure stockée pour creation mission
      sqlProcResult = meibo.executeSqlProc("TRAVEL_BCOM", procName, types, values);
    
      // vérification du résultat
      if(sqlProcResult==null){
        meibo.logError("null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
        throw "null en retour de l'appel à "+ procName;
      }else{  
      
        try{
          rs= sqlProcResult.getResultSet();
        }catch(exception){
          // cas qui ne devrait pas arriver mais qui arrive car getResultSet() leve une exception "null" au lieu de renvoyer un resultset vide ou null
          // en pratique les données peuvent très bien avoir été enregistrées
          meibo.logError("Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName + " pour les valeurs : " + values, exception);
          sqlProcResult.close();
          throw "Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName;
        }
        try{        
          if(rs==null){
            meibo.logError("ResultSet null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
            throw "ResultSet null en retour de l'appel à "+ procName;
          }else if(rs.getEntryCount()==0){
            meibo.logError("ResultSet vide en retour de l'appel à "+ procName + " pour les valeurs : " + values);
            throw  "ResultSet vide en retour de l'appel à "+ procName;
          }else{
            resultEntry = rs.getEntry();
            resultValue = resultEntry.getAttribute(0)[0];
            if(resultValue == "0"){
              meibo.logError("valeur zéro dans le resultset en retour de "+ procName + " pour les valeurs :" + values);
              throw  "La mission n'a pas pu être créée";  // pas plus d'explications disponibles ....
            }
          }
          sqlProcResult.close();
          
          // ICI : le cas où c'est censé fonctionner
          if(rootMissionId == null){
            rootMissionId = resultValue;
          }
          missionIds[missionIds.length] = resultValue;
          meibo.logDebug("Mission créée :" + resultValue + " avec les valeurs " + values);
          
          // ajouter evenements à mission ; et participant à évenments
          var eventIndex = 0;
          for each(var eventId in events){
            // relie les évenements à la mission
            var eventMissionEntry = new Entry();
            eventMissionEntry.updateAttribute(new Attribute("TMN_ID",resultValue));
            eventMissionEntry.updateAttribute(new Attribute("TCT_ID",eventId));
            
            var entryCreationOK = meibo.createEntry("R_EventMission",null,eventMissionEntry);
            if(!entryCreationOK){
              meibo.logError("Echec de création de l'entrée " + eventMissionEntry);
              throw "Impossible d'associer mission et évenement";
            }
          
            // ajouter participant à evenement
            startDate = SQL_DATE_FORMAT.format(DATE_FORMAT.parse(table.getCell(eventIndex,1)));
            endDate = SQL_DATE_FORMAT.format(DATE_FORMAT.parse(table.getCell(eventIndex,2)));
            purposeAbbrev = table.getCell(eventIndex,3);
            involvementAbbrev = table.getCell(eventIndex,4);

            involvementId = getIdFromAbbrev("InvolvementNature","TIN", involvementAbbrev);

            purposeId = getIdFromAbbrev("Purpose","TPE", purposeAbbrev);         
            
            var eventAttendeesEntry = new Entry();
            eventAttendeesEntry.updateAttribute(new Attribute("TCT_ID",eventId));
            eventAttendeesEntry.updateAttribute(new Attribute("PRS_ID",ownerId));
            eventAttendeesEntry.updateAttribute(new Attribute("RAS_START_DATE",startDate));
            eventAttendeesEntry.updateAttribute(new Attribute("RAS_END_DATE",endDate));
            
            eventAttendeesEntry.updateAttribute(new Attribute("TPE_ID",purposeId));            
            eventAttendeesEntry.updateAttribute(new Attribute("TIN_ID",involvementId));            
                        
            eventAttendeesEntry.updateAttribute(new Attribute("PRS_ID",ownerId));
            
            entryCreationOK = meibo.createEntry("R_Attendees",null,eventAttendeesEntry);
            if(!entryCreationOK){
              meibo.logError("Echec de création de l'entrée " + eventAttendeesEntry);
              throw "Impossible d'associer participant et évenement";
            }
                 
            eventIndex++;
          }
          
          // definir status mission
          updateMissionStatus(resultValue, userId, "CRE", null);
          
        }catch(exception){
          sqlProcResult.close();
          throw exception;
        }      
          
      } // if(sqlProcResult==null)
    } // for each

    var commitResultOK = meibo.commit("TRAVEL_BCOM");
    recordOK = commitResultOK;
    if(commitResultOK){
      meibo.logDebug("Missions créées :" + missionIds);      
    }else{
      meibo.logError("retour KO sur le commit de la transaction pour la mission  :" + resultValue + " avec les valeurs " + values);
      errorMessage =  "Echec de la transaction";
    }
        
  }catch(exception){
    // cas qui ne devrait pas arriver mais qui arrive car getResultSet() leve une exception "null" au lieu de renvoyer un resultset vide ou null
    // en pratique les données peuvent très bien avoir été enregistrées
    meibo.logError("Erreur sur l'enregistrement des données suite à l'appel à " + procName + " pour les valeurs : " + values + " : " exception);
    recordOK = false;
    errorMessage = exception;
    try{
      var rollBackResultOK = meibo.rollBack("TRAVEL_BCOM");
      if(rollBackResultOK){
        meibo.logInfo("Transaction annulée");
      }else{
        throw "Le rollback de la transaction renvoi false";
      }
    }catch(exception2){
      meibo.logError("Erreur sur le rollback de la transaction", exception);
      errorMessage = errorMessage + "; Echec d'annulation de la transation";
    }
  }

  if(recordOK){

    // créer et lancer workflows pour chaque mission
    var /*wapiProcInst*/ wapiProcInst = null;
    var /*int*/ missionIndex = 0;
    var /*Entry*/ missionEntry = null;
    var /*Entry*/ personEntry = null;
    
    for each(var missionId in missionIds){
      meibo.logDebug("Preparation du workflow pour la mission " + missionId);

      personEntry = meibo.getDnEntry("TravelPeople","T_PERSON_PRS,PRS_ID," + owners[missionIndex], "ldapDn,PRS_LOGIN,displayName");

      try{
        wapiProcInst = meibo.createWorkflowProcess("Mission");
        wapiProcInst.addDescription("fr","Mission pour " + personEntry.displayName[0]);
        wapiProcInst.setVariable("missionID", missionId);        
        wapiProcInst.setVariable("participantID", owners[missionIndex]);
        wapiProcInst.setVariable("initiatorID", userId);
        wapiProcInst.setVariable("baseURL", getBaseURLForWorkflow());
        wapiProcInst.start();
        meibo.logDebug("Id du workflow pour la mission " + missionId + " de l'utilisateur " + owners[missionIndex] + " : "  + wapiProcInst.getId());   
           
      }catch(exception){
        meibo.logDebug("Echec du lancement de workflow pour la mission " + missionId + " : " + exception);
        errorField.setContent("Echec du lancement de workflow");
        errorField.show(true);
        break;
      } 
      
      missionEntry = new Entry();
      //missionEntry.updateAttribute(new Attribute("TMN_ID", missionId));
      missionEntry.updateAttribute(new Attribute("TMN_WORKFLOW_ID", wapiProcInst.getId()));
      var entryUpdateOK = meibo.updateEntry("Mission","T_MISSION_TMN,TMN_ID," + missionId, missionEntry);
      if(!entryUpdateOK){
        meibo.logError("Echec de mise à jour de l'identifiant de workflow de la mission " + missionId);
        errorField.setContent("Erreur sur l'affectation de l'identifiant de workflow");
        errorField.show(true);
        break;        
      }
                                  
       missionIndex++;
    }
    
    meibo.switchToApplicationView("Validation_OK");  
    //TODO : ou vue de visualisation ou de modification ou liste des missions ?
    
  }else{    
    errorField.setContent(errorMessage);
    errorField.show(true);      
  }
  
} //if(checkOK)

// contournement du fonctionnement nominal meibo :
// on retourne false pour ne pas que meibo tente ensuite lui même la création automatique de l'entrée comme il le ferait normalement si on ne passait pas par une procédure stockée
meibo.setReturnValue(false);</onquit>
            <onoperationok class="script"/>
            <onoperationko class="script"/>
          </trigger>
        </sequence>
        <sequence name="MissionDisplay" type="0">
          <properties>
            <displayname class="lingual">
              <fr>MissionAccept</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionDisplay.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <OrganisateurVoyage>true</OrganisateurVoyage>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">///$debug
// Met à jour le contenu du tableau d'evenements
var /*Field*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ownerID = meibo.getFieldValue("PRS_ID");
var /*String*/ currentDN=meibo.getCurrentDn();

var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", currentDN,"fkTCT_ID,TET_NAME");
var /*ResultSet*/ eventAttendeesRS = null;
var /*Entry*/ eventAttendeesEntry = null;
var /*int*/ line=0;
var missionId=null;

for each(var missionEvent in missionEventRS){

  missionId = missionEvent.fkTCT_ID[0]
  table.addRowObject(line, missionEvent.dn[0]);
  table.addCell(line,0,missionEvent.TET_NAME[0]);
  
  eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID="+ ownerID + " AND TCT_ID="+missionId ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
  eventAttendeesEntry = eventAttendeesRS.getEntry();
          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0])));
  table.addCell(line,2,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0])));
  table.addCell(line,3,eventAttendeesEntry.TPE_NAME[0]);
  table.addCell(line,4,eventAttendeesEntry.TIN_NAME[0]); 
  
  line++ 
}

// Met à jour le contenu du tableau d'historique
table = meibo.getField("HISTORY_TABLE");

var /*ResultSet*/ missionHistoryRS = meibo.executeLink("MissionRStatus", currentDN,"TST_TMN_DATE,TST_TMN_COMMENT,peopleName,TST_NAME");
line = 0;

for each(var statusEntry in missionHistoryRS){

  //table.addRowObject(line, statusEntry.fkTCT_ID[0]);
  table.addCell(line,0,statusEntry.peopleName[0]);
  table.addCell(line,1,DATETIME_FORMAT.format(SQL_DATETIME_FORMAT.parse(statusEntry.TST_TMN_DATE[0])));
  table.addCell(line,2,statusEntry.TST_NAME[0]);
  table.addCell(line,3,statusEntry.TST_TMN_COMMENT[0]);
  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="MissionAccept" type="0">
          <properties>
            <displayname class="lingual">
              <fr>MissionAccept</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionAccept.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">///$debug
try{
  var lastComment = meibo.getWorkflowVariable("comment");
  if ((lastComment != null) &amp;&amp; (lastComment!="")) {
    meibo.showField("lastCommentLayout",true);
    meibo.getField("LAST_COMMENT").setValue("" + lastComment);
  }else{
    meibo.showField("lastCommentLayout",false);
  }
}catch(exception){
  meibo.logWarn("Erreur sur récupération de variable de wokflow 'comment' : " + exception);
}



///$debug
// utilisateur courant
//var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);


// récupération de l'initiateur de la mission si ce n'est pas le titulaire
var /*String*/ currentDN=meibo.getCurrentDn();
var /*ResultSet*/ rootMissionRS = meibo.executeLink("MissionRootMission", currentDN);

if((rootMissionRS!=null) &amp;&amp; (rootMissionRS.getEntryCount()&gt;0)){
  var /*Entry*/ rootMissionEntry = rootMissionRS.getEntry();
  var rootMissionDn= rootMissionEntry.getDn();
  var /*ResultSet*/ adPeopleOwnerRS = meibo.executeLink("MissionOwnerADPeople", rootMissionDn, "cn,sn,givenName");
  if((adPeopleOwnerRS!=null) &amp;&amp; (adPeopleOwnerRS.getEntryCount()&gt;0)){
    var /*Entry*/ adPeopleOwnerEntry = adPeopleOwnerRS.getEntry();
    meibo.setFieldValue("titleView","Mission proposée par " + adPeopleOwnerEntry.givenName[0] + " " + adPeopleOwnerEntry.sn[0] + " (" + adPeopleOwnerEntry.cn[0] + ")");
  }
}

// Restaure les valeur précédentes dans le cas où l'on revient sur ce formulaire
//restoreFields("Mission");

// Met à jour le contenu du tableau

var /*Field*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ownerID = meibo.getFieldValue("PRS_ID");

var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", currentDN,"fkTCT_ID,TET_NAME");
var /*ResultSet*/ eventAttendeesRS = null;
var /*Entry*/ eventAttendeesEntry = null;
var /*int*/ line=0;
var missionId=null;

for each(var missionEvent in missionEventRS){

  missionId = missionEvent.fkTCT_ID[0]
  table.addRowObject(line, missionEvent.fkTCT_ID[0]);
  table.addCell(line,0,missionEvent.TET_NAME[0]);
  
  eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID="+ ownerID + " AND TCT_ID="+missionId ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
  eventAttendeesEntry = eventAttendeesRS.getEntry();
          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0])));
  table.addCell(line,2,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0])));
  table.addCell(line,3,eventAttendeesEntry.TPE_NAME[0]);
  table.addCell(line,4,eventAttendeesEntry.TIN_NAME[0]); 
  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="MissionValidate" type="0">
          <properties>
            <displayname class="lingual">
              <fr>MissionAccept</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionValidate.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">///$debug
try{
  var lastComment = meibo.getWorkflowVariable("comment");
  if ((lastComment != null) &amp;&amp; (lastComment!="")) {
    meibo.showField("lastCommentLayout",true);
    meibo.getField("LAST_COMMENT").setValue("" + lastComment);
  }else{
    meibo.showField("lastCommentLayout",false);
  }
}catch(exception){
  meibo.logWarn("Erreur sur récupération de variable de wokflow 'comment' : " + exception);
}



///$debug
// utilisateur courant
//var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);


// récupération de l'initiateur de la mission si ce n'est pas le titulaire
var /*String*/ currentDN=meibo.getCurrentDn();
var /*ResultSet*/ rootMissionRS = meibo.executeLink("MissionRootMission", currentDN);

if((rootMissionRS!=null) &amp;&amp; (rootMissionRS.getEntryCount()&gt;0)){
  var /*Entry*/ rootMissionEntry = rootMissionRS.getEntry();
  var rootMissionDn= rootMissionEntry.getDn();
  var /*ResultSet*/ adPeopleOwnerRS = meibo.executeLink("MissionOwnerADPeople", rootMissionDn, "cn,sn,givenName");
  if((adPeopleOwnerRS!=null) &amp;&amp; (adPeopleOwnerRS.getEntryCount()&gt;0)){
    var /*Entry*/ adPeopleOwnerEntry = adPeopleOwnerRS.getEntry();
    meibo.setFieldValue("titleView","Mission proposée par " + adPeopleOwnerEntry.givenName[0] + " " + adPeopleOwnerEntry.sn[0] + " (" + adPeopleOwnerEntry.cn[0] + ")");
  }
}

// Restaure les valeur précédentes dans le cas où l'on revient sur ce formulaire
//restoreFields("Mission");

// Met à jour le contenu du tableau

var /*Field*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ownerID = meibo.getFieldValue("PRS_ID");

var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", currentDN,"fkTCT_ID,TET_NAME");
var /*ResultSet*/ eventAttendeesRS = null;
var /*Entry*/ eventAttendeesEntry = null;
var /*int*/ line=0;
var missionId=null;

for each(var missionEvent in missionEventRS){

  missionId = missionEvent.fkTCT_ID[0]
  table.addRowObject(line, missionEvent.fkTCT_ID[0]);
  table.addCell(line,0,missionEvent.TET_NAME[0]);
  
  eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID="+ ownerID + " AND TCT_ID="+missionId ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
  eventAttendeesEntry = eventAttendeesRS.getEntry();
          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0])));
  table.addCell(line,2,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0])));
  table.addCell(line,3,eventAttendeesEntry.TPE_NAME[0]);
  table.addCell(line,4,eventAttendeesEntry.TIN_NAME[0]); 
  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="MissionCompleteForOrganisation" type="0">
          <properties>
            <displayname class="lingual">
              <fr>MissionAccept</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionCompleteForOrganisation.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">///$debug
try{
  var lastComment = meibo.getWorkflowVariable("comment");
  if ((lastComment != null) &amp;&amp; (lastComment!="")) {
    meibo.showField("lastCommentLayout",true);
    meibo.getField("LAST_COMMENT").setValue("" + lastComment);
  }else{
    meibo.showField("lastCommentLayout",false);
  }
}catch(exception){
  meibo.logWarn("Erreur sur récupération de variable de wokflow 'comment' : " + exception);
}



///$debug
// utilisateur courant
//var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);


// récupération de l'initiateur de la mission si ce n'est pas le titulaire
var /*String*/ currentDN=meibo.getCurrentDn();
var /*ResultSet*/ rootMissionRS = meibo.executeLink("MissionRootMission", currentDN);

if((rootMissionRS!=null) &amp;&amp; (rootMissionRS.getEntryCount()&gt;0)){
  var /*Entry*/ rootMissionEntry = rootMissionRS.getEntry();
  var rootMissionDn= rootMissionEntry.getDn();
  var /*ResultSet*/ adPeopleOwnerRS = meibo.executeLink("MissionOwnerADPeople", rootMissionDn, "cn,sn,givenName");
  if((adPeopleOwnerRS!=null) &amp;&amp; (adPeopleOwnerRS.getEntryCount()&gt;0)){
    var /*Entry*/ adPeopleOwnerEntry = adPeopleOwnerRS.getEntry();
    meibo.setFieldValue("titleView","Mission proposée par " + adPeopleOwnerEntry.givenName[0] + " " + adPeopleOwnerEntry.sn[0] + " (" + adPeopleOwnerEntry.cn[0] + ")");
  }
}

// Restaure les valeur précédentes dans le cas où l'on revient sur ce formulaire
//restoreFields("Mission");

// Met à jour le contenu du tableau

var /*Field*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ownerID = meibo.getFieldValue("PRS_ID");

var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", currentDN,"fkTCT_ID,TET_NAME");
var /*ResultSet*/ eventAttendeesRS = null;
var /*Entry*/ eventAttendeesEntry = null;
var /*int*/ line=0;
var missionId=null;

for each(var missionEvent in missionEventRS){

  missionId = missionEvent.fkTCT_ID[0]
  table.addRowObject(line, missionEvent.fkTCT_ID[0]);
  table.addCell(line,0,missionEvent.TET_NAME[0]);
  
  eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID="+ ownerID + " AND TCT_ID="+missionId ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
  eventAttendeesEntry = eventAttendeesRS.getEntry();
          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0])));
  table.addCell(line,2,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0])));
  table.addCell(line,3,eventAttendeesEntry.TPE_NAME[0]);
  table.addCell(line,4,eventAttendeesEntry.TIN_NAME[0]); 
  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="MissionOrganise" type="0">
          <properties>
            <displayname class="lingual">
              <fr>MissionAccept</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionOrganise.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <OrganisateurVoyage>true</OrganisateurVoyage>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">///$debug
try{
  var lastComment = meibo.getWorkflowVariable("comment");
  if ((lastComment != null) &amp;&amp; (lastComment!="")) {
    meibo.showField("lastCommentLayout",true);
    meibo.getField("LAST_COMMENT").setValue("" + lastComment);
    // commentaire organisateur par défaut = demande de l'utilisateur
    meibo.getField("COMMENT").setValue("" + lastComment);    
  }else{
    meibo.showField("lastCommentLayout",false);
  }
}catch(exception){
  meibo.logWarn("Erreur sur récupération de variable de wokflow 'comment' : " + exception);
}



///$debug
// utilisateur courant
//var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);


// récupération de l'initiateur de la mission si ce n'est pas le titulaire
var /*String*/ currentDN=meibo.getCurrentDn();
var /*ResultSet*/ rootMissionRS = meibo.executeLink("MissionRootMission", currentDN);

if((rootMissionRS!=null) &amp;&amp; (rootMissionRS.getEntryCount()&gt;0)){
  var /*Entry*/ rootMissionEntry = rootMissionRS.getEntry();
  var rootMissionDn= rootMissionEntry.getDn();
  var /*ResultSet*/ adPeopleOwnerRS = meibo.executeLink("MissionOwnerADPeople", rootMissionDn, "cn,sn,givenName");
  if((adPeopleOwnerRS!=null) &amp;&amp; (adPeopleOwnerRS.getEntryCount()&gt;0)){
    var /*Entry*/ adPeopleOwnerEntry = adPeopleOwnerRS.getEntry();
    meibo.setFieldValue("titleView","Mission proposée par " + adPeopleOwnerEntry.givenName[0] + " " + adPeopleOwnerEntry.sn[0] + " (" + adPeopleOwnerEntry.cn[0] + ")");
  }
}

// Restaure les valeur précédentes dans le cas où l'on revient sur ce formulaire
//restoreFields("Mission");

// Met à jour le contenu du tableau

var /*Field*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ownerID = meibo.getFieldValue("PRS_ID");

var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", currentDN,"fkTCT_ID,TET_NAME");
var /*ResultSet*/ eventAttendeesRS = null;
var /*Entry*/ eventAttendeesEntry = null;
var /*int*/ line=0;
var missionId=null;

for each(var missionEvent in missionEventRS){

  missionId = missionEvent.fkTCT_ID[0]
  table.addRowObject(line, missionEvent.fkTCT_ID[0]);
  table.addCell(line,0,missionEvent.TET_NAME[0]);
  
  eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID="+ ownerID + " AND TCT_ID="+missionId ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
  eventAttendeesEntry = eventAttendeesRS.getEntry();
          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0])));
  table.addCell(line,2,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0])));
  table.addCell(line,3,eventAttendeesEntry.TPE_NAME[0]);
  table.addCell(line,4,eventAttendeesEntry.TIN_NAME[0]); 
  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="MissionOrder" type="0">
          <properties>
            <displayname class="lingual">
              <fr>MissionAccept</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionOrder.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">///$debug
try{
  var lastComment = meibo.getWorkflowVariable("organisationComment");
  if ((lastComment != null) &amp;&amp; (lastComment!="")) {
    meibo.showField("lastCommentLayout",true);
    meibo.getField("LAST_COMMENT").setValue("" + lastComment);
    
    // Note les vues qui ne sont pas appelée directement par le workflow n'accèdent pas à la tache de workflow; elles n'ont donc pas accès à ses variables
    // Ceci est donc problématique pour la vue utilisée pour la création du PDF
    // On transmet donc les infos par variables globale
    meibo.setGlobalVar("CurrentMissionComment" , lastComment);
  }else{
    meibo.showField("lastCommentLayout",false);
  }
}catch(exception){
  meibo.logWarn("Erreur sur récupération de variable de wokflow 'organisationComment' : " + exception);
}



///$debug
// utilisateur courant
//var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);


// récupération de l'initiateur de la mission si ce n'est pas le titulaire
var /*String*/ currentDN=meibo.getCurrentDn();
var /*ResultSet*/ rootMissionRS = meibo.executeLink("MissionRootMission", currentDN);

if((rootMissionRS!=null) &amp;&amp; (rootMissionRS.getEntryCount()&gt;0)){
  var /*Entry*/ rootMissionEntry = rootMissionRS.getEntry();
  var rootMissionDn= rootMissionEntry.getDn();
  var /*ResultSet*/ adPeopleOwnerRS = meibo.executeLink("MissionOwnerADPeople", rootMissionDn, "cn,sn,givenName");
  if((adPeopleOwnerRS!=null) &amp;&amp; (adPeopleOwnerRS.getEntryCount()&gt;0)){
    var /*Entry*/ adPeopleOwnerEntry = adPeopleOwnerRS.getEntry();
    meibo.setFieldValue("titleView","Mission proposée par " + adPeopleOwnerEntry.givenName[0] + " " + adPeopleOwnerEntry.sn[0] + " (" + adPeopleOwnerEntry.cn[0] + ")");
  }
}

// Restaure les valeur précédentes dans le cas où l'on revient sur ce formulaire
//restoreFields("Mission");

// Met à jour le contenu du tableau

var /*Field*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ownerID = meibo.getFieldValue("PRS_ID");

var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", currentDN,"fkTCT_ID,TET_NAME");
var /*ResultSet*/ eventAttendeesRS = null;
var /*Entry*/ eventAttendeesEntry = null;
var /*int*/ line=0;
var missionId=null;

for each(var missionEvent in missionEventRS){

  missionId = missionEvent.fkTCT_ID[0]
  table.addRowObject(line, missionEvent.fkTCT_ID[0]);
  table.addCell(line,0,missionEvent.TET_NAME[0]);
  
  eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID="+ ownerID + " AND TCT_ID="+missionId ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
  eventAttendeesEntry = eventAttendeesRS.getEntry();
          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0])));
  table.addCell(line,2,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0])));
  table.addCell(line,3,eventAttendeesEntry.TPE_NAME[0]);
  table.addCell(line,4,eventAttendeesEntry.TIN_NAME[0]); 
  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="MissionOrderPrint" type="0">
          <properties>
            <displayname class="lingual">
              <fr>MissionAccept</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionOrderPrint.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">///$debug
var lastComment = null;
try{
  lastComment = meibo.getWorkflowVariable("organisationComment");
}catch(exception){
    // Note les vues qui ne sont pas appelée directement par le workflow n'accèdent pas à la tache de workflow; elles n'ont donc pas accès à ses variables
    // Ceci est donc problématique pour la vue utilisée pour la création du PDF
    // On récupère donc les infos par variables globale
    lastComment = meibo.getGlobalVar("CurrentMissionComment");
}
if ((lastComment != null) &amp;&amp; (lastComment!="")) {
  meibo.showField("lastCommentLayout",true);
  meibo.getField("LAST_COMMENT").setValue("" + lastComment);
}else{
  meibo.showField("lastCommentLayout",false);
}


// Met à jour le contenu du tableau
var /*Field*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ownerID = meibo.getFieldValue("PRS_ID");
var /*String*/ currentDN=meibo.getCurrentDn();

var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", currentDN,"fkTCT_ID,TET_NAME");
var /*ResultSet*/ eventAttendeesRS = null;
var /*Entry*/ eventAttendeesEntry = null;
var /*int*/ line=0;
var missionId=null;

for each(var missionEvent in missionEventRS){

  missionId = missionEvent.fkTCT_ID[0]
  table.addRowObject(line, missionEvent.fkTCT_ID[0]);
  table.addCell(line,0,missionEvent.TET_NAME[0]);
  
  eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID="+ ownerID + " AND TCT_ID="+missionId ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
  eventAttendeesEntry = eventAttendeesRS.getEntry();
          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0])));
  table.addCell(line,2,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0])));
  table.addCell(line,3,eventAttendeesEntry.TPE_NAME[0]);
  table.addCell(line,4,eventAttendeesEntry.TIN_NAME[0]); 
  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="MissionLevel2Validate" type="0">
          <properties>
            <displayname class="lingual">
              <fr>MissionAccept</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionLevel2Validate.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <InitiateurDeplacement>true</InitiateurDeplacement>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"/>
            <onload class="script">///$debug
try{
  var lastComment = meibo.getWorkflowVariable("comment");
  if ((lastComment != null) &amp;&amp; (lastComment!="")) {
    meibo.showField("lastCommentLayout",true);
    meibo.getField("LAST_COMMENT").setValue("" + lastComment);
  }else{
    meibo.showField("lastCommentLayout",false);
  }
}catch(exception){
  meibo.logWarn("Erreur sur récupération de variable de wokflow 'comment' : " + exception);
}



///$debug
// utilisateur courant
//var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);


// récupération de l'initiateur de la mission si ce n'est pas le titulaire
var /*String*/ currentDN=meibo.getCurrentDn();
var /*ResultSet*/ rootMissionRS = meibo.executeLink("MissionRootMission", currentDN);

if((rootMissionRS!=null) &amp;&amp; (rootMissionRS.getEntryCount()&gt;0)){
  var /*Entry*/ rootMissionEntry = rootMissionRS.getEntry();
  var rootMissionDn= rootMissionEntry.getDn();
  var /*ResultSet*/ adPeopleOwnerRS = meibo.executeLink("MissionOwnerADPeople", rootMissionDn, "cn,sn,givenName");
  if((adPeopleOwnerRS!=null) &amp;&amp; (adPeopleOwnerRS.getEntryCount()&gt;0)){
    var /*Entry*/ adPeopleOwnerEntry = adPeopleOwnerRS.getEntry();
    meibo.setFieldValue("titleView","Mission proposée par " + adPeopleOwnerEntry.givenName[0] + " " + adPeopleOwnerEntry.sn[0] + " (" + adPeopleOwnerEntry.cn[0] + ")");
  }
}

// Restaure les valeur précédentes dans le cas où l'on revient sur ce formulaire
//restoreFields("Mission");

// Met à jour le contenu du tableau

var /*Field*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ownerID = meibo.getFieldValue("PRS_ID");

var /*ResultSet*/ missionEventRS = meibo.executeLink("MissionEvent", currentDN,"fkTCT_ID,TET_NAME");
var /*ResultSet*/ eventAttendeesRS = null;
var /*Entry*/ eventAttendeesEntry = null;
var /*int*/ line=0;
var missionId=null;

for each(var missionEvent in missionEventRS){

  missionId = missionEvent.fkTCT_ID[0]
  table.addRowObject(line, missionEvent.fkTCT_ID[0]);
  table.addCell(line,0,missionEvent.TET_NAME[0]);
  
  eventAttendeesRS = meibo.executeResource("R_Attendees","PRS_ID="+ ownerID + " AND TCT_ID="+missionId ,1,"TPE_NAME,TIN_NAME,RAS_START_DATE,RAS_END_DATE");
  eventAttendeesEntry = eventAttendeesRS.getEntry();
          
  table.addCell(line,1,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_START_DATE[0])));
  table.addCell(line,2,DATE_FORMAT.format(SQL_DATE_FORMAT.parse(eventAttendeesEntry.RAS_END_DATE[0])));
  table.addCell(line,3,eventAttendeesEntry.TPE_NAME[0]);
  table.addCell(line,4,eventAttendeesEntry.TIN_NAME[0]); 
  
  line++ 
}</onload>
          </trigger>
        </sequence>
        <sequence name="MissionUpdate" type="1">
          <properties>
            <displayname class="lingual">
              <fr>MissionUpdate</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
            <onoperationok class="extscript"/>
            <onoperationko class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Mission_MissionUpdate.xml</path>
          <class/>
          <rights/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script">///$debug
// utilisateur courant
var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);


// récupération de l'initiateur de la mission si ce n'est pas le titulaire
var /*String*/ currentDN=meibo.getCurrentDn();
var /*ResultSet*/ rootMissionRS = meibo.executeLink("MissionRootMission", currentDN);

if((rootMissionRS!=null) &amp;&amp; (rootMissionRS.getEntryCount()&gt;0)){
  var /*Entry*/ rootMissionEntry = rootMissionRS.getEntry();
  var rootMissionDn= rootMissionEntry.getDn();
  var /*ResultSet*/ adPeopleOwnerRS = meibo.executeLink("MissionOwnerADPeople", rootMissionDn, "cn,sn,givenName");
  if((adPeopleOwnerRS!=null) &amp;&amp; (adPeopleOwnerRS.getEntryCount()&gt;0)){
    var /*Entry*/ adPeopleOwnerEntry = adPeopleOwnerRS.getEntry();
    meibo.setFieldValue("titleView","Mission proposée par " + adPeopleOwnerEntry.givenName[0] + " " + adPeopleOwnerEntry.sn[0] + " (" + adPeopleOwnerEntry.cn[0] + ")");
  }
}

// Restaure les valeur précédentes dans le cas où l'on revient sur ce formulaire
restoreFields("Mission");

// Met à jour le contenu du tableau avec les évenements sélectionnés
updateEventsTableContent();</onload>
            <onquit class="script">///$debug
var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);

// sauvegarder au préalable les valeurs des champs dans le tableau
pushEventFieldsDataInTable();

var /*Edit*/ errorField =  meibo.getField("error");
errorField.show(false);

var /*boolean*/ checkOK = true;
checkOK = checkOK &amp;&amp; checkMandatoryField("ATTENDEES_PRS_ID", 1);


//TODO : vérifier si chaque participant désigné n'est pas déjà participant aux évenements de cette mission (dans le cadre d'une autre mission)
// car l'association entre evenement et participant n'est pas liée à une mission, cela poserait donc problème en cas d'abandon ou refus d'une mission si 2 missions parallèles référencent un même évenement
// d'autre part, en cas de 2 missions sur un même participant/évenement, il y aurait un risque de se retrouver avec l'organisation déplacement en double

// vérifier si objectif et types de participation sont bien définis pour cheque évenement sélectionné
var /*Table*/table = meibo.getField("EVENTS_TABLE");
var /*String*/ value = null;
var /*String*/ msg = null;
for(var line=0;line&lt;table.getLength();line++){
  value = table.getCell(line,3);
  if(value == "A DEFINIR"){
    checkOK = false;
    msg = meibo.getMessage("mandatoryField", "Objectif");
    break;
  }
  value = table.getCell(line,4);
  if(value == "A DEFINIR"){
    checkOK = false;
    msg = meibo.getMessage("mandatoryField", "Type de participation");
    break;
  }        
}
if(!checkOK){  
  errorField.setContent(msg);
  errorField.show(true);
}    
    

if(checkOK){
  // enregistrement "manuel" (via procédure stockée) en lieu et place du mécanisme meibo standard/automatique

  var /*boolean*/ recordOK = true;
  var /*String*/ errorMessage = null;
  
  var /*Number*/ cost = null;
  if(meibo.getFieldValue("TMN_ESTIMATED_COST").trim().length&gt;0){
    cost = NUMBERFORMAT_INSTANCE.parse(meibo.getFieldValue("TMN_ESTIMATED_COST"));
  }

  var /*Array*/ events  = meibo.getField("ATTENDEES_TCT_ID").getContents();
  var /*Array*/ owners = meibo.getField("ATTENDEES_PRS_ID").getContents();
  var rootMissionId = null;
  
  var /*Array*/ values = new Array();
  var /*Array*/ types = new Array();
  var /*SqlProcResult*/ sqlProcResult = null;
  var resultValue = null;
  var /*String*/ procName = null;
  var /*ResultSet*/ rs = null;
  var /*Array*/ missionIds = new Array();
  var /*Entry*/ resultEntry = null;
  var involvementAbbrev = null;
  var purposeAbbrev = null;
  var involvementId = null;
  var purposeId = null;  
  var startDate = null;
  var endDate = null;
  var /*ResultSet*/ involvementNatureRS = null;
  var /*Entry*/ involvementNatureEntry = null;
  var /*ResultSet*/ purposeRS = null;
  var /*Entry*/ purposeEntry = null;

  meibo.beginTransaction("TRAVEL_BCOM");

  try{
  
   
      values[0] = cost;
      values[1] = ownerId;
      values[2] = rootMissionId;
      resultValue = null;
      resultEntry = null;
      
      // appel procédure stockée pour creation mission
      sqlProcResult = meibo.executeSqlProc("TRAVEL_BCOM", procName, types, values);
    
      // vérification du résultat
      if(sqlProcResult==null){
        meibo.logError("null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
        throw "null en retour de l'appel à "+ procName;
      }else{  
      
        try{
          rs= sqlProcResult.getResultSet();
        }catch(exception){
          // cas qui ne devrait pas arriver mais qui arrive car getResultSet() leve une exception "null" au lieu de renvoyer un resultset vide ou null
          // en pratique les données peuvent très bien avoir été enregistrées
          meibo.logError("Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName + " pour les valeurs : " + values, exception);
          sqlProcResult.close();
          throw "Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName;
        }
        try{        
          if(rs==null){
            meibo.logError("ResultSet null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
            throw "ResultSet null en retour de l'appel à "+ procName;
          }else if(rs.getEntryCount()==0){
            meibo.logError("ResultSet vide en retour de l'appel à "+ procName + " pour les valeurs : " + values);
            throw  "ResultSet vide en retour de l'appel à "+ procName;
          }else{
            resultEntry = rs.getEntry();
            resultValue = resultEntry.getAttribute(0)[0];
            if(resultValue == "0"){
              meibo.logError("valeur zéro dans le resultset en retour de "+ procName + " pour les valeurs :" + values);
              throw  "La mission n'a pas pu être créée";  // pas plus d'explications disponibles ....
            }
          }
          sqlProcResult.close();
          
          // ICI : le cas où c'est censé fonctionner
          if(rootMissionId == null){
            rootMissionId = resultValue;
          }
          missionIds[missionIds.length] = resultValue;
          meibo.logDebug("Mission créée :" + resultValue + " avec les valeurs " + values);
          
          // ajouter evenements à mission ; et participant à évenments
          var eventIndex = 0;
          for each(var eventId in events){
            // relie les évenements à la mission
            var eventMissionEntry = new Entry();
            eventMissionEntry.updateAttribute(new Attribute("TMN_ID",resultValue));
            eventMissionEntry.updateAttribute(new Attribute("TCT_ID",eventId));
            
            var entryCreationOK = meibo.createEntry("R_EventMission",null,eventMissionEntry);
            if(!entryCreationOK){
              meibo.logError("Echec de création de l'entrée " + eventMissionEntry);
              throw "Impossible d'associer mission et évenement";
            }
          
            // ajouter participant à evenement
            startDate = SQL_DATE_FORMAT.format(DATE_FORMAT.parse(table.getCell(eventIndex,1)));
            endDate = SQL_DATE_FORMAT.format(DATE_FORMAT.parse(table.getCell(eventIndex,2)));
            purposeAbbrev = table.getCell(eventIndex,3);
            involvementAbbrev = table.getCell(eventIndex,4);
            /*
            involvementNatureRS = meibo.executeResource("InvolvementNature","TIN_ABBREV='"+ involvementAbbrev + "'",1,"TIN_ID");
            if((involvementNatureRS!=null) &amp;&amp; (involvementNatureRS.getEntryCount()&gt;0)){
              involvementNatureEntry = involvementNatureRS.getEntry();
              involvementId = involvementNatureEntry.TIN_ID[0];
            }else{
              throw "Impossible de recuperer l ID correspondant au type de participation "+ involvementAbbrev;
            }
            */
            involvementId = getIdFromAbbrev("InvolvementNature","TIN", involvementAbbrev);
            /*
            purposeRS = meibo.executeResource("Purpose","TPE_ABBREV='"+ purposeAbbrev + "'",1,"TPE_ID");
            if((purposeRS!=null) &amp;&amp; (purposeRS.getEntryCount()&gt;0)){
              purposeEntry = purposeRS.getEntry();
              purposeId = purposeEntry.TPE_ID[0];
            }else{
              throw "Impossible de recuperer l ID correspondant à l'objectif de participation " + purposeAbbrev;
            }
            */
            purposeId = getIdFromAbbrev("Purpose","TPE", purposeAbbrev);         
            
            var eventAttendeesEntry = new Entry();
            eventAttendeesEntry.updateAttribute(new Attribute("TCT_ID",eventId));
            eventAttendeesEntry.updateAttribute(new Attribute("PRS_ID",ownerId));
            eventAttendeesEntry.updateAttribute(new Attribute("RAS_START_DATE",startDate));
            eventAttendeesEntry.updateAttribute(new Attribute("RAS_END_DATE",endDate));
            
            eventAttendeesEntry.updateAttribute(new Attribute("TPE_ID",purposeId));            
            eventAttendeesEntry.updateAttribute(new Attribute("TIN_ID",involvementId));            
                        
            eventAttendeesEntry.updateAttribute(new Attribute("PRS_ID",ownerId));
            
            entryCreationOK = meibo.createEntry("R_Attendees",null,eventAttendeesEntry);
            if(!entryCreationOK){
              meibo.logError("Echec de création de l'entrée " + eventAttendeesEntry);
              throw "Impossible d'associer participant et évenement";
            }
                 
            eventIndex++;
          }
          
          // definir status mission
          updateMissionStatus(resultValue, userId, "CRE", null);
          
        }catch(exception){
          sqlProcResult.close();
          throw exception;
        }      
          
      } // if(sqlProcResult==null)


    var commitResultOK = meibo.commit("TRAVEL_BCOM");
    recordOK = commitResultOK;
    if(commitResultOK){
      meibo.logDebug("Missions créées :" + missionIds);      
    }else{
      meibo.logError("retour KO sur le commit de la transaction pour la mission  :" + resultValue + " avec les valeurs " + values);
      errorMessage =  "Echec de la transaction";
    }
        
  }catch(exception){
    // cas qui ne devrait pas arriver mais qui arrive car getResultSet() leve une exception "null" au lieu de renvoyer un resultset vide ou null
    // en pratique les données peuvent très bien avoir été enregistrées
    meibo.logError("Erreur sur l'enregistrement des données suite à l'appel à " + procName + " pour les valeurs : " + values + " : " exception);
    recordOK = false;
    errorMessage = exception;
    try{
      var rollBackResultOK = meibo.rollBack("TRAVEL_BCOM");
      if(rollBackResultOK){
        meibo.logInfo("Transaction annulée");
      }else{
        throw "Le rollback de la transaction renvoi false";
      }
    }catch(exception2){
      meibo.logError("Erreur sur le rollback de la transaction", exception);
      errorMessage = errorMessage + "; Echec d'annulation de la transation";
    }
  }

  if(recordOK){

    // créer et lancer workflows pour chaque mission
    var /*wapiProcInst*/ wapiProcInst = null;
    var /*int*/ missionIndex = 0;
    var /*Entry*/ missionEntry = null;
    
    for each(var missionId in missionIds){
      meibo.logDebug("Preparation du workflow pour la mission " + missionId);

      try{
        wapiProcInst = meibo.createWorkflowProcess("Mission");
        wapiProcInst.setVariable("missionID", missionId);
        wapiProcInst.setVariable("participantID", owners[missionIndex]);
        wapiProcInst.setVariable("initiatorID", userId);
        wapiProcInst.start();
        meibo.logDebug("Id du workflow pour la mission " + missionId + " de l'utilisateur " + owners[missionIndex] + " : "  + wapiProcInst.getId());   
           
      }catch(exception){
        meibo.logDebug("Echec du lancement de workflow pour la mission " + missionId + " : " + exception);
        errorField.setContent("Echec du lancement de workflow");
        errorField.show(true);
        break;
      } 
      
      missionEntry = new Entry();
      //missionEntry.updateAttribute(new Attribute("TMN_ID", missionId));
      missionEntry.updateAttribute(new Attribute("TMN_WORKFLOW_ID", wapiProcInst.getId()));
      var entryUpdateOK = meibo.updateEntry("Mission","T_MISSION_TMN,TMN_ID," + missionId, missionEntry);
      if(!entryUpdateOK){
        meibo.logError("Echec de mise à jour de l'identifiant de workflow de la mission " + missionId);
        errorField.setContent("Erreur sur l'affectation de l'identifiant de workflow");
        errorField.show(true);
        break;        
      }
                                  
       missionIndex++;
    }
    
    meibo.switchToApplicationView("Validation_OK");  
    //TODO : ou vue de visualisation ou de modification ou liste des missions ?
    
  }else{    
    errorField.setContent(errorMessage);
    errorField.show(true);      
  }
  
} //if(checkOK)

// contournement du fonctionnement nominal meibo :
// on retourne false pour ne pas que meibo tente ensuite lui même la création automatique de l'entrée comme il le ferait normalement si on ne passait pas par une procédure stockée
meibo.setReturnValue(false);</onquit>
            <onoperationok class="script"/>
            <onoperationko class="script"/>
          </trigger>
        </sequence>
      </resource>
      <resource name="Purpose">
        <properties>
          <displayname class="lingual">
            <fr>Purpose</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_PURPOSE_TPE</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TPE_ID,TPE_NAME,TPE_ABBREV</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TPE_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute"/>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TPE_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TPE_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="R_Attendees">
        <properties>
          <displayname class="lingual">
            <fr>R_Attendes</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">R_ATTENDEES_RAS</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>PRS_ID,RAS_END_DATE,RAS_START_DATE,TCT_ID,TIN_ID,TPE_ID</physical>
            <logical>
              <attribute attrs="TIN_NAME" pattern_fr="{0}" resourcelink="AttendeesInvolvementNature" type="link">TIN_NAME</attribute>
              <attribute attrs="PRS_LOGIN" pattern_fr="{0}" resourcelink="AttendeesPerson" type="link">PRS_LOGIN</attribute>
              <attribute attrs="TPE_NAME" pattern_fr="{0}" resourcelink="AttendeesPurpose" type="link">TPE_NAME</attribute>
              <attribute attrs="displayName" pattern_fr="{0}" resourcelink="AttendeesPerson" type="link">personDisplayName</attribute>
            </logical>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">PRS_ID,TCT_ID,TIN_ID,TPE_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute"/>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">PRS_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">PRS_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="R_EventHeaderAddress">
        <properties>
          <displayname class="lingual">
            <fr>R_EventHeaderAddress</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">R_TET_TEA</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TAS_ID,TET_ID</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TAS_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute"/>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TAS_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TAS_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
      </resource>
      <resource name="R_EventMission">
        <properties>
          <displayname class="lingual">
            <fr>R_EventMission</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">R_TMN_TET</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TCT_ID,TMN_ID</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TCT_ID,TMN_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute"/>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TCT_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TCT_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="R_EventTypeScope">
        <properties>
          <displayname class="lingual">
            <fr>R_EventTypeScope</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">R_TTY_TES_CONSTRAINT</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TES_ID,TTY_ID</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TES_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute"/>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TES_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TES_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
      </resource>
      <resource name="R_MissionStatus">
        <properties>
          <displayname class="lingual">
            <fr>R_MissionStatus</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">R_TST_TMN</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>PRS_ID,TMN_ID,TST_ID,TST_TMN_COMMENT,TST_TMN_DATE</physical>
            <logical>
              <attribute attrs="TST_NAME" pattern_fr="{0}" resourcelink="RMissionStatus" type="link">TST_NAME</attribute>
              <attribute attrs="displayName" pattern_fr="{0}" resourcelink="RMissionStatusPeople" type="link">peopleName</attribute>
            </logical>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">PRS_ID,TMN_ID,TST_ID,TST_TMN_DATE</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute"/>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TST_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TST_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="R_ReportChoice">
        <properties>
          <displayname class="lingual">
            <fr>R_ReportChoice</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">R_TRT_TFC_TCS</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TCS_ID,TFC_ID,TRT_ID</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TCS_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute"/>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TCS_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TCS_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="R_ReportStatus">
        <properties>
          <displayname class="lingual">
            <fr>R_ReportStatus</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">R_PRS_TRT_TST</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>PRS_ID,TRT_ID,TST_ID</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">PRS_ID,TRT_ID,TST_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TST_ID</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TST_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TST_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="Report">
        <properties>
          <displayname class="lingual">
            <fr>Compte-Rendu</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_REPORT_TRT</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TRT_ARTICLE_PRESS_LINKS,TRT_BCOM_ACTIONS,TRT_BCOM_SPREAD_VALUE_COMMENT,TRT_BUSINESS_CONTACT_QUAL_COMMENT,TRT_BUSINESS_CONTACT_QUAL_NOTE,TRT_CONTENTS,TRT_COUNTRY_DETAIL,TRT_DIFFUSION_EMAIL_LIST,TRT_DYN_PREVIOUS_SESSION_COMMENT,TRT_DYN_PREVIOUS_SESSION_NOTE,TRT_ID,TRT_JOURNALIST_LIST,TRT_KEYNOTES,TRT_KEYWORDS,TRT_LOBBY_CONTACT_QUAL_COMMENT,TRT_LOBBY_CONTACT_QUAL_NOTE,TRT_NEGATIVE_POINTS,TRT_NEWSPAPER_LIST,TRT_OTHER_CONTENT_TYPE,TRT_PARTNER_LIST,TRT_PARTNER_NB,TRT_POSITIVE_POINTS,TRT_QUALITY_COMMENT,TRT_QUALITY_NOTE,TRT_QUAL_PRICE_RATIO_COMMENT,TRT_QUAL_PRICE_RATIO_NOTE,TRT_RENOWN_COMMENT,TRT_STANDS_DEMOS,TRT_STRATEGIC_COVER_COMMENT,TRT_STRATEGIC_COVER_NOTE,TRT_TREND_1,TRT_TREND_2,TRT_TREND_3,TRT_VISITORS_NB,TRT_WORKFLOW_ID,TRT_ASIA_VIS_ORIGIN_RATIO,TRT_BUSINESS_VIS_TYPE_RATIO,TRT_EUROPE_VIS_ORIGIN_RATIO,TRT_FRANCE_VIS_ORIGIN_RATIO,TRT_NORTH_AMERICA_VIS_ORIGIN_RATIO,TRT_OTHER_VIS_ORIGIN_RATIO,TRT_OTHER_VIS_TYPE_RATIO,TRT_OTHER_VIS_TYPE_TEXT,TRT_SCIENTIFIC_VIS_TYPE_RATIO,TRT_BENCHMARK_QUALITY_COMMENT,TRT_BENCHMARK_QUALITY_NOTE,TRT_NEXTEDITION_NOTE,TRT_NEXTEDITION_COMMENT,TCT_ID</physical>
            <logical>
              <attribute attrs="TCT_START_DATE" pattern_fr="{0}" resourcelink="ReportEvent" type="link">EventDate</attribute>
              <attribute attrs="TET_NAME" pattern_fr="{0}" resourcelink="ReportEvent" type="link">EventName</attribute>
              <attribute attrs="TCT_DURATION" pattern_fr="{0}" resourcelink="ReportEvent" type="link">EventDuration</attribute>
              <attribute attrs="TCT_COMMENT" pattern_fr="{0}" resourcelink="ReportEvent" type="link">EventComment</attribute>
              <attribute attrs="TCT_URL" pattern_fr="{0}" resourcelink="ReportEvent" type="link">EventURL</attribute>
              <attribute attrs="ScopeName" pattern_fr="{0}" resourcelink="ReportEvent" type="link">ScopeName</attribute>
              <attribute attrs="TypeName" pattern_fr="{0}" resourcelink="ReportEvent" type="link">TypeName</attribute>
            </logical>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TRT_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TRT_ID</attribute>
            <reverseOrder class="boolean">true</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TRT_ID</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TRT_ID</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file">images/black-document.gif</imageclosed>
          <imageopened class="file">images/green-document.gif</imageopened>
        </properties>
        
        <sequence name="Create2" type="2">
          <properties>
            <displayname class="lingual">
              <fr>Create2</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
            <onoperationok class="extscript"/>
            <onoperationko class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Report_Create2.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script">///$debug
/**
 * Remplit le tableau tableName avec les ReportChoices correspondants à l'abbréviation choiceType
 */
function /*void*/ fillTableWithChoices(tableName, choiceType){
  var /*Table*/ table = meibo.getField(tableName);
  table.fillInWithQuery("ReportChoices", "TFC_ABBREV='" + choiceType + "'", 0, "TCS_NAME");
}

/**
 * Remplit la liste déroulante listName avec les ReportChoices correspondants à l'abbréviation choiceType
 */
function /*void*/ fillListWithChoices(listName, choiceType){
  var /*List*/choice = meibo.getField(listName);
  var /*ResultSet*/ rs = meibo.executeResource("ReportChoices", "TFC_ABBREV='" + choiceType + "'", 0, "TCS_NAME");
  var /*Array*/ array = resultSetToArray(rs, "TCS_NAME");
  choice.setValues(array);
  choice.setDisplayedTexts(array);
}

// Remplit les valeurs possibles des tableaux et listes utilisés
fillTableWithChoices("R_CONTENTS_TYPE","CNT");
fillTableWithChoices("R_MEDIA_TYPE","MED");
fillListWithChoices("TRT_QUALITY_NOTE","GQ");
fillListWithChoices("TRT_RENOWN_COMMENT","RN");
fillListWithChoices("TRT_DYN_PREVIOUS_SESSION_NOTE","DPS");
fillListWithChoices("TRT_STRATEGIC_COVER_NOTE","SNC");
fillListWithChoices("TRT_LOBBY_CONTACT_QUAL_NOTE","LCQ");
fillListWithChoices("TRT_BUSINESS_CONTACT_QUAL_NOTE","BCQ");
fillListWithChoices("TRT_BCOM_SPREAD_VALUE_COMMENT","BSC");
fillListWithChoices("TRT_BENCHMARK_QUALITY_NOTE","BQ");
fillListWithChoices("TRT_QUAL_PRICE_RATIO_NOTE","PQR");
fillListWithChoices("TRT_NEXTEDITION_NOTE","NEN");</onload>
            <onquit class="script">meibo.setReturnValue(true);
</onquit>
            <onoperationok class="script"/>
            <onoperationko class="script"/>
          </trigger>
        </sequence>
        <sequence name="Create" type="2">
          <properties>
            <displayname class="lingual">
              <fr>Create2</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
            <onoperationok class="extscript"/>
            <onoperationko class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Report_Create.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script">///$debug</onload>
            <onquit class="script">var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);

var /*Edit*/ errorField =  meibo.getField("error");
errorField.show(false);

var /*String*/ eventID = meibo.getFieldValue("TCT_ID");
var /*Array*/ values = new Array();
var /*Array*/ types = new Array();
var /*SqlProcResult*/ sqlProcResult = null;
var resultValue = null;
var /*String*/ procName = null;
var /*ResultSet*/ rs = null;
var /*Entry*/ resultEntry = null;
var /*boolean*/ recordOK=false;
var /*String*/ errorMessage = "";

 meibo.beginTransaction("TRAVEL_BCOM");

try{
  values[0] = eventID; // concreteEvtID
  types[0] = "IN";  
  values[1] = "DUMMY";  // workflowID
  types[1] = "IN";
  procName = "add_event_report";
  resultValue = null;
  resultEntry = null;
  
  // appel procédure stockée pour creation
  var sqlProcResult = meibo.executeSqlProc("TRAVEL_BCOM", procName, types, values);

  // vérification du résultat
  if(sqlProcResult==null){
    meibo.logError("null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
    throw "null en retour de l'appel à "+ procName;
  }else{  
  
    try{
      rs= sqlProcResult.getResultSet();
    }catch(exception){
      // cas qui ne devrait pas arriver mais qui arrive car getResultSet() leve une exception "null" au lieu de renvoyer un resultset vide ou null
      // en pratique les données peuvent très bien avoir été enregistrées
      meibo.logError("Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName + " pour les valeurs : " + values, exception);
      sqlProcResult.close();
      throw "Erreur sur la récupération du ResultSet en retour de l'appel à "+ procName;
    }
    try{        
      if(rs==null){
        meibo.logError("ResultSet null en retour de l'appel à "+ procName + " pour les valeurs : " + values);
        throw "ResultSet null en retour de l'appel à "+ procName;
      }else if(rs.getEntryCount()==0){
        meibo.logError("ResultSet vide en retour de l'appel à "+ procName + " pour les valeurs : " + values);
        throw  "ResultSet vide en retour de l'appel à "+ procName;
      }else{
        resultEntry = rs.getEntry();
        resultValue = resultEntry.getAttribute(0)[0];
        if(resultValue == "0"){
          meibo.logError("valeur zéro dans le resultset en retour de "+ procName + " pour les valeurs :" + values);
          throw  "L'entrée n'a pas pu être créée";  // pas plus d'explications disponibles ....
        }
      }
      sqlProcResult.close();
            
    }catch(exception){
      sqlProcResult.close();
      throw exception;
    }      
      
  } // if(sqlProcResult==null)

  var commitResultOK = meibo.commit("TRAVEL_BCOM");
  recordOK = commitResultOK;
  if(commitResultOK){
    meibo.logDebug("Entrée créée :" + resultValue + " avec les valeurs " + values);      
  }else{
    meibo.logError("retour KO sur le commit de la transaction pour l'entrée  :" + resultValue + " avec les valeurs " + values);
    errorMessage =  "Echec de la transaction";
  }
      
}catch(exception){
  // cas qui ne devrait pas arriver mais qui arrive car getResultSet() leve une exception "null" au lieu de renvoyer un resultset vide ou null
  // en pratique les données peuvent très bien avoir été enregistrées
  meibo.logError("Erreur sur l'enregistrement des données suite à l'appel à " + procName + " pour les valeurs : " + values + " : " exception);
  recordOK = false;
  errorMessage = exception;
  try{
    var rollBackResultOK = meibo.rollBack("TRAVEL_BCOM");
    if(rollBackResultOK){
      meibo.logInfo("Transaction annulée");
    }else{
      throw "Le rollback de la transaction renvoi false";
    }
  }catch(exception2){
    meibo.logError("Erreur sur le rollback de la transaction", exception);
    errorMessage = errorMessage + "; Echec d'annulation de la transation";
  }
}

if(recordOK){
  var /*String*/ reportDn = "T_REPORT_TRT,TRT_ID," + resultValue;
  meibo.switchToModifyView("Report", reportDn, 0) 
  
}else{    
  errorField.setContent(errorMessage);
  errorField.show(true);      
}

} //if(checkOK)

// contournement du fonctionnement nominal meibo :
// on retourne false pour ne pas que meibo tente ensuite lui même la création automatique de l'entrée comme il le ferait normalement si on ne passait pas par une procédure stockée
meibo.setReturnValue(false);</onquit>
            <onoperationok class="script"/>
            <onoperationko class="script"/>
          </trigger>
        </sequence>
        <sequence name="Update" type="1">
          <properties>
            <displayname class="lingual">
              <fr>Update</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <onquit class="extscript"/>
            <onoperationok class="extscript"/>
            <onoperationko class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Report_Update.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script">var CONTAINERS_COUNT = 5; // Nombre de blocs "contacts"
var CHECK_REPORT_ACTIVITY_ID = "A1448529288334";   // identifiant de l'activité "vérifie CR"

/**
 * Remplit le tableau tableName avec les ReportChoices correspondants à l'abbréviation choiceType
 * présélectionne les valeurs enregistrées
 */
function /*void*/ fillTableWithChoices(tableName, choiceType,reportId){
  var /*Table*/ table = meibo.getField(tableName);
  // recherche des choix possibles 
  var /*ResultSet*/ choicesRs = meibo.executeResource("ReportChoices", "TFC_ABBREV='" + choiceType + "'", 0, "TCS_ID,TFC_ID,TCS_NAME");
  var /*Entry*/ choiceEntry = choicesRs.getEntry();
  var filteredChoiceId = choiceEntry.TFC_ID[0];
  // recherche des valeurs enregistrées
  var /*ResultSet*/ selectedChoicesRs = meibo.executeResource("R_ReportChoice", "TRT_ID=" + reportId + " AND TFC_ID=" + filteredChoiceId, 0);
  var /*Array*/ selectedChoicesArray = resultSetToArray(selectedChoicesRs,"TCS_ID");
  table.fillInWithResultSet(choicesRs,0,0,"TCS_NAME");
  // positionne l'entrée en row object pour pouvoir récupérer les valeurs au moment de la soumission du formulaire 
  var choiceId = null;
  for(var i=0;i&lt;choicesRs.getEntryCount();i++){
    choiceEntry = choicesRs.getEntry(i);
    table.addRowObject(i,choiceEntry);
    choiceId = choiceEntry.TCS_ID[0];
    // présélectionne la valeur si elle était enregistrée
    if(choiceId in selectedChoicesArray){
      table.checkRow(i,true);
    }
  }
}

/**
 * Remplit la liste déroulante listName avec les ReportChoices correspondants à l'abbréviation choiceType
 */
function /*void*/ fillListWithChoices(listName, choiceType){
  var /*List*/choice = meibo.getField(listName);
  var /*ResultSet*/ choicesRs = meibo.executeResource("ReportChoices", "TFC_ABBREV='" + choiceType + "'", 0, "TCS_NAME,TCS_VALUE");
  //var /*ResultSet*/ choicesRs = meibo.executeResource("ReportChoices", "TFC_ABBREV='" + choiceType + "'", 0, "TCS_NAME");      
  var /*Array*/ nameArray = resultSetToArray(choicesRs, "TCS_NAME");
  var /*Array*/ valueArray = resultSetToArray(choicesRs, "TCS_VALUE");
  choice.setValues(valueArray);
  //choice.setValues(nameArray);
  choice.setDisplayedTexts(nameArray);
}

/**
 * Indique si le formulaire est ouvert dans le cadre de la validation du compte rendu (par AnalyseurDeplacement)
 */
function /*boolean*/ isCheckReportStep(){
  var CHECK_REPORT_ACTIVITY_ID = "A1448529288334";
  var /*wapiWorkItem*/ wapiWorkItem = meibo.getCurrentWorkflowTask();
  meibo.logDebug("wapiWorkItem.getId() : " + wapiWorkItem.getId());
  var wapiActivityInst = wapiWorkItem.getActivityInstance();
  /*
  meibo.logDebug("wapiActivityInst.getActivityId() : " + wapiActivityInst.getActivityId());
  meibo.logDebug("wapiActivityInst.getId() : " + wapiActivityInst.getId());
  meibo.logDebug("wapiActivityInst.getDisplayName() : " + wapiActivityInst.getDisplayName());
  */
  return ((wapiActivityInst.getActivityId()==CHECK_REPORT_ACTIVITY_ID) &amp;&amp; (meibo.isUserInRole("AnalyseurDeplacement")));
}</globalScriptView>
            <onload class="script">///$debug
try{
  var /*wapiWorkItem*/ wapiWorkItem = meibo.getCurrentWorkflowTask();
  var wapiActivityInst = wapiWorkItem.getActivityInstance();
  
  if(isCheckReportStep()){
  // mode validation par AnalyseurDeplacement
    meibo.logDebug("Traitement de l'activité de compte-rendu : " + wapiActivityInst.getDisplayName() + " en mode AnalyseurDeplacement");
  }else{
  // mode contribution
    meibo.logDebug("Traitement de l'activité de compte-rendu : " + wapiActivityInst.getDisplayName() + " en mode contributeur");
    var comment = meibo.getWorkflowVariable("checkReportStepComment");
    if((comment!=null) &amp;&amp; (comment.length &gt;0)){
      meibo.showField("RejectPanel",true);
      meibo.setFieldValue("RejectComment",comment); 
    }
  }

}catch(exception){
  meibo.logWarn("Erreur sur récupération de contexte de workflow  : " + exception);
}


var reportId= meibo.getFieldValue("TRT_ID")
// Remplit les valeurs possibles des tableaux et listes utilisés
fillTableWithChoices("R_CONTENTS_TYPE","CNT",reportId);
fillTableWithChoices("R_MEDIA_TYPE","MED",reportId);
fillListWithChoices("TRT_QUALITY_NOTE","GQ");
fillListWithChoices("TRT_RENOWN_COMMENT","RN");
fillListWithChoices("TRT_DYN_PREVIOUS_SESSION_NOTE","DPS");
fillListWithChoices("TRT_STRATEGIC_COVER_NOTE","SNC");
fillListWithChoices("TRT_LOBBY_CONTACT_QUAL_NOTE","LCQ");
fillListWithChoices("TRT_BUSINESS_CONTACT_QUAL_NOTE","BCQ");
fillListWithChoices("TRT_BCOM_SPREAD_VALUE_COMMENT","BSC");
fillListWithChoices("TRT_BENCHMARK_QUALITY_NOTE","BQ");
fillListWithChoices("TRT_QUAL_PRICE_RATIO_NOTE","PQR");
fillListWithChoices("TRT_NEXTEDITION_NOTE","NEN");

// traitement spécifique des contacts
// les valeurs ne sont pas portées dans la table REPORT, mais dans la table T_NETWORKING_CONTACT_TNC (ressource ReportNetworkingContacts)

// recherche des valeurs enregistrées
var /*ResultSet*/ contactRs = meibo.executeResource("ReportNetworkingContacts", "TRT_ID=" + reportId, 0);
var contactIndex = 1;
for each(var /*Entry*/ networkingContactEntry in contactRs){
  meibo.setFieldValue("CONTACT_NAME_" + contactIndex, networkingContactEntry.TNC_NAME[0]);
  meibo.setFieldValue("CONTACT_TITLE_" + contactIndex, networkingContactEntry.TNC_TITLE[0]);
  meibo.setFieldValue("CONTACT_STRUCTURE_" + contactIndex, networkingContactEntry.TNC_STRUCTURE[0]);
  meibo.setFieldValue("CONTACT_DISCUSSION_" + contactIndex, networkingContactEntry.TNC_DISCUSSION[0]);
  meibo.setFieldValue("CONTACT_FOLLOWUP_" + contactIndex, networkingContactEntry.TNC_FOLLOWUP[0]);
  
  meibo.showField("CONTACT_CONTAINER_" + contactIndex, true);
  contactIndex++;
}

// contournement du fonctionnement meibo qui ne prend en compte que la première valeur des champs multivalués dans le cas d'une ressource de type base de données
fixMultiValueFieldsOnLoad("TRT_PARTNER_LIST");
fixMultiValueFieldsOnLoad("TRT_NEWSPAPER_LIST");
fixMultiValueFieldsOnLoad("TRT_JOURNALIST_LIST");
fixMultiValueFieldsOnLoad("TRT_KEYWORDS");
fixMultiValueFieldsOnLoad("TRT_DIFFUSION_EMAIL_LIST");

// formatage date
meibo.setFieldValue("EventDate", DATE_FORMAT.format(SQL_DATE_FORMAT.parse(meibo.getFieldValue("EventDate"))));</onload>
            <onquit class="script">///$debug
// contournement du fonctionnement meibo qui ne prend en compte que la première valeur des champs multivalués dans le cas d'une ressource de type base de données
fixMultiValueFieldsOnSubmit("TRT_PARTNER_LIST");
fixMultiValueFieldsOnSubmit("TRT_NEWSPAPER_LIST");
fixMultiValueFieldsOnSubmit("TRT_JOURNALIST_LIST");
fixMultiValueFieldsOnSubmit("TRT_KEYWORDS");
fixMultiValueFieldsOnSubmit("TRT_DIFFUSION_EMAIL_LIST");

meibo.setReturnValue(true);</onquit>
            <onoperationok class="script">///$debug
/**
 * Affecte à la ressource R_ReportChoice les élements sélectionnés dans le tableau tableName
 */
function /*void*/ setReportChoices(tableName, reportID){
  var /*Table*/ table = meibo.getField(tableName);
  var /*array*/selectedRowsIndex = table.getCheckedRows();

  // on ajoute les lignes qui sont sélectionnées
  for each(var rowIndex in selectedRowsIndex){
    var /*Entry*/ choiceEntry = table.getRowObject(rowIndex);
    choiceEntry.updateAttribute(new Attribute("TRT_ID",reportID));
    choiceEntry.deleteAttribute("TCS_NAME");
    
    meibo.createEntry("R_ReportChoice",null, choiceEntry);
  }
}

var /*String*/ userId=meibo.getGlobalVar(GLOBALVAR_CURRENT_USER_ID);

// traitement spécifique des listes/tableaux en multi-sélection :
// les valeurs ne sont pas portées dans la table REPORT, mais dans la table d'association TRT_TFC_TCS (ressource R_ReportChoice)
var /*String*/reportID = meibo.getFieldValue("TRT_ID");
var /*String*/eventID = meibo.getFieldValue("EventID");

// on commence par supprimer toutes les entrées actuelles liées au compte-rendu
meibo.deleteEntries("R_ReportChoice","TRT_ID=" + reportID);

setReportChoices("R_CONTENTS_TYPE", reportID);
setReportChoices("R_MEDIA_TYPE", reportID);

// traitement spécifique des contacts
// les valeurs ne sont pas portées dans la table REPORT, mais dans la table T_NETWORKING_CONTACT_TNC (ressource ReportNetworkingContacts)
var /*Entry*/ networkingContactEntry = null;

// on commence par supprimer toutes les entrées actuelles liées au compte-rendu
meibo.deleteEntries("ReportNetworkingContacts","TRT_ID=" + reportID);

for(var i=1;i&lt;=CONTAINERS_COUNT;i++){
  // on ne traite que les contacts visibles dont le nom est valorisé 
  if((meibo.getField("CONTACT_CONTAINER_" + i).isVisible()) &amp;&amp; (meibo.getFieldValue("CONTACT_NAME_" + i)!=null) &amp;&amp; (meibo.getFieldValue("CONTACT_NAME_" + i).trim().length()&gt;0)){
    networkingContactEntry = new Entry(new Attribute("TRT_ID", reportID));
    networkingContactEntry.updateAttribute(new Attribute("TNC_NAME", meibo.getFieldValue("CONTACT_NAME_" + i)));
    networkingContactEntry.updateAttribute(new Attribute("TNC_TITLE", meibo.getFieldValue("CONTACT_TITLE_" + i)));
    networkingContactEntry.updateAttribute(new Attribute("TNC_STRUCTURE", meibo.getFieldValue("CONTACT_STRUCTURE_" + i)));
    networkingContactEntry.updateAttribute(new Attribute("TNC_DISCUSSION", meibo.getFieldValue("CONTACT_DISCUSSION_" + i)));
    networkingContactEntry.updateAttribute(new Attribute("TNC_FOLLOWUP", meibo.getFieldValue("CONTACT_FOLLOWUP_" + i)));
    
    meibo.createEntry("ReportNetworkingContacts",null, networkingContactEntry);
  }
}

meibo.logInfo("Compte-rendu " + reportID + " enregistré par " + meibo.getUserDn() + " pour l'évènement " + eventID);

var wfParam= meibo.getFieldValue("WORKFLOW_PARAMETER");
if(isCheckReportStep()){
  meibo.setWorkflowVariable("checkReportStepAction", wfParam);
  meibo.setWorkflowVariable("checkReportStepLastActorId", userId);
  if(wfParam!="record"){
    if(wfParam=="reject"){
      var comment = meibo.getFieldValue("Comment");
      if(comment.trim()==""){
        comment = "-";  // commentaire non vide utile au retour sur le formulaire
      }
      meibo.setWorkflowVariable("checkReportStepComment", comment);
      meibo.logInfo("Compte-rendu " + reportID + " rejeté par " + meibo.getUserDn() + " pour l'évènement " + eventID);
    }else{
      meibo.logInfo("Compte-rendu " + reportID + " validé par " + meibo.getUserDn() + " pour l'évènement " + eventID);
    }
    meibo.completeCurrentWorkflowTask();
  }
}else{
  meibo.setWorkflowVariable("completeReportStepAction", wfParam);
  meibo.setWorkflowVariable("completeReportStepLastActorId", userId);
  meibo.completeCurrentWorkflowTask();
}

meibo.switchToApplicationView("Validation_OK");</onoperationok>
            <onoperationko class="script"/>
          </trigger>
        </sequence>
        <sequence name="Show" type="0">
          <properties>
            <displayname class="lingual">
              <fr>Show</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Report_Show.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script">// formatage date
meibo.setFieldValue("EventDate", DATE_FORMAT.format(SQL_DATE_FORMAT.parse(meibo.getFieldValue("EventDate"))));</onload>
          </trigger>
        </sequence>
        <sequence name="Print" type="0">
          <properties>
            <displayname class="lingual">
              <fr>Print</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
          </properties>
          <path>TRAVEL_BCOM_Report_Print.xml</path>
          <class/>
          <rights>
            <AdminMeibo>true</AdminMeibo>
            <Utilisateur>true</Utilisateur>
          </rights>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script">/**
 * Remplit le tableau tableName avec les ReportChoices correspondants à l'abbréviation choiceType
 * présélectionne les valeurs enregistrées
 */
function /*void*/ fillTableWithChoices(tableName, choiceType,reportId){
  var /*Table*/ table = meibo.getField(tableName);
  // recherche des choix possibles 
  var /*ResultSet*/ choicesRs = meibo.executeResource("ReportChoices", "TFC_ABBREV='" + choiceType + "'", 0, "TCS_ID,TFC_ID,TCS_NAME");
  var /*Entry*/ choiceEntry = choicesRs.getEntry();
  var filteredChoiceId = choiceEntry.TFC_ID[0];
  // recherche des valeurs enregistrées
  var /*ResultSet*/ selectedChoicesRs = meibo.executeResource("R_ReportChoice", "TRT_ID=" + reportId + " AND TFC_ID=" + filteredChoiceId, 0);
  var /*Array*/ selectedChoicesArray = resultSetToArray(selectedChoicesRs,"TCS_ID");
  table.fillInWithResultSet(choicesRs,0,0,"TCS_NAME");
  // positionne l'entrée en row object pour pouvoir récupérer les valeurs au moment de la soumission du formulaire 
  var choiceId = null;
  for(var i=0;i&lt;choicesRs.getEntryCount();i++){
    choiceEntry = choicesRs.getEntry(i);
    table.addRowObject(i,choiceEntry);
    choiceId = choiceEntry.TCS_ID[0];
    // présélectionne la valeur si elle était enregistrée
    if(choiceId in selectedChoicesArray){
      table.checkRow(i,true);
    }
  }
}

function /*void*/ fillChoiceValues(listName, choiceType){
  var /*Label*/choice = meibo.getField(listName);
  var value= choice.getContent();
  var /*ResultSet*/ choicesRs = meibo.executeResource("ReportChoices", "TFC_ABBREV='" + choiceType + "' AND TCS_VALUE=" + value, 1, "TCS_NAME");
  choice.setContent(choicesRs.getEntry().TCS_NAME[0]);
}


var reportId= meibo.getFieldValue("TRT_ID")
var eventID = meibo.getCurrentEntry().TCT_ID[0];

// Remplit les valeurs possibles des tableaux et listes utilisés
fillTableWithChoices("R_CONTENTS_TYPE","CNT",reportId);
fillTableWithChoices("R_MEDIA_TYPE","MED",reportId);

fillChoiceValues("TRT_QUALITY_NOTE","GQ");
fillChoiceValues("TRT_RENOWN_COMMENT","RN");
fillChoiceValues("TRT_DYN_PREVIOUS_SESSION_NOTE","DPS");
fillChoiceValues("TRT_STRATEGIC_COVER_NOTE","SNC");
fillChoiceValues("TRT_LOBBY_CONTACT_QUAL_NOTE","LCQ");
fillChoiceValues("TRT_BUSINESS_CONTACT_QUAL_NOTE","BCQ");
fillChoiceValues("TRT_BCOM_SPREAD_VALUE_COMMENT","BSC");
fillChoiceValues("TRT_BENCHMARK_QUALITY_NOTE","BQ");
fillChoiceValues("TRT_QUAL_PRICE_RATIO_NOTE","PQR");
fillChoiceValues("TRT_NEXTEDITION_NOTE","NEN");


// traitement spécifique des contacts
// les valeurs ne sont pas portées dans la table REPORT, mais dans la table T_NETWORKING_CONTACT_TNC (ressource ReportNetworkingContacts)

// recherche des valeurs enregistrées
var /*ResultSet*/ contactRs = meibo.executeResource("ReportNetworkingContacts", "TRT_ID=" + reportId, 0);
var contactIndex = 1;
for each(var /*Entry*/ networkingContactEntry in contactRs){
  meibo.setFieldValue("CONTACT_NAME_" + contactIndex, networkingContactEntry.TNC_NAME[0]);
  meibo.setFieldValue("CONTACT_TITLE_" + contactIndex, networkingContactEntry.TNC_TITLE[0]);
  meibo.setFieldValue("CONTACT_STRUCTURE_" + contactIndex, networkingContactEntry.TNC_STRUCTURE[0]);
  meibo.setFieldValue("CONTACT_DISCUSSION_" + contactIndex, networkingContactEntry.TNC_DISCUSSION[0]);
  meibo.setFieldValue("CONTACT_FOLLOWUP_" + contactIndex, networkingContactEntry.TNC_FOLLOWUP[0]);
  
  meibo.showField("CONTACT_CONTAINER_" + contactIndex, true);
  contactIndex++;
}

// contournement du fonctionnement meibo qui ne prend en compte que la première valeur des champs multivalués dans le cas d'une ressource de type base de données
fixMultiValueFieldsOnLoad("TRT_PARTNER_LIST");
fixMultiValueFieldsOnLoad("TRT_NEWSPAPER_LIST");
fixMultiValueFieldsOnLoad("TRT_JOURNALIST_LIST");
fixMultiValueFieldsOnLoad("TRT_KEYWORDS");
fixMultiValueFieldsOnLoad("TRT_DIFFUSION_EMAIL_LIST");

// formatage date
var /*java.util.Date*/ startDate= SQL_DATE_FORMAT.parse(meibo.getFieldValue("EventDate"));
var /*String*/ eventDuration = meibo.getFieldValue("EventDate");
var /*java.util.Date*/ endDate= addDays(startDate, NUMBERFORMAT_INSTANCE.parse(eventDuration).intValue()-1);

meibo.setFieldValue("EventDate", "du " + DATE_FORMAT.format(startDate) +  " au " + DATE_FORMAT.format(endDate));

// Tableau des participants
var /*Table*/attendeesTable = meibo.getField("ATTENDEES_TABLE");
var /*ResultSet*/ eventAttendeesRs = meibo.executeResource("R_Attendees", "TCT_ID=" + eventID, 0,"RAS_START_DATE,RAS_END_DATE,TIN_NAME,TPE_NAME,personDisplayName");
var /*Date*/ startDate = null;
var /*Date*/ endDate = null;

var line=0;
for each(var attendeesEntry in eventAttendeesRs){
  startDate = SQL_DATE_FORMAT.parse(attendeesEntry.RAS_START_DATE[0]);
  endDate = SQL_DATE_FORMAT.parse(attendeesEntry.RAS_END_DATE[0]);
      
  attendeesTable.addCell(line,0,attendeesEntry.personDisplayName[0]);
  attendeesTable.addCell(line,1,DATE_FORMAT.format(startDate));
  attendeesTable.addCell(line,2,DATE_FORMAT.format(endDate));
  attendeesTable.addCell(line,3,attendeesEntry.TIN_NAME[0]);
  attendeesTable.addCell(line,4,attendeesEntry.TPE_NAME[0]);
  line++;
}

// Tableau des contacts
var /*Table*/contactsTable = meibo.getField("CONTACTS_TABLE");
var /*ResultSet*/ contactRs = meibo.executeResource("ReportNetworkingContacts", "TRT_ID=" + reportId, 0);
line=0;
for each(var contactEntry in contactRs){
  contactsTable.addCell(line,0,contactEntry.TNC_NAME[0]);
  contactsTable.addCell(line,1,contactEntry.TNC_TITLE[0]);
  contactsTable.addCell(line,2,contactEntry.TNC_STRUCTURE[0]);
  contactsTable.addCell(line,3,contactEntry.TNC_DISCUSSION[0]);
  contactsTable.addCell(line,4,contactEntry.TNC_FOLLOWUP[0]);
  line++;
}</onload>
          </trigger>
        </sequence>
      </resource>
      <resource name="ReportChoices">
        <properties>
          <displayname class="lingual">
            <fr>ReportChoices</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">report_choices</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TCS_ID,TCS_NAME,TFC_ABBREV,TFC_ID,TFC_NAME</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TCS_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TCS_ID</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TCS_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TCS_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="ReportNetworkingContacts">
        <properties>
          <displayname class="lingual">
            <fr>ReportNetworkingContacts</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_NETWORKING_CONTACT_TNC</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TNC_DISCUSSION,TNC_FOLLOWUP,TNC_ID,TNC_NAME,TNC_STRUCTURE,TNC_TITLE,TRT_ID</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TNC_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TNC_NAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TNC_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TNC_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="Status">
        <properties>
          <displayname class="lingual">
            <fr>Status</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_STATUS_TST</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>TST_ABBREV,TST_ID,TST_NAME</physical>
            <logical/>
          </return>
          <onRead class="script"/>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">TST_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">TST_ABBREV</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">TST_NAME</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">TST_NAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file"/>
          <imageopened class="file"/>
        </properties>
        
      </resource>
      <resource name="TravelPeople">
        <properties>
          <displayname class="lingual">
            <fr>TravelPeople</fr>
          </displayname>
          <hiddenresource class="boolean">false</hiddenresource>
          <separator class="separator"/>
          <objectclass class="objectclass">T_PERSON_PRS</objectclass>
          <separator class="separator"/>
          <request class="text"/>
          <separator class="separator"/>
          <return class="returnallattributes">
            <physical>PRS_ID,PRS_LOGIN,PRS_NAME,PRS_SIRNAME,PRS_TITLE</physical>
            <logical>
              <attribute type="script">displayName</attribute>
              <attribute attrs="mail" pattern_fr="{0}" resourcelink="TravelPeopleADPeople" type="link">mail</attribute>
              <attribute attrs="dn" pattern_fr="{0}" resourcelink="TravelPeopleADPeople" type="link">ldapDn</attribute>
            </logical>
          </return>
          <onRead class="script">///$debug
var scriptedAttributes = meibo.getParameter("scripted");
var mappedAttributes = meibo.getParameter("mapped");
var linkedAttributes = meibo.getParameter("linked");
var entry = meibo.getCurrentEntry();

if ((scriptedAttributes !=null) &amp;&amp; ("displayName" in scriptedAttributes)) {
  // calcul attribut displayName
  var name=entry.PRS_NAME[0];
  var surname=entry.PRS_SIRNAME[0];
  var login=entry.PRS_LOGIN[0];
  if((surname ==null) || (login ==null)){
    // rechargement de l'entrée avec les attributs requis
    var newEntry = meibo.getDnEntry("TravelPeople", meibo.getCurrentDn(),"PRS_SIRNAME,PRS_NAME,PRS_LOGIN");
    name=newEntry.PRS_NAME[0];
    surname=newEntry.PRS_SIRNAME[0];
    login=newEntry.PRS_LOGIN[0];
  }
  entry.displayName = returnEmpty(name) + " " + returnEmpty(surname) + " (" + login + ")";
  //entry.displayName = surname + " (" + login + ")";
}</onRead>
          <onSubmit class="script"/>
          <onoperationok class="script"/>
          <onoperationko class="script"/>
          <separator class="separator"/>
          <keyattribute class="returnattributes">PRS_ID</keyattribute>
          <separator class="separator"/>
          <sortingon class="sortingon">
            <attribute class="attribute">PRS_SIRNAME</attribute>
            <reverseOrder class="boolean">false</reverseOrder>
          </sortingon>
          <separator class="separator"/>
          <key class="attribute">displayName</key>
          <entriesbrowsed class="integer">20</entriesbrowsed>
          <separator class="separator"/>
          <searchattribute class="attribute">PRS_SIRNAME</searchattribute>
          <separator class="separator"/>
          <imageclosed class="file">images/beige-user.gif</imageclosed>
          <imageopened class="file">images/red-arrow-right.gif</imageopened>
        </properties>
        
        <sequence name="Picker" type="7">
          <properties>
            <displayname class="lingual">
              <fr>Personnes</fr>
            </displayname>
            <maskused class="boolean">true</maskused>
            <separator class="separator"/>
            <globalScriptView class="extscriptnodebug"/>
            <onload class="extscript"/>
            <separator class="separator"/>
            <custompicker class="boolean">true</custompicker>
            <separator class="separator"/>
            <height class="integer">140</height>
            <pickerwidth class="integer">400</pickerwidth>
            <pickerheight class="integer">385</pickerheight>
            <separator class="separator"/>
            <pickerhead class="css">pickerHead</pickerhead>
            <pickerclose class="file">./web\close.gif</pickerclose>
            <separator class="separator"/>
            <displayattributes class="attributes">PRS_LOGIN,PRS_NAME,PRS_SIRNAME,PRS_ID</displayattributes>
          </properties>
          <path>TRAVEL_BCOM_TravelPeople_Picker.xml</path>
          <class/>
          <trigger>
            <globalScriptView class="script"> </globalScriptView>
            <onload class="script"> </onload>
          </trigger>
        </sequence>
      </resource>
    </datasource>
    <datasource auto="A -&gt; Z" name="workflow" type="SQL">
      <properties>
        <JDBCConnectionURL class="text">jdbc:mysql://10.3.100.14:3306/workflow</JDBCConnectionURL>
        <Enabled class="boolean">true</Enabled>
        <ConnectionObliged class="boolean">true</ConnectionObliged>
        <separator class="separator"/>
        <user class="text">svc-meibo-sql</user>
        <password class="password">{zRawrMqDVCDwXX+w6nAr/g==}</password>
        <separator class="separator"/>
        <WorkflowUser class="text">svc-meibo-sql</WorkflowUser>
        <WorkflowPassword class="password">{zRawrMqDVCDwXX+w6nAr/g==}</WorkflowPassword>
        <separator class="separator"/>
        <WebServiceUser class="text"/>
        <WebServicePassword class="password"/>
        <separator class="separator"/>
        <JDBCDriver class="text">com.mysql.jdbc.Driver</JDBCDriver>
        <separator class="separator"/>
        <AppServerDatasource class="text"/>
        <separator class="separator"/>
        <BlobType class="hidden">TINYBLOB, BLOB, MEDIUMBLOB, LONGBLOB, LONGVARBINARY, IMAGE, BYTEA</BlobType>
        <ClobType class="hidden">CLOB</ClobType>
        <BinaryType class="hidden"/>
        <NumType class="hidden">NUMERIC, DOUBLE</NumType>
        <LongType class="hidden">INT, INTEGER</LongType>
        <ConnectionPoolSize class="number">3</ConnectionPoolSize>
        <ConnectionPoolMax class="number">5</ConnectionPoolMax>
        <ConnectionUseCount class="number">100</ConnectionUseCount>
        <ConnectionTimeOut class="number">120</ConnectionTimeOut>
      </properties>
    </datasource>
  </datasources>
  <resourcelinks auto="A -&gt; Z">
    <resourcelink name="AddressAddressNature">
      <properties>
        <displayname class="lingual">
          <fr>AddressAddressNature</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Address</resourcefrom>
        <resourceto class="resource">AddressNature</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TNA_ABBREV</attribute1>
        <attribute2 class="text">TNA_ABBREV</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="AddressContinent">
      <properties>
        <displayname class="lingual">
          <fr>AddressContinent</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">AddressCountry</firstlink>
        <secondlink class="link">CountryContinent</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="AddressCountry">
      <properties>
        <displayname class="lingual">
          <fr>AddressCountry</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Address</resourcefrom>
        <resourceto class="resource">Country</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TCY_ID</attribute1>
        <attribute2 class="text">TCY_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="AttendeesEvent">
      <properties>
        <displayname class="lingual">
          <fr>Evenements</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_Attendees</resourcefrom>
        <resourceto class="resource">Event</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TCT_ID</attribute1>
        <attribute2 class="text">fkTCT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="AttendeesInvolvementNature">
      <properties>
        <displayname class="lingual">
          <fr>AttendeesInvolvementNature</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_Attendees</resourcefrom>
        <resourceto class="resource">InvolvementNature</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TIN_ID</attribute1>
        <attribute2 class="text">TIN_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="AttendeesPerson">
      <properties>
        <displayname class="lingual">
          <fr>Participant</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_Attendees</resourcefrom>
        <resourceto class="resource">TravelPeople</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">PRS_ID</attribute1>
        <attribute2 class="text">PRS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="AttendeesPurpose">
      <properties>
        <displayname class="lingual">
          <fr>Objectif</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_Attendees</resourcefrom>
        <resourceto class="resource">Purpose</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TPE_ID</attribute1>
        <attribute2 class="text">TPE_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ConcreteEventEventHeader">
      <properties>
        <displayname class="lingual">
          <fr>Entete</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">EventHeader</resourceto>
        <separator class="separator"/>
        <type class="linktype">0</type>
        <attribute1 class="text">TET_ID</attribute1>
        <attribute2 class="text"/>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ContinentCountry">
      <properties>
        <displayname class="lingual">
          <fr>Pays</fr>
        </displayname>
        <hiddenlink class="boolean">true</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Continent</resourcefrom>
        <resourceto class="resource">Country</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">CTT_ID</attribute1>
        <attribute2 class="text">CTT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file">images/world_link.png</imageclosed>
        <imageopened class="file">images/world_link.png</imageopened>
      </properties>
    </resourcelink>
    <resourcelink name="CountryContinent">
      <properties>
        <displayname class="lingual">
          <fr>Continent</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Country</resourcefrom>
        <resourceto class="resource">Continent</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">CTT_ID</attribute1>
        <attribute2 class="text">CTT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventAddress">
      <properties>
        <displayname class="lingual">
          <fr>EventAddress</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">Address</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">fkTAS_ID</attribute1>
        <attribute2 class="text">TAS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventAttendees">
      <properties>
        <displayname class="lingual">
          <fr>EventAttendees</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">R_Attendees</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">fkTCT_ID</attribute1>
        <attribute2 class="text">TCT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventAttendeesPerson">
      <properties>
        <displayname class="lingual">
          <fr>EventAttendeesPerson</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">EventAttendees</firstlink>
        <secondlink class="link">AttendeesPerson</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventAttendeesPersonADPeople">
      <properties>
        <displayname class="lingual">
          <fr>Participants</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">EventAttendeesPerson</firstlink>
        <secondlink class="link">TravelPeopleADPeople</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file">images/black-womanman.gif</imageclosed>
        <imageopened class="file">images/green-user.gif</imageopened>
      </properties>
    </resourcelink>
    <resourcelink name="EventAuthor">
      <properties>
        <displayname class="lingual">
          <fr>EventAuthor</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">TravelPeople</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">fkPRS_ID_AUTHOR</attribute1>
        <attribute2 class="text">PRS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventEventScope">
      <properties>
        <displayname class="lingual">
          <fr>Périmètre</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">EventScope</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">fkTES_ID</attribute1>
        <attribute2 class="text">TES_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventEventType">
      <properties>
        <displayname class="lingual">
          <fr>Type</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">EventType</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">fkTTY_ID</attribute1>
        <attribute2 class="text">TTY_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventHeaderAddress">
      <properties>
        <displayname class="lingual">
          <fr>Adresses</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">EventHeaderRAddress</firstlink>
        <secondlink class="link">REventHeaderAddress</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventHeaderConcreteEvent">
      <properties>
        <displayname class="lingual">
          <fr>Evènements concrets</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">EventHeader</resourcefrom>
        <resourceto class="resource">Event</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TET_ID</attribute1>
        <attribute2 class="text">fkTET_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file">images/black-time.gif</imageclosed>
        <imageopened class="file">images/green-clock.gif</imageopened>
      </properties>
    </resourcelink>
    <resourcelink name="EventHeaderEventScope">
      <properties>
        <displayname class="lingual">
          <fr>Périmètre</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">EventHeader</resourcefrom>
        <resourceto class="resource">EventScope</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TES_ID</attribute1>
        <attribute2 class="text">TES_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventHeaderEventType">
      <properties>
        <displayname class="lingual">
          <fr>Type</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">EventHeader</resourcefrom>
        <resourceto class="resource">EventType</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TTY_ID</attribute1>
        <attribute2 class="text">TTY_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventHeaderRAddress">
      <properties>
        <displayname class="lingual">
          <fr>EventHeaderRAddress</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">EventHeader</resourcefrom>
        <resourceto class="resource">R_EventHeaderAddress</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TET_ID</attribute1>
        <attribute2 class="text">TET_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventLeader">
      <properties>
        <displayname class="lingual">
          <fr>EventLeader</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">TravelPeople</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">PRS_ID_LEADER</attribute1>
        <attribute2 class="text">PRS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventMission">
      <properties>
        <displayname class="lingual">
          <fr>EventMission</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">EventRMission</firstlink>
        <secondlink class="link">REventMission</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventReport">
      <properties>
        <displayname class="lingual">
          <fr>EventReport</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">Report</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">fkTCT_ID</attribute1>
        <attribute2 class="text">TCT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventRMission">
      <properties>
        <displayname class="lingual">
          <fr>RMissionEvent</fr>
        </displayname>
        <hiddenlink class="boolean">true</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Event</resourcefrom>
        <resourceto class="resource">R_EventMission</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">fkTCT_ID</attribute1>
        <attribute2 class="text">TCT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventTemplateConcreteEvent">
      <properties>
        <displayname class="lingual">
          <fr>Evènements concrets</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">EventTemplate</resourcefrom>
        <resourceto class="resource">Event</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TET_ID</attribute1>
        <attribute2 class="text">fkTET_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file">images/black-time.gif</imageclosed>
        <imageopened class="file">images/green-clock.gif</imageopened>
      </properties>
    </resourcelink>
    <resourcelink name="EventTypeEventScope">
      <properties>
        <displayname class="lingual">
          <fr>EventTypeEventScope</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">EventTypeRScope</firstlink>
        <secondlink class="link">REventTypeScope</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="EventTypeRScope">
      <properties>
        <displayname class="lingual">
          <fr>EventTypeRScope</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">EventType</resourcefrom>
        <resourceto class="resource">R_EventTypeScope</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TTY_ID</attribute1>
        <attribute2 class="text">TTY_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="GGROPRJToMembre">
      <properties>
        <displayname class="lingual">
          <fr>GGROPRJToMembre</fr>
        </displayname>
        <hiddenlink class="boolean">true</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">RoleOperation</resourcefrom>
        <resourceto class="resource">People</resourceto>
        <separator class="separator"/>
        <type class="linktype">0</type>
        <attribute1 class="text">member</attribute1>
        <attribute2 class="text"/>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="MissionEvent">
      <properties>
        <displayname class="lingual">
          <fr>MissionEvent</fr>
        </displayname>
        <hiddenlink class="boolean">true</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">MissionREvent</firstlink>
        <secondlink class="link">RMissionEvent</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="MissionInitiatorADPeople">
      <properties>
        <displayname class="lingual">
          <fr>MissionInitiatorADPeople</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">MissionRootMission</firstlink>
        <secondlink class="link">MissionOwnerADPeople</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="MissionOwnerADPeople">
      <properties>
        <displayname class="lingual">
          <fr>MissionOwnerADPeople</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">MissionOwnerPerson</firstlink>
        <secondlink class="link">TravelPeopleADPeople</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="MissionOwnerPerson">
      <properties>
        <displayname class="lingual">
          <fr>EventOwnerPerson</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Mission</resourcefrom>
        <resourceto class="resource">TravelPeople</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">PRS_ID</attribute1>
        <attribute2 class="text">PRS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="MissionREvent">
      <properties>
        <displayname class="lingual">
          <fr>MissionEvent</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Mission</resourcefrom>
        <resourceto class="resource">R_EventMission</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TMN_ID</attribute1>
        <attribute2 class="text">TMN_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="MissionRootMission">
      <properties>
        <displayname class="lingual">
          <fr>Mission Racine</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Mission</resourcefrom>
        <resourceto class="resource">Mission</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TMN_ID_ROOT</attribute1>
        <attribute2 class="text">TMN_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="MissionRStatus">
      <properties>
        <displayname class="lingual">
          <fr>MissionRStatus</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Mission</resourcefrom>
        <resourceto class="resource">R_MissionStatus</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TMN_ID</attribute1>
        <attribute2 class="text">TMN_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="MissionStatus">
      <properties>
        <displayname class="lingual">
          <fr>MissionStatus</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">MissionRStatus</firstlink>
        <secondlink class="link">RMissionStatus</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="PeoplePerson">
      <properties>
        <displayname class="lingual">
          <fr>PeoplePerson</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">People</resourcefrom>
        <resourceto class="resource">TravelPeople</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">cn</attribute1>
        <attribute2 class="text">PRS_LOGIN</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="PeopleRoleOperation">
      <properties>
        <displayname class="lingual">
          <fr>PeopleRoleOperation</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">People</resourcefrom>
        <resourceto class="resource">RoleOperation</resourceto>
        <separator class="separator"/>
        <type class="linktype">0</type>
        <attribute1 class="text">memberOf</attribute1>
        <attribute2 class="text"/>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="PeopleRolePosition">
      <properties>
        <displayname class="lingual">
          <fr>PeopleRolePosition</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">People</resourcefrom>
        <resourceto class="resource">RolePosition</resourceto>
        <separator class="separator"/>
        <type class="linktype">0</type>
        <attribute1 class="text">memberOf</attribute1>
        <attribute2 class="text"/>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ProjetToMembre">
      <properties>
        <displayname class="lingual">
          <fr>ProjetToMembre</fr>
        </displayname>
        <hiddenlink class="boolean">true</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">GroupProject</resourcefrom>
        <resourceto class="resource">RoleOperation</resourceto>
        <separator class="separator"/>
        <type class="linktype">0</type>
        <attribute1 class="text">member</attribute1>
        <attribute2 class="text"/>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ReportChoices">
      <properties>
        <displayname class="lingual">
          <fr>ReportChoices</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">ReportRChoice</firstlink>
        <secondlink class="link">RReportChoice</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ReportEvent">
      <properties>
        <displayname class="lingual">
          <fr>Evènement</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Report</resourcefrom>
        <resourceto class="resource">Event</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TCT_ID</attribute1>
        <attribute2 class="text">fkTCT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ReportNetworkingContacts">
      <properties>
        <displayname class="lingual">
          <fr>NetworkingContacts</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Report</resourcefrom>
        <resourceto class="resource">ReportNetworkingContacts</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TRT_ID</attribute1>
        <attribute2 class="text">TRT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ReportRChoice">
      <properties>
        <displayname class="lingual">
          <fr>ReportRChoice</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Report</resourcefrom>
        <resourceto class="resource">R_ReportChoice</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TRT_ID</attribute1>
        <attribute2 class="text">TRT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ReportRStatus">
      <properties>
        <displayname class="lingual">
          <fr>ReportStatus</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">Report</resourcefrom>
        <resourceto class="resource">R_ReportStatus</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TRT_ID</attribute1>
        <attribute2 class="text">TRT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="ReportStatus">
      <properties>
        <displayname class="lingual">
          <fr>ReportStatus</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">ReportRStatus</firstlink>
        <secondlink class="link">RReportStatus</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="REventHeaderAddress">
      <properties>
        <displayname class="lingual">
          <fr>RAddressEventHeader</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_EventHeaderAddress</resourcefrom>
        <resourceto class="resource">Address</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TAS_ID</attribute1>
        <attribute2 class="text">TAS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="REventMission">
      <properties>
        <displayname class="lingual">
          <fr>RMissionEvent</fr>
        </displayname>
        <hiddenlink class="boolean">true</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_EventMission</resourcefrom>
        <resourceto class="resource">Mission</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TMN_ID</attribute1>
        <attribute2 class="text">TMN_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="REventTypeScope">
      <properties>
        <displayname class="lingual">
          <fr>REventTypeScope</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_EventTypeScope</resourcefrom>
        <resourceto class="resource">EventScope</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TES_ID</attribute1>
        <attribute2 class="text">TES_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="RMissionEvent">
      <properties>
        <displayname class="lingual">
          <fr>RMissionEvent</fr>
        </displayname>
        <hiddenlink class="boolean">true</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_EventMission</resourcefrom>
        <resourceto class="resource">Event</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TCT_ID</attribute1>
        <attribute2 class="text">fkTCT_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="RMissionStatus">
      <properties>
        <displayname class="lingual">
          <fr>RMissionStatus</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_MissionStatus</resourcefrom>
        <resourceto class="resource">Status</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TST_ID</attribute1>
        <attribute2 class="text">TST_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="RMissionStatusPeople">
      <properties>
        <displayname class="lingual">
          <fr>RMissionStatus</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_MissionStatus</resourcefrom>
        <resourceto class="resource">TravelPeople</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">PRS_ID</attribute1>
        <attribute2 class="text">PRS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="RReportChoice">
      <properties>
        <displayname class="lingual">
          <fr>RReportChoice</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_ReportChoice</resourcefrom>
        <resourceto class="resource">ReportChoices</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TCS_ID</attribute1>
        <attribute2 class="text">TCS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="RReportStatus">
      <properties>
        <displayname class="lingual">
          <fr>ReportStatus</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">R_ReportStatus</resourcefrom>
        <resourceto class="resource">Status</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">TST_ID</attribute1>
        <attribute2 class="text">TST_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="TravelPeopleADPeople">
      <properties>
        <displayname class="lingual">
          <fr>TravelPeopleADPeople</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">TravelPeople</resourcefrom>
        <resourceto class="resource">People</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">PRS_LOGIN</attribute1>
        <attribute2 class="text">CN</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="TravelPeopleAttendees">
      <properties>
        <displayname class="lingual">
          <fr>TravelPeopleAttendees</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">TravelPeople</resourcefrom>
        <resourceto class="resource">R_Attendees</resourceto>
        <separator class="separator"/>
        <type class="linktype">4</type>
        <attribute1 class="text">PRS_ID</attribute1>
        <attribute2 class="text">PRS_ID</attribute2>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="TravelPeopleEvents">
      <properties>
        <displayname class="lingual">
          <fr>TravelPeopleEvents</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <firstlink class="link">TravelPeopleAttendees</firstlink>
        <secondlink class="link">AttendeesEvent</secondlink>
        <type class="hidden">6</type>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
    <resourcelink name="UserManager">
      <properties>
        <displayname class="lingual">
          <fr>Manager</fr>
        </displayname>
        <hiddenlink class="boolean">false</hiddenlink>
        <separator class="separator"/>
        <resourcefrom class="resource">People</resourcefrom>
        <resourceto class="resource">People</resourceto>
        <separator class="separator"/>
        <type class="hidden">7</type>
        <onexecute class="script">///$debug
// Script exécuté au chargement dune vue contenant la relation.
// les paramètres dn, from et to donnent respectivement le dn de départ de la relation, la ressource d'origine et la ressource cible.
// Le paramètre requestedAttributes indique quels sont les attributs demandés. 

//recupère les paramètre de la relation
var /*String*/ sourceDn = meibo.getParameter("dn"); // user Dn
var /*String*/ sourceResource = meibo.getParameter("from"); // People - user
var /*String*/ targetResource = meibo.getParameter("to"); // People - manager
var /*Array*/ requestedAttributes = meibo.getParameter("requestedAttributes");

var /*ResultSet*/ resultSet = null; // Resultet de manager correspondant au "dn" en entrée

try{

  // recupérer groupe GGRF ("position") de l'utilisateur
  var /*ResultSet*/ userPositionRS = meibo.executeLink("PeopleRolePosition", sourceDn,"cn");
  if((userPositionRS!=null) &amp;&amp; (userPositionRS.hasMoreElements())){
    var /*Entry*/ userPositionEntry = userPositionRS.getEntry();
    var userGroupCn = userPositionEntry.cn[0];
    
    // Recherche le role manager correspondant pour le role utilisateur
    var /*ResultSet*/ sqlProcResult = meibo.executeSqlRequest("IAM_BCOM","call get_directorRoleID_from_GGRF('" + userGroupCn + "')",0);
    // retour = CN du groupe du manager, sous le nom "TRG_ID_AD"

    if((sqlProcResult == null) || (sqlProcResult.getEntryCount()==0)){
      throw "Pas de manager trouvé pour le role '" + userGroupCn + "' de l'utilisateur "+ sourceDn +" (via la procédure stockée get_directorRoleID_from_GGRF)";
    }else{
      var sqlProcResultEntry= sqlProcResult.getEntry();
      var managerGroupCn = sqlProcResultEntry.TRG_ID_AD[0];
   
      // Recherche le groupe du manager  et son DN 
      var /*ResultSet*/ managerPositionRs = meibo.executeResource("RolePosition", "(cn=" + managerGroupCn + ")",1);
      
      if((managerPositionRs!=null) &amp;&amp; (managerPositionRs.hasMoreElements())){
          var /*Entry*/ managerPositionEntry = managerPositionRs.getEntry();
          var managerGroupDn = managerPositionEntry.dn[0];
          
          // suit le lien et construit le ResulSet cible
          // Rechercher les utilisateurs associés à ce groupe (ici 'GGRF-NET-DIR')
          resultSet = meibo.executeResource(targetResource, "(memberOf=" + managerGroupDn + ")", 0, arrayToString(requestedAttributes,","));
          if((resultSet==null) || (resultSet.getEntryCount()&lt;1)){            
            throw "Pas d'utilisateur trouvé avec le role '" + managerGroupCn + "' de manager (récupéré via la procédure stockée get_directorRoleID_from_GGRF pour " + userGroupCn + ")";
          }else if(meibo.isDebugEnabled("")){
            for each(var entry in resultSet){
              meibo.logDebug("Manager (" + managerGroupCn + ") de l'utilisateur "+ sourceDn + " : " + entry.dn[0]);
            }
          }          
      }else{        
        throw "Pas de groupe AD trouvé pour le role '" + managerGroupCn + "' de manager de l'utilisateur "+ sourceDn +" (récupéré via la procédure stockée get_directorRoleID_from_GGRF pour " + userGroupCn + ")";
      }    
    }    
  }else{
    throw "Pas de role 'position' trouvé pour l'utilisateur "+ sourceDn;
  }

}catch (exception) {
  meibo.logWarn("Impossible de récuperer le manager de l'utilisateur "+ sourceDn + " : " + exception);
}
meibo.setReturnObject(resultSet);</onexecute>
        <onupdate class="script"/>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
      </properties>
    </resourcelink>
  </resourcelinks>
  <perspectives auto="A -&gt; Z">
    <perspective name="Accueil" type="1">
      <properties>
        <displayname class="lingual">
          <fr>Accueil</fr>
        </displayname>
        <separator class="separator"/>
        <leftwidth class="number">1</leftwidth>
        <separator class="separator"/>
        <startscreen class="sequence">Acceuil</startscreen>
        <separator class="separator"/>
        <onstart class="script">///$debug
</onstart>
        <separator class="separator"/>
        <imageclosed class="file"/>
        <imageopened class="file"/>
        <imagerollover class="file"/>
      </properties>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <AnalyseurDeplacement>true</AnalyseurDeplacement>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <OrganisateurVoyage>true</OrganisateurVoyage>
        <Utilisateur>true</Utilisateur>
      </rights>
    </perspective>
    <perspective name="Administration" type="4">
      <properties>
        <displayname class="lingual">
          <fr>Administration</fr>
        </displayname>
        <separator class="separator"/>
        <leftwidth class="number">225</leftwidth>
        <separator class="separator"/>
        <menuscreen class="sequence">Events</menuscreen>
        <vertical class="boolean">true</vertical>
        <separator class="separator"/>
        <onstart class="script"/>
        <separator class="separator"/>
        <imageclosed class="file">images/green_config.gif</imageclosed>
        <imageopened class="file">images/green_config.gif</imageopened>
        <imagerollover class="file"/>
      </properties>
      <rights>
        <AdminMeibo>true</AdminMeibo>
      </rights>
    </perspective>
    <perspective name="Ressources" type="0">
      <properties>
        <displayname class="lingual">
          <fr>Ressources</fr>
        </displayname>
        <separator class="separator"/>
        <leftwidth class="number">330</leftwidth>
        <separator class="separator"/>
        <type class="dynamictype">DHTML</type>
        <persistent class="boolean">true</persistent>
        <separator class="separator"/>
        <resources class="resources">People,Continent,RoleOperation,GroupProject,Country,Event,EventHeader,Mission,Address,EventScope,EventType,EventTemplate,Report,ReportChoices</resources>
        <separator class="separator"/>
        <links class="links">ContinentPays,PeopleRolePosition,PeopleRoleOperation,UserManager,ProjetToMembre,GGROPRJToMembre,ContinentCountry,MissionEvent,EventHeaderConcreteEvent,EventAuthor,EventLeader,EventTypeEventScope,EventHeaderEventScope,EventHeaderEventType,EventAddress,EventHeaderAddress,EventTemplateConcreteEvent,EventMission,EventAttendeesPersonADPeople,EventAttendeesPerson,MissionStatus,MissionRootMission,MissionOwnerADPeople,MissionInitiatorADPeople,EventReport,ReportEvent,ReportNetworkingContacts,ReportStatus,ReportChoices,TravelPeopleEvents</links>
        <separator class="separator"/>
        <imageheader class="file"/>
        <menubackcolor class="color">FFFFFF</menubackcolor>
        <menufrontcolor class="color">000000</menufrontcolor>
        <selectedbackcolor class="color">FFFFFF</selectedbackcolor>
        <selectedfrontcolor class="color">000000</selectedfrontcolor>
        <hoverbackcolor class="color">FFFFFF</hoverbackcolor>
        <hoverfrontcolor class="color">330066</hoverfrontcolor>
        <separator class="separator"/>
        <showperspective class="boolean">false</showperspective>
        <showallviews class="boolean">false</showallviews>
        <separator class="separator"/>
        <onstart class="script"/>
        <separator class="separator"/>
        <onpopulateresource class="script"/>
        <onpopulatelink class="script"/>
        <separator class="separator"/>
        <imageclosed class="file">images/black-folder.gif</imageclosed>
        <imageopened class="file">images/green-open-folder.gif</imageopened>
        <imagerollover class="file">images/red-open-folder.gif</imagerollover>
      </properties>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <AnalyseurDeplacement>true</AnalyseurDeplacement>
        <DDI>true</DDI>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <OrganisateurVoyage>true</OrganisateurVoyage>
      </rights>
    </perspective>
    <perspective name="Taches" type="5">
      <properties>
        <displayname class="lingual">
          <fr>Tâches</fr>
        </displayname>
        <separator class="separator"/>
        <leftwidth class="number">315</leftwidth>
        <separator class="separator"/>
        <textcss class="css"> LabelFormulaireTaches</textcss>
        <titlecss class="css"> SousTitreTache</titlecss>
        <textcolor class="color">000000</textcolor>
        <bgcolor class="color">FFFFFF</bgcolor>
        <separator class="separator"/>
        <imageheader class="file"/>
        <processimage class="file">images/cog.png</processimage>
        <activityimage class="file">images/cog_edit.png</activityimage>
        <workitemimage class="file">images/cog.png</workitemimage>
        <cancelworkitemimage class="file">images/cancel.png</cancelworkitemimage>
        <previousTaskImage class="file">images/tache_previous.png</previousTaskImage>
        <nextTaskImage class="file">images/tache_next.png</nextTaskImage>
        <separator class="separator"/>
        <showprocess class="boolean">false</showprocess>
        <displayprocesspackage class="boolean">true</displayprocesspackage>
        <useActivityNameFilter class="boolean">false</useActivityNameFilter>
        <buttonFilterName class="text">Filtrer</buttonFilterName>
        <separator class="separator"/>
        <showactivity class="boolean">true</showactivity>
        <displayactivitypriority class="boolean">false</displayactivitypriority>
        <displayactivitydescription class="boolean">true</displayactivitydescription>
        <displayactivityprocess class="boolean">true</displayactivityprocess>
        <displayactivitydate class="boolean">true</displayactivitydate>
        <displayactivitydeadline class="boolean">true</displayactivitydeadline>
        <sortValueActivity class="text"/>
        <activityPagination class="number">15</activityPagination>
        <separator class="separator"/>
        <showworkitem class="boolean">true</showworkitem>
        <displayworkitemdescription class="boolean">true</displayworkitemdescription>
        <displayworkitemprocess class="boolean">true</displayworkitemprocess>
        <displayworkitemdate class="boolean">true</displayworkitemdate>
        <displayworkitemdeadline class="boolean">true</displayworkitemdeadline>
        <sortValueWorkItem class="text"/>
        <workItemPagination class="number">15</workItemPagination>
        <separator class="separator"/>
        <onstart class="script"/>
        <separator class="separator"/>
        <imageclosed class="file">images/cog.png</imageclosed>
        <imageopened class="file">images/cog.png</imageopened>
        <imagerollover class="file">images/cog.png</imagerollover>
      </properties>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <AnalyseurDeplacement>true</AnalyseurDeplacement>
        <DDI>true</DDI>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <Utilisateur>true</Utilisateur>
      </rights>
    </perspective>
  </perspectives>
  <application auto="A -&gt; Z">
    <sequence name="Acceuil">
      <path>Acceuil.xml</path>
      <class/>
      <properties>
        <displayname class="lingual">
          <fr>Acceuil</fr>
        </displayname>
        <maskused class="boolean">true</maskused>
        <globalScriptView class="extscriptnodebug"/>
        <separator class="separator"/>
        <onload class="extscript"/>
      </properties>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <AnalyseurDeplacement>true</AnalyseurDeplacement>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <OrganisateurVoyage>true</OrganisateurVoyage>
        <Utilisateur>true</Utilisateur>
      </rights>
      <trigger>
        <onload class="script">if(meibo.isUserInRole("DDI")){
  meibo.showField("EVENT_PANEL",true);
  meibo.showField("REPORT_CREATE_BTN",true);
  meibo.showField("EVENT_CREATE_BTN",true);  
}

// Ajout d'une "non valeur" dans la liste pour permettre de ne rien sélectionner
var /*Field2*/ typeField= meibo.getField("fkTTY_ID");
typeField.setOptions("-," + typeField.getOptions());
typeField.setParameters(" ," + meibo.getFieldParameters("fkTTY_ID"));
typeField.setValue(" ");
 
 var /*Field2*/ scopeField= meibo.getField("fkTES_ID");
scopeField.setOptions("-," + scopeField.getOptions());
scopeField.setParameters(" ," + meibo.getFieldParameters("fkTES_ID"));
scopeField.setValue(" ");</onload>
        <globalscriptView class="script"/>
      </trigger>
    </sequence>
    <sequence name="Error">
      <path>Error.xml</path>
      <class/>
      <properties>
        <displayname class="lingual">
          <fr>Error</fr>
        </displayname>
        <maskused class="boolean">true</maskused>
        <globalScriptView class="extscriptnodebug"/>
        <separator class="separator"/>
        <onload class="extscript"/>
      </properties>
      <rights/>
      <trigger>
        <onload class="script"/>
        <globalscriptView class="script"/>
      </trigger>
    </sequence>
    <sequence name="Events">
      <path>Events.xml</path>
      <class/>
      <properties>
        <displayname class="lingual">
          <fr>Events</fr>
        </displayname>
        <maskused class="boolean">true</maskused>
        <globalScriptView class="extscriptnodebug"/>
        <separator class="separator"/>
        <onload class="extscript"/>
      </properties>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <AnalyseurDeplacement>true</AnalyseurDeplacement>
        <DDI>true</DDI>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <OrganisateurVoyage>true</OrganisateurVoyage>
      </rights>
      <trigger>
        <onload class="script"/>
        <globalscriptView class="script"/>
      </trigger>
    </sequence>
    <sequence name="OK">
      <path>OK.xml</path>
      <class/>
      <properties>
        <displayname class="lingual">
          <fr>OK</fr>
        </displayname>
        <maskused class="boolean">true</maskused>
        <globalScriptView class="extscriptnodebug"/>
        <separator class="separator"/>
        <onload class="extscript"/>
      </properties>
      <rights/>
      <trigger>
        <onload class="script"/>
        <globalscriptView class="script"/>
      </trigger>
    </sequence>
    <sequence name="pageAccueilAdministration">
      <path>pageAccueilAdministration.xml</path>
      <class/>
      <properties>
        <displayname class="lingual">
          <fr>pageAccueilTrombinoscope</fr>
        </displayname>
        <maskused class="boolean">true</maskused>
        <globalScriptView class="extscriptnodebug"/>
        <separator class="separator"/>
        <onload class="extscript"/>
      </properties>
      <rights>
        <AdminMeibo>true</AdminMeibo>
      </rights>
      <trigger>
        <onload class="script"/>
        <globalscriptView class="script"/>
      </trigger>
    </sequence>
    <sequence name="Validation_OK">
      <path>Validation_OK.xml</path>
      <class/>
      <properties>
        <displayname class="lingual">
          <fr>Validation_OK</fr>
        </displayname>
        <maskused class="boolean">true</maskused>
        <globalScriptView class="extscriptnodebug"/>
        <separator class="separator"/>
        <onload class="extscript"/>
      </properties>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <AnalyseurDeplacement>true</AnalyseurDeplacement>
        <DDI>true</DDI>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <OrganisateurVoyage>true</OrganisateurVoyage>
        <Utilisateur>true</Utilisateur>
      </rights>
      <trigger>
        <onload class="script"/>
        <globalscriptView class="script"/>
      </trigger>
    </sequence>
  </application>
  <roles auto="A -&gt; Z">
    <role name="AdminMeibo" type="3">
      <properties>
        <rolelevel class="rolelevel">4</rolelevel>
        <separator class="separator"/>
        <startperspective class="perspective">Ressources</startperspective>
      </properties>
    </role>
    <role name="AnalyseurDeplacement" type="3">
      <properties>
        <rolelevel class="rolelevel">2</rolelevel>
        <separator class="separator"/>
        <startperspective class="perspective">Accueil</startperspective>
      </properties>
    </role>
    <role name="DDI" type="3">
      <properties>
        <rolelevel class="rolelevel">3</rolelevel>
        <separator class="separator"/>
        <startperspective class="perspective">Accueil</startperspective>
      </properties>
    </role>
    <role name="InitiateurDeplacement" type="3">
      <properties>
        <rolelevel class="rolelevel">2</rolelevel>
        <separator class="separator"/>
        <startperspective class="perspective">Accueil</startperspective>
      </properties>
    </role>
    <role name="OrganisateurVoyage" type="3">
      <properties>
        <rolelevel class="rolelevel">2</rolelevel>
        <separator class="separator"/>
        <startperspective class="perspective">Accueil</startperspective>
      </properties>
    </role>
    <role name="Studio" type="3">
      <properties>
        <rolelevel class="rolelevel">1</rolelevel>
        <separator class="separator"/>
        <startperspective class="perspective"/>
      </properties>
    </role>
    <role name="Utilisateur" type="3">
      <properties>
        <rolelevel class="rolelevel">1</rolelevel>
        <separator class="separator"/>
        <startperspective class="perspective">Accueil</startperspective>
      </properties>
    </role>
  </roles>
  <policy>
    <properties/>
  </policy>
  <reports auto="A -&gt; Z">
    <report name="OrdreDeMission">
      <properties>
        <script class="script">///$debug
var mission = getParameter("mission");
//Ouverture du document
var document = new PdfDocument();
document.open("Mission "+mission);
var resultSet = meibo.executeResource("Mission","(TMN_ID="+mission+")",1);
var entry = resultSet.getEntry();
var dn = entry.getDn();
var template = meibo.createPdfView(document, "Mission","MissionOrderPrint", dn);
//template.addTitle("Ordre de mission " + mission);
template.scale(85);

var table = new PdfTable(1);
table.addCell(template);
table.addCell("test 1...");
document.add(table);

//document.add(template);
//fermeture du document
document.close();

meibo.setReport(document);
</script>
        <parameters class="list">
          <item0>mission</item0>
        </parameters>
      </properties>
    </report>
  </reports>
  <batches auto="A -&gt; Z">
    <batch name="test">
      <properties>
        <script class="script">//$debug
var path= meibo.getMeiboPath();
scripter.print(path);
</script>
        <parameters class="list"/>
      </properties>
    </batch>
  </batches>
  <webservices auto="A -&gt; Z">
    <properties>
      <WSMaxPoolSize class="text">30</WSMaxPoolSize>
      <WSMinPoolSize class="text">0</WSMinPoolSize>
      <WSMaxIdle class="text">300</WSMaxIdle>
      <WSPassPhrase class="password">{nygZyN39YKA=}</WSPassPhrase>
      <WSDefType class="textarea"/>
    </properties>
  </webservices>
  <workflow auto="A -&gt; Z">
    <properties>
      <url class="text">wtp://10.3.100.11:2211</url>
      <clientpassword class="password">{iWMHh8dsnbjtEJ4gMJnfjkYC3RRkrcoK}</clientpassword>
      <studiopassword class="password">{iWMHh8dsnbjtEJ4gMJnfjkYC3RRkrcoK}</studiopassword>
      <administratorRole class="rolelist">Studio</administratorRole>
      <trustStore class="genericFile" filter="jks" filter_en="Java Key Store" filter_fr="Java Key Store"/>
      <trustStorePassword class="password"/>
      <clientStore class="genericFile" filter="jks" filter_en="Java Key Store" filter_fr="Java Key Store"/>
      <clientStorePassword class="password"/>
    </properties>
    <process name="CompteRendu">
      <properties/>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <Studio>true</Studio>
        <Utilisateur>true</Utilisateur>
      </rights>
    </process>
    <process name="Mission">
      <properties/>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <Studio>true</Studio>
        <Utilisateur>true</Utilisateur>
      </rights>
    </process>
    <process name="OrganisationDeplacement">
      <properties/>
      <rights>
        <AdminMeibo>true</AdminMeibo>
        <InitiateurDeplacement>true</InitiateurDeplacement>
        <Studio>true</Studio>
        <Utilisateur>true</Utilisateur>
      </rights>
    </process>
  </workflow>
  <adaptors auto="A -&gt; Z">
    
  </adaptors>
  <plugins auto="A -&gt; Z">
    <plugin name="pluginMail-1" title="NotifyConfirmation">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Confirmation de mission</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;La mission {param.missionID} pour {param.user} a été validée et organisée.&lt;/P&gt;
&lt;P&gt;Voici les évènements prévus sur cette mission : &lt;br&gt;
{param.missionContent}
&lt;/P&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <entries>
              <result>notificationPeople</result>
              <attr>mail</attr>
            </entries>
          </to>
          <cc>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>true</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyForCompletion">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Organisation de mission</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Une mission a été validée pour vous.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour la compléter afin de permettre son organisation.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </to>
          <cc>
  </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyForMissionOrder">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Ordre de mission</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;L'organisation de votre mission a été effectuée.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour confirmer votre participation et éditer l'odre de mission.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
&lt;P&gt;Informations founies sur l'organisation de la mission :&lt;/P&gt;
&lt;P&gt;{param.organisationComment}&lt;/P&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </to>
          <cc>
  </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyForOrganisation">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Organisation de mission</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Une mission a été validée et doit être organisée.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour traiter cette organisation.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <entries>
              <result>targetPeople</result>
              <attr>mail</attr>
            </entries>
          </to>
          <cc>{param.recipient}
            
          </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyForReportValidation">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Compte-rendu d'évènement - demande de validation</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Un compte rendu d'évènment vient d'être réalisé.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour le valider.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <entries>
              <result>targetPeople</result>
              <attr>mail</attr>
            </entries>
          </to>
          <cc>{param.recipient}
            
          </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyForSecondLevelValidation">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Validation de mission (2eme niveau)</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Une mission a été créée pour {param.user}.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour valider ou rejetter cette mission.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <entries>
              <result>secondLevelValidationPeople</result>
              <attr>mail</attr>
            </entries>
          </to>
          <cc>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyForValidation">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Validation de mission</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Une mission a été créée pour {param.user}.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour valider ou rejetter cette mission.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <relvar>
              <dn>participantDN</dn>
              <linkattr>UserManager/People/mail</linkattr>
            </relvar>
          </to>
          <cc>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyMissionCanceled">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Mission annulée</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;La mission {param.missionID} de {param.user} a été annulée.&lt;/P&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <relvar>
              <dn>participantDN</dn>
              <linkattr>UserManager/People/mail</linkattr>
            </relvar>
          </to>
          <cc>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyParticipantForAcceptation">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Proposition de mission</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Une mission a été créée pour vous.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour accepter ou refuser  la mission.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </to>
          <cc>
  </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyParticipantForReport">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Compte-rendu d'évènement</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Vous êtes identifié comme ayant participé récemment à un évenement.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour contribuer au compte-rendu de cette évèmement.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <mailvar>
              <mail>recipient</mail>
            </mailvar>
          </to>
          <cc>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyParticipantForReportAdjustment">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Compte-rendu d'évènement - demande de modification ou complément</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Vous êtes identifié comme ayant participé récemment à un évenement.&lt;/P&gt;
&lt;P&gt;Un premier compte rendu a été réalisé, mais des compléments ou modifications sont demandés :&lt;/P&gt;
&lt;P&gt;{param.checkReportStepComment}&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour traiter cette demande.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <mailvar>
              <mail>recipient</mail>
            </mailvar>
          </to>
          <cc>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="NotifyRejection">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Mission rejettée</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Votre mission a été rejettée avec le motif suivant :.&lt;/P&gt;
&lt;P&gt;{param.reason}&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour la modifier ou l'annuler.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </to>
          <cc>
  </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="Reminder">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Rappel sur le workflow de mission</subject>
          <html>true</html>
          <body>&lt;P&gt;Bonjour,&lt;/P&gt;
{process.MAIL_HEADER}
&lt;P&gt;Une tache vous a été affectée.&lt;/P&gt;
&lt;P&gt;Veuillez-vous connecter avec le lien ci-dessous pour la traiter.&lt;/P&gt;
&lt;a href="{param.baseURL}&amp;Project=BCOM_TRAVEL&amp;Connection=BCOM_TRAVEL&amp;activity={meibo.getCurrentWorkflowTask().getActivityInstance().getId()}"&gt;{param.MAIL_LINKNAME}&lt;/a&gt;
{param.MAIL_FOOTER}</body>
          <files>
  </files>
          <to>
            <mail>
              <mail>{param.recipient}</mail>
            </mail>
          </to>
          <cc>
  </cc>
          <bcc>
  </bcc>
          <from>{param.MAIL_SENDER}</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
    <plugin name="pluginMail-1" title="testMail">
      <properties>
        <plugin en="Plugin to send e-mails (v1.2)" fr="Plugin d'envoi d'e-mails (v1.2)" name="pluginMail-1">
          <subject>Meibo TEST mail</subject>
          <html>false</html>
          <body>test</body>
          <files>
  </files>
          <to>
            <mail>
              <mail>frederic.jean@b-com.com</mail>
            </mail>
          </to>
          <cc>
  </cc>
          <bcc>
  </bcc>
          <from>meibo_dev@b-com.com</from>
          <debug>false</debug>
          <SMTPAuth>false</SMTPAuth>
        </plugin>
      </properties>
    </plugin>
  </plugins>
</project>
